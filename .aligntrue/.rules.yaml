# WARNING: This file is auto-generated by AlignTrue
# DO NOT EDIT DIRECTLY - Edit your agent files (.cursor/*.mdc, AGENTS.md, CLAUDE.md, etc.) instead
# Changes to this file will be overwritten on next sync
# See: https://aligntrue.ai/docs/concepts/sync-behavior

id: test-error-rules
version: 1.0.0
spec_version: "1"
sections:
  - heading: OSS repo and content guardrails
    content: ""
    level: 2
    fingerprint: cc5cf97d7f21868d
    vendor:
      aligntrue:
        source_scope: guardrails
        source_file: .cursor/rules/guardrails.mdc
        last_modified: 2025-11-10T05:41:52.289Z
  - heading: Keep future and commercial details private
    content: |-
      Do not generate, insert, or reference:

      - Future phases beyond the current OSS scope (cloud services, dashboards, org workflows, integrations)
      - Monetization details (pricing, revenue, paid tiers, consulting)
      - Competitive positioning (comparisons, market claims, investor angles)
      - Internal roadmap (timelines, gated milestones, GTM plans)
      - Speculative features not explicitly part of the current OSS release

      If unsure, omit.

      ---
    level: 2
    fingerprint: ef6493d404bac16d
    vendor:
      aligntrue:
        source_scope: guardrails
        source_file: .cursor/rules/guardrails.mdc
        last_modified: 2025-11-10T05:41:52.289Z
  - heading: Public repo focus
    content: |-
      Keep all public content centered on:

      - Determinism, reproducibility, auditability, transparency
      - Current OSS features and direct user benefits
      - Example packs, schema validation, bundling, lockfiles
      - Exporters, CLI usage, MCP server basics
      - Local first workflows and offline usage

      Use neutral, factual language. Safe phrasing:

      > Future improvements may come via community contributions.

      ---
    level: 2
    fingerprint: f027874644fa4179
    vendor:
      aligntrue:
        source_scope: guardrails
        source_file: .cursor/rules/guardrails.mdc
        last_modified: 2025-11-10T05:41:52.289Z
  - heading: Naming and scope
    content: |-
      - Project name: **AlignTrue** (no space)
      - Public repo: `AlignTrue/aligntrue` (MIT CLI, docs, examples)
      - Do not mention `AlignTrue/cloud` or any paid offering in OSS docs, comments, or examples

      ---
    level: 2
    fingerprint: 1f84791e2c6ac2bc
    vendor:
      aligntrue:
        source_scope: guardrails
        source_file: .cursor/rules/guardrails.mdc
        last_modified: 2025-11-10T05:41:52.289Z
  - heading: Safe topics
    content: |-
      Allowed focus areas include:

      - Deterministic bundles and lockfiles
      - JSON canonicalization and hashing
      - Exporter fidelity notes and agent parity behavior
      - CI validation flows
      - Local, offline compatible usage

      ---
    level: 2
    fingerprint: 0295ca482edbd755
    vendor:
      aligntrue:
        source_scope: guardrails
        source_file: .cursor/rules/guardrails.mdc
        last_modified: 2025-11-10T05:41:52.289Z
  - heading: Out of scope topics
    content: |-
      Do not include:

      - SSO, approvals, analytics, or multi tenant features
      - Team usage analytics, billing, or payment flows
      - Comparisons against vendors or tools
      - Investor materials, pitch framing, or narrative
      - Roadmaps or timelines framed as commitments

      ---
    level: 2
    fingerprint: 1322981b85e90efa
    vendor:
      aligntrue:
        source_scope: guardrails
        source_file: .cursor/rules/guardrails.mdc
        last_modified: 2025-11-10T05:41:52.289Z
  - heading: Honesty rule
    content: |-
      - Do not make claims that are not currently true
      - If details are sensitive, undecided, or future oriented, omit rather than speculate

      ---
    level: 2
    fingerprint: b69e599b98dbb36b
    vendor:
      aligntrue:
        source_scope: guardrails
        source_file: .cursor/rules/guardrails.mdc
        last_modified: 2025-11-10T05:41:52.289Z
  - heading: Review checklist
    content: |-
      Before merging a feature that touches determinism, sync, or exports:

      - Uses `canonicalJson` and `stableHash` where required (Section 1)
      - IR first: IR remains the canonical source (Section 10)
      - Vendor bags used and volatile fields excluded correctly (Section 10)
      - Two way sync follows precedence and atomicity rules (Section 11)
      - Merge order and precedence follow Section 2 in team mode
      - Scope behavior matches Sections 3 and 12
      - Export bytes are stable and include required footer (Section 7)
      - CLI exit codes and messages follow Section 9
      - Telemetry is opt in and PII free (Section 6)
      - Pack export and verify are reproducible (Section 4)
      - `@aligntrue/ui` obeys zero build rules if touched (Section 14)

      ---
    level: 2
    fingerprint: 8529e70363b6f72b
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Allowed boilerplate
    content: |-
      **Positioning (safe)**

      > AlignTrue compiles YAML Aligns into deterministic bundles and agent ready exports. The CLI validates schemas, pins hashes, and writes stable outputs for CI.

      **Future note (safe)**

      > Additional improvements may arrive through community contributions. This repository documents the current OSS surface.

      ---
    level: 2
    fingerprint: f73004c625643b21
    vendor:
      aligntrue:
        source_scope: guardrails
        source_file: .cursor/rules/guardrails.mdc
        last_modified: 2025-11-10T05:41:52.289Z
  - heading: Prohibited boilerplate
    content: |-
      Do not use phrases like:

      - "Enterprise roadmap includes..."
      - "Pricing starts at..."
      - "This will beat competitors because..."
      - "Planned Qx release will add..."

      ---
    level: 2
    fingerprint: 72f84b83795f0f81
    vendor:
      aligntrue:
        source_scope: guardrails
        source_file: .cursor/rules/guardrails.mdc
        last_modified: 2025-11-10T05:41:52.289Z
  - heading: Issue and PR hygiene
    content: |-
      - Scope issues and PRs to OSS features:
        - validate
        - bundle
        - export
        - schema
        - examples
      - Link to specs and tests instead of future plans
      - Keep discussion on current implementation and acceptance criteria only
    level: 2
    fingerprint: fbb0c95e2a4f4094
    vendor:
      aligntrue:
        source_scope: guardrails
        source_file: .cursor/rules/guardrails.mdc
        last_modified: 2025-11-10T05:41:52.289Z
  - heading: Pull request standards
    content: |-
      **When to apply:** Before marking any user facing feature as complete. Use this as the acceptance gate for all PRs that add or modify behavior.

      Every such PR must pass this checklist before merge.

      ---
    level: 2
    fingerprint: 6972770d304df9bf
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: Documentation checklist
    content: |-
      Required (unless using the internal code exception below):

      - [ ] **API docs** for public APIs  
             `apps/docs/content/reference/{feature-slug}.md`
      - [ ] **User guide** if users must learn new workflows  
             `apps/docs/content/guides/{feature-slug}.md` or `apps/docs/content/concepts/{feature-slug}.md`
      - [ ] **Example** in `examples/{feature-slug}.md` (or `.ipynb`) with a runnable smoke block
      - [ ] **CHANGELOG.md** updated with a concise entry in the correct section
      - [ ] **Temp docs deleted**  
             No `*_STATUS.md`, `*_CHECKLIST.md`, `*_SUMMARY.md`, `*_PHASE*.md`, `*_IMPLEMENTATION.md`, or similar

      ---
    level: 2
    fingerprint: 6cb091ed6029a60d
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: Example validation
    content: |-
      Each example must:

      - [ ] Run top to bottom without errors
      - [ ] Include a smoke block that prints tool version, seed, and platform
      - [ ] Pin randomness (for example `SEED=42`, no `Date.now()` in outputs)
      - [ ] Produce byte identical artifacts across two runs in the same environment
      - [ ] Show equivalent CLI usage with `aligntrue` commands
      - [ ] Link to the relevant API docs near the top
      - [ ] Use repo data or small synthetic data only (no downloads)
      - [ ] Stay under 30 sections, prefer 10 to 20

      ---
    level: 2
    fingerprint: fc2a2b9dbb414f73
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: API documentation validation
    content: |-
      All public symbols affected by the PR must have:

      - [ ] One line purpose statement
      - [ ] Parameters with types and shapes
      - [ ] Return types and shapes
      - [ ] Error cases and when they occur
      - [ ] Determinism notes when relevant (seeds, hashes, ordering)
      - [ ] Minimal example (2 to 5 lines)
      - [ ] Links to example, user guide, CLI command, and source

      ---
    level: 2
    fingerprint: 9979f7ff61002f85
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: Build and CI validation
    content: |-
      Before merge:

      - [ ] Docs site builds clean  
             `pnpm --filter docs build` (or equivalent for the docs app)
      - [ ] All cross links between examples, API docs, and guides resolve
      - [ ] No references to deleted or renamed files
      - [ ] Type checks pass on changed packages  
             `pnpm exec tsc --noEmit -p packages/schema/tsconfig.json -p packages/cli/tsconfig.json`
      - [ ] Lint passes  
             `pnpm lint`
      - [ ] All tests pass  
             `pnpm test`
      - [ ] Determinism gate passes for any byte stable artifact  
             run under `TZ=UTC` and compare hashes

      ---
    level: 2
    fingerprint: 794ff11de9d89a19
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: UI package validation
    content: |-
      If the PR touches `packages/ui/src/**`:

      - [ ] No asset imports (no `.svg`, `.png`, `.jpg`, `.jpeg`, `.gif`, `.webp`)
      - [ ] SVGs are inline JSX or data URIs only
      - [ ] Linter passes `no-asset-imports-in-ui`
      - [ ] All consuming apps build clean  
             for example `pnpm --filter docs build`
      - [ ] Theming uses CSS variables, not hardcoded colors
      - [ ] Constraints match `implementation_specs.mdc` Section 14

      ---
    level: 2
    fingerprint: 2402411e09a51e86
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: Internal code exception path
    content: |-
      Use only when code is strictly internal.

      All must be true:

      - [ ] Code is internal utility, not part of public API
      - [ ] No CLI command imports or calls it
      - [ ] Comprehensive unit tests exist
      - [ ] Type checks pass
      - [ ] Module header includes an internal note  
             `/** @internal: rationale */`
      - [ ] `CHANGELOG.md` still updated with a short note

      Example:

      ```typescript
      /** @internal: hash utility used only by manifest writer */
      ```

      ---
    level: 2
    fingerprint: b8bffe5fc08718b3
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: Agent self check before marking "done"
    content: |-
      Do not claim completion unless all relevant items below are true.

      1. Example (if added) runs twice with byte identical outputs
      2. All doc links are clicked locally and resolve
      3. Docs build passes without warnings that indicate missing pages
      4. No temporary `*_*.md` files remain in root or dev directories
      5. `CHANGELOG.md` includes a clear user facing summary
      6. All acceptance criteria in this file that apply to the change are satisfied
      7. If `packages/ui` changed, zero build constraints are satisfied and enforced

      If any single item fails, the feature is not done.

      ---
    level: 2
    fingerprint: ee0ecd5740d39e35
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: What this prevents
    content: |-
      - Features without examples
      - Public APIs without documentation
      - Non deterministic examples that contradict determinism claims
      - Temp docs and status files accumulating in the repo
      - Broken cross links and missing pages
      - Silent user facing changes without `CHANGELOG.md` entries

      ---
    level: 2
    fingerprint: 12a81438bec8a199
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: Enforcement model
    content: |-
      - AI agents must not mark work complete until this checklist passes
      - Human reviewers use this file as the PR review contract
      - CI should run:
        - docs build
        - type check
        - lint
        - tests
        - determinism checks for stable artifacts

      ---
    level: 2
    fingerprint: 2fde84ba2d883073
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: Quick commands
    content: ""
    level: 2
    fingerprint: 8ea85d0937bbcd00
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: Full gate (typical baseline)
    content: |-
      ```bash
      TZ=UTC pnpm test
      pnpm lint
      pnpm --filter docs build
      ```
    level: 3
    fingerprint: 9af73afd1eeafc1d
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: Determinism spot check for an export
    content: |-
      ```bash
      sha256sum out/export.mdc
      sha256sum out/export.mdc
    level: 3
    fingerprint: bc1d5df235190644
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: Hashes must match
    content: "```"
    level: 2
    fingerprint: c00e951d1663e1d1
    vendor:
      aligntrue:
        source_scope: pull_request_standards
        source_file: .cursor/rules/pull_request_standards.mdc
        last_modified: 2025-11-10T05:54:35.943Z
  - heading: Cursor rules authoring guide
    content: ""
    level: 2
    fingerprint: 140fe2fdff2bb341
    vendor:
      aligntrue:
        source_scope: rule_authoring
        source_file: .cursor/rules/rule_authoring.mdc
        last_modified: 2025-11-10T05:57:24.151Z
  - heading: Purpose
    content: |-
      Use this when creating or updating any Cursor rule so guidance stays sharp, consistent, and testable.

      ---
    level: 2
    fingerprint: 81b06df4303e6581
    vendor:
      aligntrue:
        source_scope: rule_authoring
        source_file: .cursor/rules/rule_authoring.mdc
        last_modified: 2025-11-10T05:57:24.151Z
  - heading: Output contract when proposing a rule change
    content: |-
      Every proposed rule or edit must include:

      1. Summary of change
      2. Rationale
      3. Updated rule text only
      4. Impacted areas and precedence notes
      5. Tests or examples if relevant
      6. Conflict check: rules it supersedes, extends, or defers to

      ---
    level: 2
    fingerprint: 8cbe69c29917d63d
    vendor:
      aligntrue:
        source_scope: rule_authoring
        source_file: .cursor/rules/rule_authoring.mdc
        last_modified: 2025-11-10T05:57:24.151Z
  - heading: Authoring checklist
    content: |-
      - Write for the agent in imperative voice
      - One topic per rule; split large topics
      - Keep each rule under 500 lines
      - State where it applies and where it does not
      - Lead with hard constraints (must, never, only)
      - Add at least one minimal example for each key directive
      - Encode precedence when overlap is possible
      - Reference real context with `@Cursor Rules`, `@Docs`, and file paths
      - For response shaping rules, define an explicit output contract
      - Prefer paved road patterns over generic prohibitions
      - Ban known anti patterns directly with short examples
      - Keep diffs minimal; avoid full rewrites without cause
      - For parameterized, stack agnostic behavior, use plugs (see `plugs.mdc`)

      ---
    level: 2
    fingerprint: 0e467231d66f57d0
    vendor:
      aligntrue:
        source_scope: rule_authoring
        source_file: .cursor/rules/rule_authoring.mdc
        last_modified: 2025-11-10T05:57:24.151Z
  - heading: Rule structure
    content: |-
      Each rule must follow this shape:

      1. **Header**
         - `id`, `version`, `updated`, `owner`, `status`
      2. **Title**
         - Short, specific topic name
      3. **When this applies**
         - Repo paths, tech stack, scenarios
      4. **Constraints**
         - Explicit must, never, only
      5. **Patterns**
         - Preferred approaches and paved road flows
      6. **Output contract**
         - Required sections for agent replies
      7. **References**
         - `@Cursor Rules`, `@Docs`, files in repo
      8. **Examples**
         - One good, one bad
      9. **Precedence**
         - Which rules it overrides or defers to

      ---
    level: 2
    fingerprint: 0ea6e7a02e3ed4f7
    vendor:
      aligntrue:
        source_scope: rule_authoring
        source_file: .cursor/rules/rule_authoring.mdc
        last_modified: 2025-11-10T05:57:24.151Z
  - heading: Quality bar
    content: |-
      Rules must be:

      - Clear, concrete, and testable
      - Short sentences, minimal jargon
      - Free of duplicated guidance across rules

      If guidance is duplicated, extract it into one rule and reference it.

      ---
    level: 2
    fingerprint: df4e40d31fae6f34
    vendor:
      aligntrue:
        source_scope: rule_authoring
        source_file: .cursor/rules/rule_authoring.mdc
        last_modified: 2025-11-10T05:57:24.151Z
  - heading: Maintenance
    content: |-
      - Review suppressions during code reviews
      - Update suppressions if code changes
      - Remove suppressions if validation is added
      - Document new patterns as they arise
    level: 2
    fingerprint: 8589c63b0943a62b
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: Do not
    content: |-
      - Do not embed team philosophy or broad narrative
      - Do not use vague terms like "clean" or "simple" without criteria
      - Do not reference docs generically; use explicit `@` links or file paths
    level: 2
    fingerprint: 9ad80878ed715fd6
    vendor:
      aligntrue:
        source_scope: rule_authoring
        source_file: .cursor/rules/rule_authoring.mdc
        last_modified: 2025-11-10T05:57:24.151Z
  - heading: Test Run Template
    content: Use this template for documenting test runs.
    level: 2
    fingerprint: 343a3bebc4661d0b
    vendor:
      aligntrue:
        source_scope: test_log_template
        source_file: .cursor/rules/test_log_template.mdc
        last_modified: 2025-11-12T22:20:05.847Z
  - heading: Test Run {YYYY-MM-DD HH:MM}
    content: |-
      **Environment:**
      - Commit: {git commit hash}
      - Node: {node --version}
      - Platform: {darwin|linux|win32}
      - Test Type: {local|ci|manual}

      **Test Execution:**
      - Code Source: {local workspace|remote commit}
      - Environment: {hermetic|workspace}
      - Test Directory: {path to test dir}

      ---
    level: 2
    fingerprint: ffa2ad07d42802f4
    vendor:
      aligntrue:
        source_scope: test_log_template
        source_file: .cursor/rules/test_log_template.mdc
        last_modified: 2025-11-12T22:20:05.847Z
  - heading: Findings
    content: ""
    level: 2
    fingerprint: 8aa3c4ce3ccdfe89
    vendor:
      aligntrue:
        source_scope: test_log_template
        source_file: .cursor/rules/test_log_template.mdc
        last_modified: 2025-11-12T22:20:05.847Z
  - heading: Confirmed Bugs
    content: ""
    level: 3
    fingerprint: 1aa07a45a0c76f73
    vendor:
      aligntrue:
        source_scope: test_log_template
        source_file: .cursor/rules/test_log_template.mdc
        last_modified: 2025-11-12T22:20:05.847Z
  - heading: "[P0] {Bug Title}"
    content: |-
      **Description:** {What's broken}

      **Root cause:** {Why it's broken}

      **Reproduction:**
      ```bash
    level: 4
    fingerprint: c3628ae0f31fcba8
    vendor:
      aligntrue:
        source_scope: test_log_template
        source_file: .cursor/rules/test_log_template.mdc
        last_modified: 2025-11-12T22:20:05.847Z
  - heading: Steps to reproduce
    content: |-
      ```

      **Fix:** {How to fix it}

      **Files affected:**
      - `{file path}`
      - `{file path}`

      ---
    level: 2
    fingerprint: a5cdbfe55af8c314
    vendor:
      aligntrue:
        source_scope: test_log_template
        source_file: .cursor/rules/test_log_template.mdc
        last_modified: 2025-11-12T22:20:05.847Z
  - heading: "[P1] {Bug Title}"
    content: |-
      {Same structure as P0}

      ---
    level: 4
    fingerprint: 7f87ca676889fe3b
    vendor:
      aligntrue:
        source_scope: test_log_template
        source_file: .cursor/rules/test_log_template.mdc
        last_modified: 2025-11-12T22:20:05.847Z
  - heading: Test Execution Issues
    content: ""
    level: 3
    fingerprint: 2d1189b91984a0c3
    vendor:
      aligntrue:
        source_scope: test_log_template
        source_file: .cursor/rules/test_log_template.mdc
        last_modified: 2025-11-12T22:20:05.847Z
  - heading: "{Issue Title}"
    content: |-
      **What went wrong:** {Description of test setup/execution problem}

      **Impact:** {Did this invalidate test results?}

      **How to fix:** {For next test run}

      ---
    level: 4
    fingerprint: 512b9c84d2bf4bdf
    vendor:
      aligntrue:
        source_scope: test_log_template
        source_file: .cursor/rules/test_log_template.mdc
        last_modified: 2025-11-12T22:20:05.847Z
  - heading: Coverage Gaps
    content: ""
    level: 3
    fingerprint: 82b47c7c4b4bacf7
    vendor:
      aligntrue:
        source_scope: test_log_template
        source_file: .cursor/rules/test_log_template.mdc
        last_modified: 2025-11-12T22:20:05.847Z
  - heading: "{Gap Title}"
    content: |-
      **What wasn't tested:** {Description}

      **Why:** {Reason - time, complexity, dependencies, etc.}

      **Plan:** {When/how to test this}

      ---
    level: 4
    fingerprint: 8966284bcae92c14
    vendor:
      aligntrue:
        source_scope: test_log_template
        source_file: .cursor/rules/test_log_template.mdc
        last_modified: 2025-11-12T22:20:05.847Z
  - heading: Summary
    content: |-
      **Bugs found:** {count} ({P0 count} P0, {P1 count} P1, {P2 count} P2)

      **Tests passed:** {count}/{total}

      **Coverage:** {percentage or description}

      **Release readiness:** {Ready|Blocked|Needs work}

      **Blockers:**
      - {List any P0 bugs blocking release}

      **Next steps:**
      1. {Action item}
      2. {Action item}
      3. {Action item}
    level: 2
    fingerprint: 761b7ad8ad439b28
    vendor:
      aligntrue:
        source_scope: test_log_template
        source_file: .cursor/rules/test_log_template.mdc
        last_modified: 2025-11-12T22:20:05.847Z
  - heading: Documentation standards
    content: "**When to apply:** Any time you create or update docs, complete features, or touch temporary files. This keeps docs useful and prevents cruft."
    level: 2
    fingerprint: 0c60e7d6b541564a
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Core principle
    content: |-
      **Derive specifics from the live repo each run.** Test systematically based on actual commands and docs, not a static checklist.

      ---
    level: 2
    fingerprint: ac69ea215cdee9dd
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Strict rules
    content: ""
    level: 2
    fingerprint: 025df06e70cb3266
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Never create verbose summary docs
    content: |-
      Do **not** add:

      - `*_SUMMARY.md`
      - `*_STATUS.md`
      - `*_IMPROVEMENTS.md`
      - `*_REVIEW.md`
      - `docs/development/*-summary.md`
      - `docs/development/*-improvements.md`
      - Any file that just restates your response or PR description

      If it reads like a status, recap, or phase log, it is temporary.
    level: 3
    fingerprint: cf46741dcfb60a8f
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Only create
    content: |-
      1. **`CHANGELOG.md` entries**
      2. **User docs in `apps/docs/content/`**  
         Only when users need to understand how to use a feature.
      3. **Auto-generated repo files** - `README.md`, `CONTRIBUTING.md`, `DEVELOPMENT.md`, `SECURITY.md` are generated from docs site via `pnpm generate:repo-files`

      Internal working notes belong in `.internal_docs/` while work is active. They must not appear in public docs.

      **Protected files (auto-generated, do not edit directly):**
      - `README.md` (from `apps/docs/content/index.mdx`)
      - `CONTRIBUTING.md` (from `apps/docs/content/06-contributing/creating-packs.md`)
      - `DEVELOPMENT.md` (from `apps/docs/content/08-development/*.md`)
      - `SECURITY.md` (from `apps/docs/content/07-policies/security.md`)

      ---
    level: 3
    fingerprint: bc546e4885c1a348
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: CHANGELOG (required)
    content: "`CHANGELOG.md` is the single source of truth for changes."
    level: 2
    fingerprint: 49c3b0db641ac4fe
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Standards
    content: |-
      - Follow Keep a Changelog style.
      - Follow Semantic Versioning.
      - Use an `Unreleased` section.
      - Reverse chronological order.
    level: 3
    fingerprint: 0b21aaddae93d023
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Valid categories
    content: |-
      - Added
      - Changed
      - Deprecated
      - Removed
      - Fixed
      - Security
    level: 3
    fingerprint: 5969f6abc586583c
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Entry format
    content: |-
      Keep it short, user facing, and factual.

      ```markdown
    level: 3
    fingerprint: 0bb306da14e81c90
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Added
    content: |-
      - Amazing new exporter that unlocks next level productivity
      ```

      ---
    level: 3
    fingerprint: 279b8a60f444fa8b
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Forbidden in CHANGELOG
    content: |-
      Do not include:

      - Token or effort estimates
      - LOC counts
      - Full file path lists (config exceptions allowed)
      - Test counts or coverage metrics
      - Session or phase breakdowns
      - Internal refactor detail
      - Commit hashes or history dumps
      - Build or CI trivia with no user impact
    level: 3
    fingerprint: da9aa820c20eb3d2
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Allowed
    content: |-
      - `temp-test-output.md`
      - `temp-bundle.yaml`
      - `temp-config.yaml`
      - `temp-test-project/`
    level: 3
    fingerprint: eabc01f12ec3e7cb
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Writing style
    content: |-
      **Tone:**

      - Neutral, factual, concise
      - One idea per bullet
      - Sentences under 25 words
      - No emojis
      - No semicolons or em dashes

      **Use verbs like:**

      - added
      - changed
      - fixed
      - improved
      - removed
      - updated

      **Avoid:**

      - Hype and marketing language
      - Superlatives
      - Second person in technical notes

      **Good example:**

      ```markdown
    level: 3
    fingerprint: 74872c97fc35a08f
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Commit messages
    content: ""
    level: 2
    fingerprint: cd7f94c2f0641ad4
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Format
    content: |-
      ```
      type(scope): description
      ```
    level: 3
    fingerprint: e904c9ccfa425ff0
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Rules
    content: |-
      - Test through public surfaces and exports
      - Do not assert internal IR layout unless it is a documented contract
      - Accept that agent files are exports, not primary sources
      - Sync overwriting agent files is expected unless `--accept-agent` is involved

      ---
    level: 3
    fingerprint: 6c621d1a05138a78
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Examples
    content: ""
    level: 2
    fingerprint: c590b3c924c35c2f
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: Documentation content
    content: Use documentation for real user workflows only.
    level: 2
    fingerprint: 117a586d2d9513cd
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: User guides
    content: |-
      - **Location:** `apps/docs/content/concepts/` or `apps/docs/content/reference/`
      - **Create only when:** a feature needs explanation
      - **Include:** Overview, Quick start, Configuration, Examples, Troubleshooting
      - **Keep examples:** runnable and minimal
    level: 3
    fingerprint: 16308d54de0c1879
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Tone
    content: |-
      - Explain what the feature does
      - Explain how to use it
      - No hype language
    level: 3
    fingerprint: 00cf4ce3935c8a60
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Brand and naming
    content: |-
      - **AlignTrue** (no space)
      - `.aligntrue/config.yaml` for config
      - `.aligntrue/.rules.yaml` for internal IR
      - `.aligntrue.lock.json` and `.aligntrue.bundle.yaml` for team mode
      - `.cursor/*.mdc` for Cursor exports
      - `AGENTS.md` is primary user editable rules file
    level: 3
    fingerprint: ef103173327ea38c
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Emoji Usage
    content: |-
      **NEVER use emojis in:**

      - AGENTS.md and agent-exported files
      - IR (.rules.yaml)
      - Config files (.aligntrue/config.yaml)
      - HTML comments and markers in exported files
      - Section headings or content that syncs across agents
      - Read-only file warnings
      - Error messages in synced content

      **Reason:** Emojis break parsing, render inconsistently across formats and terminals, cause encoding issues, and reduce clarity in technical content.

      **OK to use emojis in:**

      - Documentation website (apps/docs) for visual appeal
      - README files that are not synced
      - Commit messages (for personal preference)
      - Internal tools output (CLI help text, status messages)

      ---
    level: 3
    fingerprint: 2163941d78eb2622
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Documentation site layout
    content: Nextra docs live in `apps/docs/content/`.
    level: 2
    fingerprint: ea270ebcf9bdf39a
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Current structure
    content: |-
      - `00-getting-started/` - Quickstart, next steps, FAQ
      - `01-guides/` - Workflow guides (solo, team, multi-agent)
      - `02-customization/` - Plugs, overlays, scopes
      - `03-concepts/` - Core concepts (sync, drift, team mode)
      - `04-reference/` - CLI reference, agent support, features
      - `05-troubleshooting/` - Common issues and solutions
      - `06-contributing/` - Contribution guides
      - `07-policies/` - Security and other policies
      - `08-development/` - Development setup and guides
    level: 3
    fingerprint: 95ef76886ae1192c
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Documentation architecture
    content: |-
      AlignTrue uses a **docs-first architecture** where the documentation site is the canonical source and repo root files are generated from it.

      **Data flow:**
      ```
      apps/docs/content/ (canonical source - edit here)
        ↓
      scripts/generate-repo-files.mjs (transformation)
        ↓
      README.md, CONTRIBUTING.md, DEVELOPMENT.md, SECURITY.md (generated - don't edit)
      ```

      **File mappings:**
      - `apps/docs/content/index.mdx` → `README.md`
      - `apps/docs/content/06-contributing/creating-packs.md` → `CONTRIBUTING.md`
      - `apps/docs/content/08-development/*.md` → `DEVELOPMENT.md` (concatenated)
      - `apps/docs/content/07-policies/security.md` → `SECURITY.md`

      **Workflow:**
      1. Edit docs source in `apps/docs/content/`
      2. Stage your changes (including any accidental edits to protected files)
      3. Commit—the pre-commit hook will auto-regenerate protected files from source

      **Protection:**
      The pre-commit hook automatically regenerates protected files when docs source changes. If regeneration fails, the hook explains how to debug.
    level: 3
    fingerprint: e31a3b29719d94f2
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Frontmatter
    content: |-
      Each page must have:

      ```yaml
      ---
      title: Page title
      description: One line description
      ---
      ```
    level: 3
    fingerprint: 11bb4a85269952e2
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Guidelines
    content: |-
      - Use relative links
      - Use `bash`, `yaml`, `typescript` tags for code blocks
      - Keep navigation shallow and obvious
      - Use callouts and tabs only when they improve clarity
      - Avoid custom React components in content
    level: 3
    fingerprint: a54bfd9a10390756
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Markdown (.md) vs MDX (.mdx)
    content: |-
      **Use `.md` (default)**
      - Pure markdown content
      - No JSX components
      - Works fine with Nextra
      - Most docs should be `.md`

      **Use `.mdx` when adding JSX**
      - `<Callout>` components
      - `<Tabs>` components
      - `<Cards>` components
      - Any other React/JSX elements
      - **Critical:** Rename `.md` → `.mdx` BEFORE adding JSX, otherwise components won't render

      **Naming convention:**
      When you add a JSX component to an existing `.md` file, rename it to `.mdx` in the same edit. Example:
      ```bash
      git mv overlays.md overlays.mdx
    level: 3
    fingerprint: 9c694cddf91cf7b3
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Then add <Callout> components
    content: |-
      ```

      **Generation compatibility:**
      The `pnpm generate:repo-files` script handles both `.md` and `.mdx` files equally, so this doesn't affect README generation.

      ---
    level: 2
    fingerprint: 277e540ef83e368a
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Temporary files
    content: "Temporary means: delete before merge."
    level: 2
    fingerprint: 56970d04a3161f97
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Delete
    content: |-
      - Import only tests
      - Coverage shims
      - Pure implementation detail tests
      - Duplicates of stronger integration or contract tests
      - Tests that rely on heavy internal mocking
    level: 3
    fingerprint: 6197595503f01ee2
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Keep
    content: |-
      - `CHANGELOG.md`
      - `apps/docs/content/**/*.md`
      - `.internal_docs/*.md` (internal only, never linked from public docs)

      ---
    level: 3
    fingerprint: 6ca7ea2feefc88ec
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Small vs big changes
    content: ""
    level: 2
    fingerprint: fa4e21d1fc90bd4c
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Small feature or fix
    content: |-
      **Scope:** one module or limited files.

      **Do:**

      - Add 1 to 3 bullets to `CHANGELOG.md`
      - Update existing docs only if behavior changed

      **Do not:**

      - Create new pages
      - Add status or summary docs
    level: 3
    fingerprint: 04997727dde21912
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Big feature or system
    content: |-
      **Scope:** new feature set or architecture.

      **Do:**

      - Add 3 to 5 bullets to `CHANGELOG.md`
      - Add one focused doc page in concepts or reference
      - Explain enablement, config, and key workflows

      **Do not:**

      - Add multi page status narratives
      - Keep phase or session logs

      ---
    level: 3
    fingerprint: 5d69be12ba5306c5
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Agent workflow
    content: ""
    level: 2
    fingerprint: 36ebefb443d017bf
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: While working
    content: |-
      - You may create temporary notes under `dev/` or `.internal_docs/`
      - Do not present them as permanent
      - Do not suggest roadmap or handoff docs by default
    level: 3
    fingerprint: 16d80221633a84b2
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: On completion
    content: |-
      1. Update `CHANGELOG.md`
      2. Create or update user docs if needed
      3. Delete temporary files
      4. Confirm git is clean
    level: 3
    fingerprint: a64bab81516a8f6f
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: "Do not claim completion if:"
    content: |-
      - Temporary `*_*.md` files remain
      - Docs are missing for new user facing behavior

      ---
    level: 3
    fingerprint: 921d499894fbb0c8
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Cleanup checklist
    content: |-
      Before merge:

      - `CHANGELOG.md` updated
      - User doc added or updated if feature is user facing
      - No `*_STATUS.md`
      - No `*_CHECKLIST.md`
      - No `*_SUMMARY.md`
      - No `*_PHASE*.md`
      - No `*_IMPLEMENTATION.md`
      - No `UPPERCASE_UNDERSCORES` temp docs in root or `dev/`

      ---
    level: 2
    fingerprint: 659a42772b3b1f13
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Answering documentation questions
    content: |-
      When asked where to look:

      1. Point to `CHANGELOG.md`
      2. Point to relevant `apps/docs/content/...` pages
      3. Do not suggest adding permanent status or roadmap files
      4. Treat any working file as disposable

      ---
    level: 2
    fingerprint: 1e06db1ac3e2bf72
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Package Exports Documentation
    content: "**Critical requirement:** All package exports must be documented BEFORE adding to `package.json`."
    level: 2
    fingerprint: b4fad90a44235bd5
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Documentation location
    content: "`apps/docs/content/08-development/package-exports.md`"
    level: 3
    fingerprint: 572db50e31f66c5d
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Required information
    content: |-
      For each export, document:
      - Export path (e.g., `./utils/section-parser`)
      - Purpose (one sentence description)
      - Example usage (import statement)
    level: 3
    fingerprint: db1240acc9cb2b46
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Workflow
    content: |-
      1. **Document first** - Add entry to package exports documentation
      2. **Add export** - Update `exports` field in `package.json`
      3. **Build and test** - Verify: `pnpm build && pnpm test`
      4. **Update CHANGELOG** - Add entry describing the new export
    level: 3
    fingerprint: da7f739f62719846
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Export format
    content: |-
      ```json
      {
        "exports": {
          "./your-export": {
            "types": "./dist/your-export.d.ts",
            "default": "./dist/your-export.js"
          }
        }
      }
      ```
    level: 3
    fingerprint: 078d47fd60d49a86
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Why this matters
    content: |-
      - Prevents accidental exposure of internal APIs
      - Ensures all exports are intentional and documented
      - Enables CI validation of exports
      - Provides clear guidance for package consumers
    level: 3
    fingerprint: 51ed02c5c32bdbc4
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Validation
    content: |-
      CI should validate that:
      - All exports in `package.json` are documented
      - All documented exports exist in `package.json`
      - All export files exist in `dist/` after build

      ---
    level: 3
    fingerprint: 98c41dcd20b86b86
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Documentation accuracy validation
    content: "**Critical requirement:** Documentation must match implementation reality. Code and config are the source of truth, not docs."
    level: 2
    fingerprint: 1369945fba4bbbae
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Automated validation
    content: |-
      CI and pre-commit hooks automatically validate:

      1. **Node.js version requirements**
         - Source of truth: `package.json` engines.node field
         - Validated in: All documentation files mentioning Node version
         - Update trigger: When changing `package.json` engines field

      2. **CLI command count**
         - Source of truth: `packages/cli/src/index.ts` command dispatch statements
         - Validated in: `apps/docs/content/04-reference/features.md`
         - Update trigger: When adding/removing CLI commands

      3. **Exporter count**
         - Source of truth: Directory count in `packages/exporters/src/`
         - Validated in: `apps/docs/content/index.mdx`, `apps/docs/content/04-reference/agent-support.md`
         - Update trigger: When adding/removing exporters

      4. **Performance threshold claims**
         - Source of truth: `packages/cli/tests/integration/performance.test.ts` threshold constants
         - Validated in: `apps/docs/content/04-reference/features.md`
         - Update trigger: When changing test thresholds
    level: 3
    fingerprint: 51057b610b1e855e
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Running validation manually
    content: |-
      ```bash
      pnpm validate:docs
      ```
    level: 3
    fingerprint: 0aca352e5262c4c5
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: When validation fails
    content: |-
      1. Read the error message - it shows expected vs actual values
      2. Update documentation to match code/config (not the other way around)
      3. Re-run validation to confirm fix
      4. Commit both code and doc changes together
    level: 3
    fingerprint: 9c35877e7a8a1743
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: What is NOT validated
    content: |-
      Validation only covers quantifiable claims. These still require manual updates:

      - Feature descriptions and explanations
      - Usage examples and tutorials
      - Troubleshooting guides
      - Conceptual documentation
      - Qualitative performance claims

      For these, follow the existing rules: update docs when behavior changes.

      ---
    level: 3
    fingerprint: e12b3ea155c2e795
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Common mistakes
    content: ""
    level: 2
    fingerprint: a3eb5dc619d1b96b
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Avoid
    content: |-
      - Keeping `FEATURE_STATUS.md` after merge
      - Duplicating explanations across multiple docs
      - Writing guides for internal refactors
      - Leaving temp files in the repo
      - Adding package exports without documentation
      - Updating code without updating validated documentation
    level: 3
    fingerprint: 3270f7fe8acead1d
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Do
    content: |-
      - Keep a single, clean changelog
      - Add focused docs only where users need them
      - Document all package exports before adding them
      - Run `pnpm validate:docs` before committing doc changes
      - Let validation catch drift automatically
    level: 3
    fingerprint: ac0b52a2ae6ef999
    vendor:
      aligntrue:
        source_scope: documentation
        source_file: .cursor/rules/documentation.mdc
        last_modified: 2025-11-15T06:03:01.729Z
  - heading: Debugging workflow
    content: "**When to apply:** Investigating bugs, unexpected behavior, test failures, or non-deterministic outputs. Use this before making code changes."
    level: 2
    fingerprint: b510e460a6f7d5be
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Top 5 time-wasters to avoid
    content: |-
      1. Pattern matching fixes that "look like last time"
      2. Fixing symptoms (exporter) when root cause is upstream (bundle/lock/schema)
      3. Assuming examples and quickstarts are correct
      4. Ignoring environment drift (TZ, Node, OS, CI)
      5. Trial and error edits without a hypothesis

      If you catch any of these: stop and read the error literally.

      ---
    level: 2
    fingerprint: eb6380b89e52c9c4
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Investigation framework
    content: ""
    level: 2
    fingerprint: 8876bd77906f0913
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 1. Read the error literally
    content: |-
      ```
      UndefinedError: 'object' has no property 'contentHash'
      ```

      Extract facts:

      - Type: object
      - Missing: contentHash
      - Suspect: shape/contract mismatch

      Ask: Why is the key missing? Not "How do I access it differently?"
    level: 3
    fingerprint: 7472478beba6471e
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 2. Trace the data flow
    content: |-
      Map source → transforms → destination.

      ```
      load config → resolve packs → bundle → build context → exporter (error)
      ↑
      Likely fix lives here
      ```

      Answer:

      1. Where does the data originate?
      2. What transforms it?
      3. What does the consumer expect?
      4. Where do actual vs expected diverge?
    level: 3
    fingerprint: cfe2ec074d3db860
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 3. Inspect actual state
    content: |-
      Do not guess. Log the real shape. Remove logs before commit.

      ```typescript
      const log = (o: unknown) => {
        console.debug("type:", Array.isArray(o) ? "array" : typeof o);
        try {
          console.debug("preview:", JSON.stringify(o, null, 2).slice(0, 2000));
        } catch {}
      };
      log(ctx);
      ```
    level: 3
    fingerprint: b35d9014206a7c96
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 4. Compare expected vs actual
    content: |-
      ```typescript
      // Expected
      const expected = { contentHash: "sha256:...", rules: [] };

      // Actual
      const actual = {
        hash: "sha256:...",
        rules: [],
        meta: { contentHash: "sha256:..." },
      };
      // Root cause: contentHash nested under meta instead of top level
      ```

      Fix the transformation or normalization, not templates or call sites that already match the contract.
    level: 3
    fingerprint: 1f0cb8495109ec62
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 5. Identify the root cause
    content: |-
      Keep asking "why" until you hit a contract boundary:

      - Symptom: exporter missing contentHash
      - Why: context builder never flattened metadata
      - Why: bundle layout changed, normalization not updated
      - Root cause: missing normalization step
      - Fix: add normalization in shared context builder
    level: 3
    fingerprint: e6357a097c14e367
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 6. Fix at the right layer
    content: |-
      Use this matrix:

      | Situation                                | Fix location               | Reason                |
      | ---------------------------------------- | -------------------------- | --------------------- |
      | Nested vs flat mismatch across consumers | Normalization/shared layer | One source of truth   |
      | One consumer needs special format        | That consumer              | Localize special case |
      | Shared contract used by many             | Shared helpers             | Consistency and DRY   |
    level: 3
    fingerprint: aa003b8444154eec
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 7. Verify the fix
    content: |-
      Prove the contract, do not just silence the error.

      ```typescript
      expect(ctx.contentHash).toMatch(/^sha256:/);
      expect(bytes(exportMdc(ctx))).toStrictEqual(bytes(exportMdc(ctx)));
      ```

      Checklist:

      - Error is gone
      - Root cause understood and documented
      - Correct layer changed
      - Contract test added to prevent regression

      ---
    level: 3
    fingerprint: 5f0c392fcb1b230f
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Common anti-patterns
    content: |-
      - "Fix and see" loops
      - Copying old fixes based on similar messages
      - Only reproducing via full system runs (no minimal repro)
      - Treating docs/examples as ground truth without verifying
      - Token churning: repeated edits without fixing the underlying contract

      If you see this pattern, reset to the investigation framework above.

      ---
    level: 2
    fingerprint: ef3836fc8f8e625e
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Git safety
    content: |-
      Always stash before destructive operations.

      ```bash
      git stash push -m "WIP: <desc>"
      git checkout <branch>   # or git switch/reset
    level: 2
    fingerprint: 5376191302b6d6f4
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: ... investigate ...
    content: |-
      git stash pop
      ```

      Never:

      - Run git checkout or git reset with uncommitted changes without stashing
      - Assume uncommitted work is recoverable

      If you did it anyway:

      1. `git reflog`
      2. `git stash list`
      3. `git fsck --lost-found`
      4. If still lost, rebuild. Prevention is cheaper.

      ---
    level: 2
    fingerprint: 9171d80d1ce19e04
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Recognizing and stopping token churning
    content: |-
      Churning = burning tokens on repeated edits without fixing the underlying contract.

      Warning signs:

      1. Same type of tweak 3+ times in a row
      2. Bulk search/replace before proving pattern
      3. Editing tests to match outputs instead of fixing behavior
      4. Fighting mocks instead of understanding code under test
      5. Huge token use, small actual progress

      Reset with three questions:

      1. What pattern am I repeating?
      2. What is the actual contract or behavior?
      3. Which single layer is wrong?

      Then:

      1. Fix one representative case end to end
      2. Confirm with tests
      3. Apply the proven pattern once across the rest

      ---
    level: 2
    fingerprint: 1e18823b07c28805
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Environment checks
    content: |-
      Run these early:

      ```bash
      TZ=UTC pnpm test

      node -v
      pnpm -v
    level: 2
    fingerprint: c869b7a3c37de53b
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Canonical diff
    content: jq -S . out1.json > a && jq -S . out2.json > b && diff -u a b || true
    level: 2
    fingerprint: 505b9a277306cd55
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Nondeterminism scan
    content: |-
      rg "Date\.now|Math\.random|performance\.now" packages/schema/src packages/cli/src packages/core/src
      ```

      ---
    level: 2
    fingerprint: bfc623f628a19d39
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: OS-specific behavior
    content: |-
      Before touching code, check if the failure is platform specific.

      Common differences:

      | Area         | Unix           | Windows          | Strategy             |
      | ------------ | -------------- | ---------------- | -------------------- |
      | Permissions  | chmod reliable | chmod unreliable | Skip or branch tests |
      | Spawn time   | Faster         | Slower           | Higher thresholds    |
      | Paths        | `/`            | `\`              | Use path.\* helpers  |
      | Line endings | `\n`           | `\r\n`           | Normalize in tests   |
      | Temp dirs    | `/tmp`         | `C:\...`         | Use os.tmpdir()      |

      If CI fails only on Windows:

      - Read error literally
      - Check for assumptions about paths, chmod, timing
      - Decide: real bug vs platform specific test
      - Fix once at correct layer

      ---
    level: 2
    fingerprint: 6759a7ee93d74fa5
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Minimal repro pattern
    content: |-
      Use tight, focused tests.

      ```typescript
      test("context exposes contentHash at top level", () => {
        const merged = { rules: [], meta: { contentHash: "sha256:abc" } };
        const ctx = normalizeContext(merged);
        expect(ctx.contentHash).toBe("sha256:abc");
      });
      ```

      Run:

      ```bash
      pnpm --filter @aligntrue/schema vitest run packages/schema/tests/context.contract.test.ts -t contentHash -v
      ```

      ---
    level: 2
    fingerprint: 2590be7f83cd1574
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Logging guidelines
    content: |-
      - Log what happened and how to fix it
      - Do not log secrets or token-like values
      - Prefer structured logs behind `--json` when helpful
      - Strip debug logs before merge

      ---
    level: 2
    fingerprint: c84eeabd709c43d4
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: AlignTrue quick reference
    content: |-
      | Error pattern                    | First check         | Likely cause        | Fix location                             |
      | -------------------------------- | ------------------- | ------------------- | ---------------------------------------- |
      | Lockfile bytes differ            | canonicalizeJson usage | Missing JCS or sort | packages/schema/src/canonicalize.ts |
      | Missing or wrong exporter footer | Context contentHash    | Not flattened       | packages/cli/src/commands/sync/context-builder.ts |
      | aligntrue --help slow            | Import graph           | Eager imports       | packages/cli/src/commands/\*.ts |
      | Pass local, fail CI              | TZ/Node drift          | Env mismatch        | Vitest setup, CI config |
      | Scope mismatch on Windows        | Path normalization     | Slash handling      | packages/core/src/scope.ts |
      | Ajv errors unreadable            | Error shaping          | Missing formatter   | packages/core/src/validation/\*.ts |
      | Telemetry on when disabled       | Config check           | State mismatch      | packages/core/src/telemetry/collector.ts |

      ---
    level: 2
    fingerprint: 0113364ff01e6eeb
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Determinism triage
    content: "```bash"
    level: 2
    fingerprint: b2e8b4d46337d783
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 1. Canonical compare
    content: jq -S . bundle1.json > b1 && jq -S . bundle2.json > b2 && diff -u b1 b2 || true
    level: 2
    fingerprint: 484a9de1a3bd0e2b
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 2. Nondeterminism search
    content: rg "Date\.now|Math\.random|performance\.now" packages/schema/src packages/cli/src packages/core/src
    level: 2
    fingerprint: 0e8e2437c9178d11
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 3. Stable sets
    content: ""
    level: 2
    fingerprint: dc9d5099f08b276f
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Ensure set-like arrays are sorted once in canonicalization
    content: |-
      ```

      ---
    level: 2
    fingerprint: d27577486e5fd152
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Temp artifacts
    content: |-
      All temporary debug artifacts must start with `temp-`.
      Never commit temp files.

      ---
    level: 2
    fingerprint: d66f734083b9b340
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Communicate the fix
    content: |-
      In PR or commit message:

      - Root cause in one sentence
      - What changed and where
      - How tests now enforce the contract
      - Any platform or determinism notes

      ---
    level: 2
    fingerprint: 8222978b7a8495d5
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Error Lessons Learned Reference
    content: |-
      - For troubleshooting complex or recurring errors, consult `.cursor/rules/error_lessons_learned.mdc`—it contains past solutions and root causes.
      - When you solve a tricky or non-obvious error, summarize the problem, root cause, and successful fix in `error_lessons_learned.mdc`.
      - Write entries in a clear, concise, and structured way (e.g., Symptoms → Cause → Resolution) to help both humans and AI tools diagnose similar issues in the future.
    level: 2
    fingerprint: 16b80400918091f4
    vendor:
      aligntrue:
        source_scope: debugging
        source_file: .cursor/rules/debugging.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Implementation specifications
    content: |-
      **When to apply:** When implementing or updating features that must be deterministic, reproducible, or compliance grade (IR, lockfiles, bundles, exports, hashing, canonicalization).

      These define **what** to build. The **how** is flexible as long as acceptance criteria are met.

      ---
    level: 2
    fingerprint: 18edf172573d463c
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Applicability
    content: ""
    level: 2
    fingerprint: 2042bc7aa65ee809
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Solo mode (default)
    content: |-
      - Lockfile off, bundle off
      - IR is the single source of truth: `.aligntrue/.rules.yaml`
      - Validation via `aligntrue check` (config and schema validation)
    level: 3
    fingerprint: e07d7cdc4e8cc025
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Team mode (opt in)
    content: |-
      - `mode: team` in config
      - Enables lockfile, bundle, and drift detection
      - CI validation via `aligntrue drift --gates`

      See `architecture.mdc` for modular layout.

      ---
    level: 3
    fingerprint: 4e547113dc540499
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 1) Canonical JSON (determinism foundation)
    content: ""
    level: 2
    fingerprint: 67a866181b0f5653
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Why
    content: |-
      - Keeps git status clean
      - Avoids accidental commits of temp artifacts
      - Forces real user style workflows
    level: 3
    fingerprint: 2be23c585f15e5fd
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Requirements
    content: |-
      - No floating ranges for release builds
      - Generate CycloneDX SBOM for tagged releases
      - Attach checksums
      - CI audits dependencies
      - High severity requires explicit waiver
    level: 3
    fingerprint: 10762e1094dbeeab
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: API
    content: |-
      File: `packages/schema/src/canonicalize.ts`

      - `canonicalizeJson(value: unknown, excludeVolatile?: boolean): string`
      - `computeHash(data: string): string` uses SHA-256
      - `computeAlignHash(alignInput: string | unknown): string` combines both for Align packs
    level: 3
    fingerprint: 14c2529eb4498c5d
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Used by
    content: |-
      - `.aligntrue.lock.json`
      - `.aligntrue.bundle.yaml` normalized JSON views in tests
      - `manifest.json`
      - `versions.json`
      - `examples/packs.yaml` metadata
    level: 3
    fingerprint: df56c876cde0b693
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Acceptance
    content: |-
      - No asset imports in `packages/ui/src/**`
      - Custom lint rule catches violations
      - Consumer apps build without extra config
      - Snapshot tests cover rendering

      ---
    level: 3
    fingerprint: c1514c6cdad166c1
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 2) Pack merge, precedence, and conflicts (team mode)
    content: ""
    level: 2
    fingerprint: 617c2fb04ef8c7d5
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Merge semantics
    content: |-
      - Scalars: last wins
      - Set like arrays: union, then stable sort by value
      - Maps: deep merge using the same precedence rules
    level: 3
    fingerprint: 61b62aadf55cb7b1
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Outputs
    content: |-
      - `.aligntrue.bundle.yaml` merged rules
      - `.aligntrue.lock.json` pins:
        - pack hashes
        - bundle hash
        - relevant tool versions
    level: 3
    fingerprint: 7b8c56be0a5f71be
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 3) Scope matching and glob semantics
    content: ""
    level: 2
    fingerprint: c2b65dd972d0c82b
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 4) Bundle pack layout and verification (team mode)
    content: ""
    level: 2
    fingerprint: 9af1e65f4356210f
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Zip layout
    content: |-
      ```txt
      aligntrue-pack.zip
      ├── .aligntrue/
      │   ├── config.yaml          # exact config used
      │   └── .rules.yaml          # internal IR
      ├── .aligntrue.lock.json     # pinned hashes
      ├── .aligntrue.bundle.yaml   # merged rules
      ├── exports/
      │   └── cursor/*.mdc         # agent exports
      ├── manifest.json            # run metadata (canonical JSON)
      ├── versions.json            # node, aligntrue, ajv, etc.
      ├── canonical.jsonl          # file list with sha256
      └── SHA256SUMS.txt           # checksums for all files above
      ```
    level: 3
    fingerprint: ad56c011fb415019
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: CLI (deferred)
    content: Export-pack and verify-pack commands are not yet implemented. Team mode currently writes `.aligntrue.lock.json` with content hashes for CI validation.
    level: 3
    fingerprint: fe3e874e98b5762a
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 5) Catalog and registry keys
    content: ""
    level: 2
    fingerprint: d5bfe7c84f95a8fb
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Index key (example packs)
    content: |-
      - `pack_id`
      - `profile_id`
      - `version` (semver)
      - `content_sha256`
    level: 3
    fingerprint: 7eabcb6a40359d96
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Run key (bundle provenance)
    content: |-
      - `ir_hash` from `.aligntrue/.rules.yaml`
      - `bundle_hash` from `.aligntrue.bundle.yaml`
      - `lock_hash` from `.aligntrue.lock.json`
      - `exporter_version`
    level: 3
    fingerprint: eb749bb6b88dd779
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 6) Telemetry privacy (opt in only)
    content: ""
    level: 2
    fingerprint: e44b0822d6a29506
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Behavior
    content: |-
      - 1 second timeout
      - Silent on failure
      - One line notice on first enable with docs link
    level: 3
    fingerprint: 08bf2418cca97fef
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 7) Export formatting invariants
    content: ""
    level: 2
    fingerprint: a1b06f96c4b63a24
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Markdown style exports
    content: |-
      Includes: `.mdc`, `AGENTS.md`, and other markdown based agent formats.

      **Requirements:**
      - Fixed, documented section order
      - `\n` line endings
      - Exactly one trailing newline
      - No timestamps or UUIDs
      - Required footer:

      ```
      Content-Hash: <sha256-of-IR>
      Fidelity: <notes or "OK">
      ```
    level: 3
    fingerprint: b2afaadeee17ea93
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: AGENTS.md exporter
    content: |-
      - Follows the `AGENTS.md` spec
      - Includes provenance section
      - Includes content hash footer
    level: 3
    fingerprint: 9f14bab6333a2fff
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: MCP and config exporters
    content: |-
      - Write deterministic JSON or YAML
      - Stable key ordering
      - No volatile fields that change per run
    level: 3
    fingerprint: 07d18bd94494b85f
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 8) Schema validation
    content: ""
    level: 2
    fingerprint: 6b0451d66ff6878c
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: CLI
    content: "- `aligntrue check` validates config and rules"
    level: 3
    fingerprint: 99bb88401742848e
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 9) CLI exit codes and error shape
    content: ""
    level: 2
    fingerprint: fce8ff528d917478
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Exit codes
    content: |-
      - `0` success
      - `1` validation error
      - `2` user error (missing files, bad flags)
      - `3` system error
    level: 3
    fingerprint: dcb12d4048e389a8
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Error format
    content: |-
      Each error must state:
      1. What failed
      2. Why it failed
      3. How to fix it, with a concrete action
    level: 3
    fingerprint: c1f4ceb9a45e3c30
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 10) IR and vendor bags
    content: ""
    level: 2
    fingerprint: 1d9d095c1bfedc12
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Hashing
    content: |-
      - Compute hash on IR with volatile fields removed
      - Use `canonicalJson` then `stableHash`
    level: 3
    fingerprint: e365cd9c617713a5
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 11) Two way sync precedence
    content: ""
    level: 2
    fingerprint: 5a3d8434867a8688
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Atomicity
    content: |-
      - All or nothing writes
      - Use temp files and atomic rename
      - On failure, leave previous state untouched
    level: 3
    fingerprint: 3931c975909268ae
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Dry run
    content: |-
      - `--dry-run` prints planned changes
      - Shows which files would be written

      **Team-managed sections:**
      - Configured via `config.managed.sections` (array of section headings)
      - Exporters mark with `[TEAM-MANAGED]` text prefix
      - HTML comments provide context and warnings
      - Sync preserves user edits but warns they may be overwritten
      - Backup system captures all overwrites for recovery
      - Users can rename section to remove from team management
    level: 3
    fingerprint: bc82fae06794d73b
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 12) Hierarchical scopes
    content: ""
    level: 2
    fingerprint: 89f808d73375342e
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 13) Supply chain and releases
    content: ""
    level: 2
    fingerprint: d7000df8b5d560e3
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: 14) @aligntrue/ui constraints
    content: ""
    level: 2
    fingerprint: 5ba63edabc6bdbaf
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Forbidden
    content: |-
      - Importing asset files (`.svg`, `.png`, `.jpg`, `.jpeg`, `.gif`, `.webp`, etc.)
      - Using `require()` for assets
      - Relying on Next.js loaders or bundler specific behavior
    level: 3
    fingerprint: 43ed5c457b799abe
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Required
    content: |-
      - Inline SVGs as JSX
      - Images as data URIs if needed
      - Theming driven by CSS variables
      - TypeScript and React only
    level: 3
    fingerprint: d0a3630555bbec7f
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Implementation guidelines
    content: |-
      - Read the relevant sections before coding
      - For JSON outputs, always use `canonicalJson` and `stableHash` where determinism is required
      - Write acceptance style tests linked to the specs above
      - Document discretionary choices inline
      - For UI changes, keep to the zero build and no asset import constraints

      ---
    level: 2
    fingerprint: 55d074c7e2a01b6c
    vendor:
      aligntrue:
        source_scope: implementation_specs
        source_file: .cursor/rules/implementation_specs.mdc
        last_modified: 2025-11-17T15:48:25.055Z
  - heading: Related rules
    content: |-
      - `testing.mdc` - Test decision framework and TDD workflow
      - `debugging.mdc` - Systematic debugging when tests reveal issues
      - `me.mdc` - Effort sizing and communication standards
    level: 2
    fingerprint: d6143f7b73c07b21
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Error resolution lessons learned
    content: ""
    level: 2
    fingerprint: 50dd2959d3758563
    vendor:
      aligntrue:
        source_scope: error_lessons_learned
        source_file: .cursor/rules/error_lessons_learned.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Build race condition & PowerShell quoting (November 12, 2025)
    content: |-
      **Symptoms:**

      - `Cannot find module '@aligntrue/core'` (Linux/macOS)
      - `No projects matched the filters` (Windows only)
      - `Failed to resolve entry for package "@aligntrue/schema"`

      **Root Causes:**

      - Parallel build race: packages building simultaneously despite dependencies
      - PowerShell treats single quotes literally (unlike bash)
      - Dependency chain not fully sequenced

      **Patterns to Recognize:**

      1. **Module not found but package exists:** Check build ordering in `build:packages` and `typecheck` commands
      2. **Works on Unix, fails on Windows:** Look for quoted package names in pnpm filters
      3. **Build passes, typecheck fails:** Ensure identical dependency ordering in both commands

      **Fix Applied:**

      Now using Turbo with explicit filters to handle ordering:

      ```json
      "build:packages": "turbo run build --filter='./packages/*'"
      ```

      Turbo automatically respects `package.json` dependencies and parallelizes work correctly without race conditions.

      **Key Insights:**

      - Use `&&` for explicit sequential stages
      - No quotes around package names in pnpm filters
      - Test cross-platform locally with `node scripts/pre-ci.mjs`
      - "No projects matched" = quoting issue on Windows

      **Prevention:**

      - Test `-r --filter` commands locally with real package names
      - Avoid single quotes in pnpm filter names
      - Mirror build stages exactly in typecheck command
      - Monitor changes to `package.json` build scripts and package dependencies
    level: 2
    fingerprint: 6c070db2d4de5989
    vendor:
      aligntrue:
        source_scope: error_lessons_learned
        source_file: .cursor/rules/error_lessons_learned.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Windows path separators & glob output (November 13, 2025)
    content: |-
      **Symptoms:**

      - `AssertionError: expected [ Array(2) ] to deeply equal [ Array(2) ]` (Windows CI)
      - Expected: `"rules/arch.md"` (forward slashes)
      - Actual: `"rules\\arch.md"` (backslashes)

      **Root Causes:**

      - `glob` library returns OS-native path separators (backslashes on Windows)
      - Code directly uses glob output without normalizing to forward slashes
      - Local pre-CI does not catch platform-specific path issues

      **Patterns to Recognize:**

      1. **Test fails only on Windows CI, not locally (macOS/Linux):** Look for path comparisons or manipulations that assume forward slashes.
      2. **Path string mismatch (`/` vs `\`):** Indicates a platform-specific path separator issue.
      3. **Glob returns unexpected paths:** Confirm whether glob is configured to return normalized paths or OS-native paths.

      **Fix Applied:**

      ```typescript
      // Normalize to forward slashes for cross-platform consistency
      matches = matches.map((p) => p.replace(/\\/g, "/"));
      ```

      **Key Insights:**

      - Always normalize paths from external libraries (like `glob`) to a consistent format (e.g., forward slashes) for cross-platform reliability.
      - Platform-specific issues (like path separators) require testing on target platforms (e.g., Windows CI) as local pre-CI may not detect them.
      - A small `setTimeout` delay can sometimes resolve race conditions with filesystem readiness in tests (e.g., before calling `glob`).

      **Prevention:**

      - Implement a custom path normalization utility in `packages/file-utils` for all path-sensitive operations.
      - Add specific unit tests for path handling with both Windows and Unix path formats, potentially using test data with mixed separators.
      - Document path normalization conventions in `documentation.mdc` and `testing.mdc` for all developers.
      - Consider adding a Windows environment to local development or more robust CI setup that emulates Windows filesystem behavior.
    level: 2
    fingerprint: 8064fbbaef5dfb43
    vendor:
      aligntrue:
        source_scope: error_lessons_learned
        source_file: .cursor/rules/error_lessons_learned.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: File-system race conditions (TOCTOU) - CodeQL alerts (November 20, 2025)
    content: |-
      **Symptoms:**

      CodeQL alert `js/file-system-race` (High severity) on:
      - `existsSync(dir)` followed by `mkdirSync(dir)`
      - `existsSync(file)` followed by `writeFileSync(file)`
      - `existsSync(file)` followed by `unlinkSync(file)`

      **Root Causes:**

      - Time-of-check to time-of-use (TOCTOU) vulnerability (CWE-367)
      - Between check and operation, another process can modify the filesystem
      - Safe in single-threaded scenarios but fails under concurrent access (CI parallelism, shared machines)

      **Patterns to Recognize:**

      1. **`existsSync()` immediately followed by write/delete:** Check-then-operate pattern is always unsafe
      2. **Test passes locally, CodeQL flags in CI:** Local execution is single-threaded; CI parallelism exposes race
      3. **CodeQL high severity on file ops:** Real security issue, not a false positive

      **Fix Applied:**

      ```typescript
      // ❌ BEFORE (unsafe)
      if (!existsSync(dir)) {
        mkdirSync(dir);  // Another process could create dir here
      }

      // ✅ AFTER (safe)
      import { ensureDirectoryExists } from "@aligntrue/file-utils";
      ensureDirectoryExists(dir);  // Atomic, handles concurrent access
      ```

      **Key Insights:**

      - `ensureDirectoryExists()` uses `mkdirSync({ recursive: true })` which handles existing directories safely
      - `AtomicFileWriter` uses temp file + atomic rename (prevents partial writes and TOCTOU)
      - ESLint rule `no-check-then-operate` now catches these patterns before CodeQL scan

      **Prevention:**

      - Always use `ensureDirectoryExists()` from `@aligntrue/file-utils` for directory creation
      - Use `AtomicFileWriter` for all production file writes (especially user-editable files)
      - Use error handling instead of pre-checks for delete: `try { unlinkSync() } catch (e) { if (e.code !== "ENOENT") throw; }`
      - Run ESLint locally (`pnpm lint`) before pushing—it will flag check-then-operate patterns
      - CodeQL scans on every push; review High severity file-system alerts before merge
      - See `typescript.mdc` "File operations and safety" section for safe patterns
    level: 2
    fingerprint: a54c023feaeae2d8
    vendor:
      aligntrue:
        source_scope: error_lessons_learned
        source_file: .cursor/rules/error_lessons_learned.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: TypeScript development guide
    content: |-
      TypeScript rules for correctness, determinism, and AI friendly maintenance. For tests, see `testing.mdc`. For architecture, see `architecture.mdc`.

      ---
    level: 2
    fingerprint: 9c51fa0114b7519c
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Core principles
    content: |-
      1. Types first, then implementation.
      2. No `any` creep.
      3. Narrow at boundaries, stay precise inside.
      4. Prefer simple data + pure functions over classes.
      5. Fail fast with clear errors.

      ---
    level: 2
    fingerprint: b0e22c2a0d511c57
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: tsconfig baseline (required)
    content: |-
      Every project extends a strict shared config. Do not turn strictness off.

      ```json
      {
        "compilerOptions": {
          "target": "ES2022",
          "module": "ES2022",
          "moduleResolution": "bundler",
          "jsx": "react-jsx",
          "strict": true,
          "noUncheckedIndexedAccess": true,
          "exactOptionalPropertyTypes": true,
          "noImplicitOverride": true,
          "noPropertyAccessFromIndexSignature": true,
          "noFallthroughCasesInSwitch": true,
          "forceConsistentCasingInFileNames": true,
          "useUnknownInCatchVariables": true,
          "allowUnusedLabels": false,
          "importsNotUsedAsValues": "error",
          "resolveJsonModule": true,
          "skipLibCheck": true
        }
      }
      ```

      If a third party library is wrong, use `// @ts-expect-error <short reason>` on that line only.

      ---
    level: 2
    fingerprint: c8d44ecf5ffade5f
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Linting and formatting
    content: |-
      - Use `@typescript-eslint` with type aware config.
      - Enforce:
        - `no-explicit-any`
        - `no-floating-promises`
        - `no-unsafe-argument`
        - `consistent-type-imports`
        - `no-unnecessary-type-assertion`
      - Prefer Prettier as the single formatter.
      - CI must run lint with type checking.
    level: 2
    fingerprint: 65b24a74965a4ab3
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Minimal eslint config
    content: |-
      ```json
      {
        "extends": [
          "plugin:@typescript-eslint/recommended-type-checked",
          "plugin:@typescript-eslint/stylistic-type-checked"
        ],
        "parserOptions": { "project": true },
        "rules": {
          "@typescript-eslint/consistent-type-imports": [
            "error",
            { "prefer": "type-imports" }
          ],
          "@typescript-eslint/no-explicit-any": "error",
          "@typescript-eslint/no-floating-promises": "error",
          "@typescript-eslint/no-unsafe-argument": "error",
          "@typescript-eslint/no-unnecessary-type-assertion": "error",
          "@typescript-eslint/require-await": "error",
          "no-restricted-syntax": [
            "error",
            {
              "selector": "TSEnumDeclaration",
              "message": "Use unions of string literals instead of enums"
            }
          ]
        }
      }
      ```

      ---
    level: 3
    fingerprint: 3c7bbf540c870540
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Module and API boundaries
    content: |-
      - Only named exports. No default exports.
      - Barrel files only at package boundaries. Avoid deep barrels.
      - Public APIs are small and explicit.
      - Internals use relative imports within the package.
      - Use `import type` for types.

      ```typescript
      import type { User } from "./types";
      ```

      ---
    level: 2
    fingerprint: f9030885cbd21974
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: exactOptionalPropertyTypes pattern
    content: |-
      Optional means "present with value" or "not present". Never assign `undefined` directly.

      ```typescript
      interface Result {
        data: string;
        error?: string;
        metadata?: Record<string, unknown>;
      }

      // Good: omit when undefined
      const error: string | undefined = getError();
      const metadata: Record<string, unknown> | undefined = getMetadata();

      const result: Result = {
        data: "success",
        ...(error !== undefined && { error }),
        ...(metadata !== undefined && { metadata }),
      };
      ```

      Pattern: `...(value !== undefined && { key: value })` for optional fields.

      ---
    level: 2
    fingerprint: 7985ed023bce2b29
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: noUncheckedIndexedAccess pattern
    content: |-
      All indexed access is `T | undefined`. Narrow before use.

      ```typescript
      const mapping: Record<string, string> = {
        "import-cursor": "cursor",
        "import-agents": "agents-md",
      };

      const agent = mapping[context];
      if (!agent) {
        throw new Error(`Unknown context: ${context}`);
      }
      useAgent(agent);
      ```

      Use `if (!value)`, `??`, or validation helpers instead of assuming presence.

      ---
    level: 2
    fingerprint: 71fe04c8de93f7bd
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Boundary validation
    content: |-
      At all external boundaries (CLI args, env, HTTP, files):

      - Accept `unknown`.
      - Validate with a schema library (Zod or equivalent).
      - Throw small, actionable errors.

      ```typescript
      import { z } from "zod";

      const UserSchema = z.object({
        id: z.string().uuid(),
        email: z.string().email(),
        roles: z.array(z.enum(["admin", "member"])).default([]),
      });

      export type User = z.infer<typeof UserSchema>;

      export function parseUser(input: unknown): User {
        const res = UserSchema.safeParse(input);
        if (!res.success) {
          const msg = res.error.issues
            .map((i) => `${i.path.join(".")}: ${i.message}`)
            .join("; ");
          throw new Error(`Invalid user: ${msg}`);
        }
        return res.data;
      }
      ```

      Never trust raw JSON, env, or config without validation.

      ---
    level: 2
    fingerprint: a9b1050a5d9ac294
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Prefer data + functions over classes
    content: |-
      - Use plain objects and functions.
      - Use discriminated unions for states.

      ```typescript
      type Loading = { kind: "loading" };
      type Success<T> = { kind: "success"; data: T };
      type Failure = { kind: "failure"; error: string };
      type RemoteData<T> = Loading | Success<T> | Failure;

      export function fold<T, R>(
        rd: RemoteData<T>,
        fns: {
          loading: () => R;
          success: (t: T) => R;
          failure: (e: string) => R;
        },
      ): R {
        switch (rd.kind) {
          case "loading":
            return fns.loading();
          case "success":
            return fns.success(rd.data);
          case "failure":
            return fns.failure(rd.error);
          default:
            return assertNever(rd);
        }
      }

      function assertNever(x: never): never {
        throw new Error(`Unhandled case: ${JSON.stringify(x)}`);
      }
      ```

      ---
    level: 2
    fingerprint: 71cae7b9f31f35e0
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Exhaustiveness and narrowing
    content: |-
      - Always exhaust unions.
      - Use `assertNever` in default to force compiler checks.

      ```typescript
      type Shape =
        | { tag: "circle"; radius: number }
        | { tag: "rect"; w: number; h: number };

      export function area(s: Shape): number {
        switch (s.tag) {
          case "circle":
            return Math.PI * s.radius * s.radius;
          case "rect":
            return s.w * s.h;
          default:
            return assertNever(s);
        }
      }
      ```

      ---
    level: 2
    fingerprint: 3ca3788e9640b851
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Unknown over any
    content: |-
      - Use `unknown`.
      - Narrow with `typeof`, `in`, or schema parse before use.

      ```typescript
      function parseJson(input: string): unknown {
        return JSON.parse(input);
      }
      ```

      ---
    level: 2
    fingerprint: 440d951dcffca343
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Prefer unions over enums
    content: |-
      ```typescript
      export const Roles = ["admin", "member", "viewer"] as const;
      export type Role = (typeof Roles)[number];
      ```

      ---
    level: 2
    fingerprint: e3c0dec4de4d77bf
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Immutability defaults
    content: |-
      - Prefer `Readonly` and `ReadonlyArray` at edges.
      - Mutate only when needed and local.

      ```typescript
      type Point = Readonly<{ x: number; y: number }>;
      const points: ReadonlyArray<Point> = [{ x: 0, y: 0 }];
      ```

      ---
    level: 2
    fingerprint: daaed3eb9bb500c7
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: File operations and safety
    content: Avoid TOCTOU (time-of-check to time-of-use) race conditions. ESLint rule `no-check-then-operate` flags these patterns.
    level: 2
    fingerprint: 8ce1a359a2ac34a7
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Safe patterns
    content: |-
      | Operation | Pattern | Reason |
      |-----------|---------|--------|
      | Read | `readFileSync(path)` | Safe - no check needed |
      | Create dir | `ensureDirectoryExists(dir)` | Atomic, handles concurrent access |
      | Write | `new AtomicFileWriter().write(path, content)` | Atomic, no intermediate state |
      | Delete | `try { unlinkSync(path); } catch (e) { if (e.code !== "ENOENT") throw; }` | Handle file already gone |
    level: 3
    fingerprint: 0940b33ba8ddf7a7
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Unsafe patterns (avoid)
    content: |-
      ```typescript
      // ❌ TOCTOU: file could be deleted between check and write
      if (!existsSync(file)) {
        writeFileSync(file, content);
      }

      // ❌ TOCTOU: directory could be created between check and mkdir
      if (!existsSync(dir)) {
        mkdirSync(dir);
      }

      // ✅ Instead use:
      import { ensureDirectoryExists, AtomicFileWriter } from "@aligntrue/file-utils";
      ensureDirectoryExists(dir);
      const writer = new AtomicFileWriter();
      await writer.write(file, content);
      ```

      Use `ensureDirectoryExists()` and `AtomicFileWriter` from `@aligntrue/file-utils` for all production code.

      ---
    level: 3
    fingerprint: 75dafcf53600b0ab
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Error handling
    content: |-
      - Throw `Error`, not strings.
      - For expected failures, use Result style types.

      ```typescript
      type Ok<T> = { ok: true; value: T };
      type Err<E = Error> = { ok: false; error: E };
      export type Result<T, E = Error> = Ok<T> | Err<E>;

      export function toErr(e: unknown): Error {
        return e instanceof Error ? e : new Error(String(e));
      }
      ```

      ---
    level: 2
    fingerprint: e3f0972459f483bc
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Async discipline
    content: |-
      - No unhandled promises.
      - Use `no-floating-promises` in lint.
      - Fire and forget only with explicit `void` and containment.

      ```typescript
      void runBackground().catch((err) => {
        console.error("Background task failed", err);
      });
      ```

      ---
    level: 2
    fingerprint: ed02e612b658179c
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: API and component typing
    content: |-
      - All exported functions and components are typed.
      - Use `satisfies` to keep config narrow.

      ```typescript
      type Config = { region: "iad" | "dub"; retries: number };

      export const config = {
        region: "iad",
        retries: 2,
      } as const satisfies Config;
      ```

      ---
    level: 2
    fingerprint: 0b6b49724da5fd7c
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Naming and structure
    content: |-
      - Files: kebab case.
      - React components: PascalCase.
      - Functions and vars: camelCase.
      - One module per concern.
      - Tests mirror source tree.

      ```
      src/
        core/
        features/
        components/
        types/
      tests/
        core/
        features/
        components/
      ```

      ---
    level: 2
    fingerprint: 995bfb2e96ea1676
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Pitfalls to avoid
    content: |-
      - Default exports.
      - `as any` to silence errors.
      - Optional booleans. Prefer unions like `type Flag = "on" | "off"`.
      - `{}` or `object` as catch all types.
      - Wildcard barrels that hide dependencies.
      - Over generic abstractions without need.
      - Types derived from runtime data without validation.

      ---
    level: 2
    fingerprint: e1f1685235da4985
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Pre commit checklist
    content: |-
      ```bash
      tsc -p tsconfig.json --noEmit
      pnpm exec eslint . --max-warnings=0
      pnpm exec prettier -w .
      ```

      ---
    level: 2
    fingerprint: 86fb3bd53f92704d
    vendor:
      aligntrue:
        source_scope: typescript
        source_file: .cursor/rules/typescript.mdc
        last_modified: 2025-11-20T16:50:41.393Z
  - heading: Testing decision framework
    content: |-
      > Core principle: Tests must catch real bugs and enforce contracts, not add cruft.

      Use this when adding, editing, or deleting tests.

      ---
    level: 2
    fingerprint: 7e310eca726b07a4
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: External testing requirement (critical)
    content: "**All manual CLI testing must happen outside the workspace.**"
    level: 2
    fingerprint: d51b7213db883bab
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Where to test
    content: "```bash"
    level: 3
    fingerprint: c45f2192efc875f8
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: "✅ Good: outside workspace"
    content: |-
      cd /tmp
      mkdir aligntrue-manual-test-$(date +%Y%m%d)
      cd aligntrue-manual-test-*
      /path/to/aligntrue/packages/cli/dist/index.js init
    level: 2
    fingerprint: 1c97fd73be8abed7
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: "❌ Bad: inside workspace"
    content: |-
      cd /path/to/aligntrue
      mkdir test-something
      ```
    level: 2
    fingerprint: e094e4d800e102f3
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Manual test scripts
    content: |-
      - Keep in a separate testing repo or docs, not in main workspace
      - Use `/tmp` in examples
      - Do not commit manual test scripts here
      - Reference patterns in `.internal_docs/external-cli-testing.md`
    level: 3
    fingerprint: 217b18cfe3fa760b
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Integration tests
    content: |-
      - Real filesystem via temp dirs
      - Real `@aligntrue/*` imports
      - Verify actual outputs and side effects
      - Target: 80%+ coverage for core commands

      **Examples:**

      - `packages/cli/tests/integration/init-command.test.ts`
      - `packages/cli/tests/integration/sync-command.test.ts`
      - `packages/core/tests/`
    level: 3
    fingerprint: e347d082b7973c7c
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Hybrid testing strategy (CLI)
    content: AlignTrue CLI uses a mix of integration, smoke, and contract tests.
    level: 2
    fingerprint: d1168fa333731f85
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Smoke tests
    content: |-
      - Fast
      - 3 to 5 assertions per command
      - Check `--help`, argument parsing, basic wiring
      - Minimal mocking

      **Examples:**

      - `packages/cli/tests/commands/sync.test.ts`
      - `packages/cli/tests/commands/override-add.test.ts`
    level: 3
    fingerprint: 0611e96af1111e5a
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Contract tests
    content: |-
      - Public APIs, schema, exporters, core invariants
      - Stable over refactors

      **Examples:**

      - `packages/schema/tests/canonicalize.test.ts`
      - `packages/exporters/tests/cursor.test.ts`
      - `packages/core/tests/sync/`

      ---
    level: 3
    fingerprint: 832c287d7a0946ce
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Never mock internal packages (critical)
    content: Do not mock `@aligntrue/*` in our tests.
    level: 2
    fingerprint: 28e5e78c65b02c47
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Allowed mocks
    content: |-
      - External services
      - `process.exit`
      - Time or randomness for determinism
      - UI prompts
    level: 3
    fingerprint: eb5eb660f031fa87
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Delete tests that
    content: |-
      - Mock `@aligntrue/core`, `@aligntrue/schema`, etc
      - Duplicate integration coverage
      - Only assert calls on mocks

      If removing the test would not increase real bug risk, remove it.

      ---
    level: 3
    fingerprint: 52289767e0dc22ee
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Data flow and what to test
    content: ""
    level: 2
    fingerprint: ae9165319a5b9279
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Authoritative flow
    content: |-
      ```
      User files (AGENTS.md, .cursor/*.mdc, etc)
        → IR: .aligntrue/.rules.yaml (internal, generated)
        → Agent exports: .cursor/*.mdc and others
      ```
    level: 3
    fingerprint: b16e859530669d1b
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: 5 question test filter
    content: |-
      Apply in order:

      1. **Has this broken in CI or real usage?**  
         Yes → write a regression test.  
         No → go to 2.

      2. **Does it assert a clear boundary or contract?**  
         Yes → keep or add as contract test.  
         No → go to 3.

      3. **Does it duplicate coverage?**  
         Yes → delete or merge.  
         No → go to 4.

      4. **Does it test implementation details?**  
         Yes → rewrite against observable behavior or delete.  
         No → go to 5.

      5. **Is it just for coverage percentage?**  
         Yes → delete.  
         No → keep.
    level: 2
    fingerprint: e030f9eff91169c1
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Golden rule
    content: |-
      If deleting the test does not measurably increase risk of real regressions, delete it.

      ---
    level: 3
    fingerprint: eee239f188bc7e8b
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: What to keep
    content: |-
      1. **Integration tests**
         - Real workflow, temp dirs, no internal mocks

      2. **Contract tests**
         - Public APIs
         - Schema behavior
         - Deterministic outputs

      3. **Smoke tests**
         - Fast checks for each command

      4. **Critical regression tests**
         - One small test per real bug

      5. **Performance guards**
         - Loose thresholds to catch major regressions

      ---
    level: 2
    fingerprint: 1df7e13ef21c4930
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: What to avoid or delete
    content: ""
    level: 2
    fingerprint: 084e11ae61d22ecd
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Be cautious with
    content: |-
      - **Parameterized tests:**
        - Cap at 10 cases
        - Only when they clarify a real contract
      - **Edge cases:**
        - Add only for realistic or observed issues

      ---
    level: 3
    fingerprint: 4737230f82c1b347
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Test organization
    content: ""
    level: 2
    fingerprint: ee2734e54d84aa87
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Structure per package
    content: |-
      Each package maintains its own `tests/` directory with subfolders that align with the package's surface area. For example, `packages/cli/tests/` currently looks like:

      ```
      packages/cli/tests/
        commands/           # CLI command smoke and unit tests
        comprehensive/      # Charter layers and command coverage helpers
        integration/        # Real workflows and git-backed scenarios
        helpers/            # Reusable fixtures and utilities
        fixtures/           # Static files consumed by tests
        scripts/            # Shell helpers for local runs
        unit/               # Focused parsing/unit tests
        utils/              # Supporting utilities and their tests
        drift.test.ts
        workflow-detection.test.ts
        version.test.ts
      ```

      Other packages follow the same principle (`packages/core/tests/`, `packages/exporters/tests/`, `packages/schema/tests/`, etc.), so new packages should adopt a similar layout that reflects their needs.

      Per package, mirror `src/` paths when it keeps tests close to the code they exercise.

      ---
    level: 3
    fingerprint: 69b415d735330b87
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Temporary file rules (critical)
    content: All AI or test generated artifacts in repo must use `temp-` prefix.
    level: 2
    fingerprint: af587da539044dbd
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Forbidden in repo root or packages
    content: |-
      - `test_*.md`, `test-*.yaml`
      - `audit*.html`
      - `*_config.yaml` without `temp-`
      - Generic `audit.*` or `report.*` outside `artifacts/`
    level: 3
    fingerprint: 1e5e7d0442833c8e
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Permanent names only in
    content: |-
      - `examples/`
      - `artifacts/`
      - `docs/`
    level: 3
    fingerprint: 93b2c4812e02df8a
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Optional scratch
    content: |-
      ```
      .ai-scratch/
        temp-*.*
      ```

      ---
    level: 3
    fingerprint: fb8922292f8f5c66
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Local workflow
    content: ""
    level: 2
    fingerprint: 22fbf73ec5b23a69
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Pre commit
    content: |-
      - Format and lint staged files
      - Fast
    level: 3
    fingerprint: cbc9675abd4ba66d
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Pre push
    content: |-
      - Typecheck
      - Tests
      - Build (where configured)

      Bypass only when hooks are broken, not to skip validation.

      ---
    level: 3
    fingerprint: ac4c8ffd817ca00b
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Handling core format or path changes
    content: |-
      When changing core formats or paths:

      1. **Search affected tests:**

      ```bash
      grep -r "old-path-or-pattern" packages/*/tests/
      ```

      2. **Update:**
         - File paths
         - Expectations
         - Config references

      3. **Run targeted and full suites:**

      ```bash
      pnpm --filter @aligntrue/cli test
      pnpm test
      ```

      Same PR must update tests. No "fix tests later."

      ---
    level: 2
    fingerprint: bfbd192bb332830b
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Test coverage strategy
    content: |-
      Design a tight red green path covering:

      - **Determinism:** fixed seeds, stable sort, byte identical exports where relevant
      - **Boundaries:** missing files, invalid schema, corrupt data, wrong types
      - **Integration:** config loading, bundling, exporters, MCP server, CLI wiring
      - **Performance sanity:** fast unit tests by default, heavy paths behind marks

      ---
    level: 2
    fingerprint: 2e3ed04c3ab98ad0
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: TDD workflow
    content: |-
      Use TDD for new deterministic features.

      1. Write contract tests first
      2. Keep fixtures minimal and local
      3. Use temp dirs and helpers
      4. Implement only what tests require
      5. Run with `TZ=UTC` for everything
    level: 2
    fingerprint: c84b5221029cafe1
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Standard
    content: |-
      ```bash
      TZ=UTC pnpm test --silent
      TZ=UTC pnpm --filter @aligntrue/cli vitest run <file> -t "<name>"
      ```

      ---
    level: 3
    fingerprint: fe6d3468cf5c74d8
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Determinism checklist (for tests and code)
    content: |-
      - `TZ=UTC` for CI
      - No raw `Date.now()` or `Math.random()` in deterministic paths
      - Stable sort for set like arrays
      - Newlines normalized to `\n`
      - Use shared canonicalization helpers where applicable

      ---
    level: 2
    fingerprint: ee0ad47f28454d6c
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: CI quality gates
    content: |-
      CI should enforce:

      - Lint clean
      - `tsc --noEmit` clean
      - Tests green
      - No lingering `test.skip` or `test.todo` for shipped features

      ---
    level: 2
    fingerprint: a6f779fb3d4b9f8d
    vendor:
      aligntrue:
        source_scope: testing
        source_file: .cursor/rules/testing.mdc
        last_modified: 2025-11-21T03:45:32.759Z
  - heading: Global rules
    content: ""
    level: 2
    fingerprint: 62700f9580c3a311
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Vision
    content: |-
      AlignTrue is the alignment control plane. One shared, versioned rule layer that keeps AI agents, developers, product managers, and leadership operating from the same priorities. Drift becomes a signal that improves the rules. The system meets people where they work and quietly keeps everything in sync.

      **One line:** Source of truth for how you want work done, wired into every agent and workflow.

      ---
    level: 2
    fingerprint: 5944ae849448011c
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Audience
    content: ""
    level: 2
    fingerprint: adf0e0999386dae7
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Solo developers
    content: |-
      - Want repeatable, explainable agent behavior across repos and machines
      - Expect setup under 60 seconds to first export
      - Default: lockfile off, bundle off, local rules only
      - Validation via `aligntrue check` (config and schema validation)
      - Export to multiple agents (Cursor, `AGENTS.md`, VS Code MCP)
    level: 3
    fingerprint: ec5896755c5aa89e
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Teams (opt in)
    content: |-
      - Need versioned, reviewed rule sets enforced in CI
      - Enable team mode (`mode: team`) for lockfile, bundle, drift detection
      - CI validation via `aligntrue drift --gates`
      - Use git-native workflows (PR approval) without requiring cloud
      - Separate team and personal rules with flexible storage (local, repo, remote)
      - Use hierarchical scopes for monorepos
      - Migration wizards for smooth solo→team transitions

      ---
    level: 3
    fingerprint: 4d0a0d48d90e9613
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Priorities
    content: |-
      1. Determinism first: identical inputs produce identical bundles, hashes, and exports
      2. Local first: all core workflows work offline and in CI; cloud is optional
      3. Agent parity: preserve semantics across exporters; where not possible, emit clear fidelity notes
      4. Simplicity over cleverness: explicit dispatch, shallow trees, consolidated modules
      5. 80/20: prioritize changes with clear impact on trust, reliability, or adoption
      6. One way doors: format and protocol changes require an ADR style note
      7. User impact over effort: optimize for end user value, not token burn
      8. Avoid premature optimization; small refactors that prevent debt are allowed
      9. Optimize for DX: minimal configuration, clear errors, fast feedback, no unnecessary complexity
      10. With user facing features always ask: Does this give us the best possible user experience?

      ---
    level: 2
    fingerprint: c5d987870fbd2df3
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Technical approach
    content: |-
      - IR first: `.aligntrue/.rules.yaml` is the canonical IR in this repo
      - Natural markdown authoring:
        - `AGENTS.md` as primary user editable file
        - YAML frontmatter optional
        - Use headings and sections; no custom syntax required
      - Vendor bags:
        - Use `vendor.<agent>` for agent specific data
        - Exclude `vendor.*.volatile` from hashing
      - Two way sync:
        - Default IR to agents
        - `--accept-agent` for agent to IR pullback
      - Hierarchical scopes: path based rules for monorepos
      - Bundles and lockfiles:
        - Team mode writes `.aligntrue.lock.json` with pinned hashes (`.aligntrue.bundle.yaml` is forward-compatible but not yet written)
      - Examples:
        - Small, deterministic
        - No network dependencies

      Detailed specifications: `implementation_specs.mdc`.

      ---
    level: 2
    fingerprint: 5cca5c58b09962e1
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: AI maintainability doctrine
    content: |-
      All code is assumed AI edited. Design for safe, cheap future changes.

      - Prefer small modules with explicit contracts
      - Keep functions short and names predictable
      - Minimize side effects
      - Add targeted fixtures and tests near complex logic
      - Remove dead code and unnecessary indirection
      - Optimize for the best long-term solution, not effort

      ---
    level: 2
    fingerprint: cf930ca9a402b88f
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: AI assistance in Cursor
    content: |-
      When acting in this repo:

      - Define minimal interfaces and contracts first
      - Add tests second
      - Update docs only when behavior changes
      - If rules conflict, raise it and propose a resolution
      - Tighten tests when behavior is ambiguous before heavy edits
      - If stuck or looping, pause and request reassessment
      - Always check if the server is running before trying to start it.

      ---
    level: 2
    fingerprint: 0ed8f9629aa6f7fe
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Decisions and tradeoffs
    content: |-
      Before large or irreversible changes:

      - Ask clarifying questions if requirements are unclear
      - When asking questions propose at least two concrete options with:
        - Pros and cons
        - Risks
        - Why we'd choose it
      - Recommend one option with rationale based on:
        - Maintainability
        - Testability
        - Operability
        - User Experience
        - Best Long Term Solution
      - Flag one way door decisions explicitly

      Template:

      - Option A: pros, cons, effort, risks
      - Option B: pros, cons, effort, risks
      - Recommended: A or B
      - Why: short rationale

      ---
    level: 2
    fingerprint: 606f4053d9f1969b
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Deferring features
    content: |-
      When deferring:

      - Add entry to `potential_future_features.mdc`
      - Include:
        - What is deferred
        - Why
        - Current approach
        - Objective triggers to revisit

      Review when triggers are met or during phase planning.

      ---
    level: 2
    fingerprint: f45b077db75e978f
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Usability
    content: "**Defaults must work. Failures must teach.**"
    level: 2
    fingerprint: b33edbd4fa3116ad
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Error messages
    content: |-
      Each error must state:

      1. What failed (file, field, or operation)
      2. Why it failed
      3. How to fix it, with exact keys or commands

      **Bad**

      `Validation failed`

      **Good**

      `Error: missing 'profile.id' in .aligntrue/config.yaml. Add 'profile.id: "<org-or-user>"' or run 'aligntrue init'.`
    level: 3
    fingerprint: e34040ed1148e3b0
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Defaults
    content: |-
      - Provide safe defaults for common setups
      - Document defaults in `--help` and schema docs
      - Tests must prove defaults yield deterministic outputs
      - NEVER user hostile
    level: 3
    fingerprint: 0f37e81dc8d7c688
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: CLI UX
    content: |-
      - `--help` must be fast
      - Exit codes:
        - 0 ok
        - 1 validation
        - 2 user input error
        - 3 system error
      - Show progress only for long operations
      - Output should be professional and consistent
    level: 3
    fingerprint: 489094b2063ee4c7
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Trust
    content: |-
      - Do not claim unsupported parity
      - Emit fidelity notes when exports are lossy
      - Document assumptions and limitations clearly

      ---
    level: 3
    fingerprint: f796e2f28ae58117
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Success metrics
    content: |-
      - Byte identical lockfiles and exports for identical inputs
      - Under 60 seconds from `aligntrue init` to first export
      - No required network calls in core OSS workflows

      ---
    level: 2
    fingerprint: 831f5fd6a99932f3
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Code policies
    content: |-
      - No full repo or large file rewrites
      - One configuration source of truth
      - Prefer clear module boundaries over cross module state

      ---
    level: 2
    fingerprint: 1a896a08d3bc52d4
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Code style and quality
    content: |-
      - TypeScript 5 or newer, Node 20 or newer
      - Strict `tsconfig`
      - ESLint with typescript-eslint, Prettier, EditorConfig
      - Tests with Vitest or Jest
      - Test layout mirrors source layout

      See:

      - `typescript.mdc` for language rules
      - `testing.mdc` for test strategy

      ---
    level: 2
    fingerprint: dbea47ca6091fa19
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Security and privacy
    content: |-
      - Assume on prem and offline by default
      - No outbound calls in core paths
      - Telemetry is opt in via `ALIGNTRUE_TELEMETRY=on` and documented
      - Do not log secrets or PII
      - Do not commit real keys or tokens

      See `security.mdc` for details.

      ---
    level: 2
    fingerprint: 65f61c513db78b08
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Docs and exports
    content: |-
      - Each major feature should have:
        - Example in `examples/` showing config to IR to export
      - Exporters:
        - Include footer with content hash
        - Include fidelity notes when behavior is partial or lossy

      See `documentation.mdc` for documentation rules.

      ---
    level: 2
    fingerprint: e55a409b12702f58
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Communication style
    content: |-
      - Be direct and honest about limits, risks, and edge cases
      - Provide actionable details: exact flags, files, and snippets
      - State assumptions explicitly
      - Use sentence case for all titles
      - Use AlignTrue as a single word
      - Keep docs concise
      - No emojis

      ---
    level: 2
    fingerprint: e79d79b2bd399567
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: File creation guardian
    content: |-
      Before creating a file:

      1. Decide if it is:
         - Test artifact
         - Config
         - Output
         - Temporary
      2. For temporary artifacts:
         - Prefix with `temp-`
      3. For permanent files:
         - Use correct locations:
           - `packages/cli/src/` for CLI
           - `packages/*/src/` for core, schema, exporters, etc.
           - `packages/*/tests/` for tests
           - `examples/` for examples
           - `apps/docs/content/` for docs
           - `artifacts/` if configured

      Do not create:

      - `test_*.md`, `export_*.md` in root
      - Random `*_config.yaml` in root

      Use `temp-` variants instead and clean them up.

      Before declaring completion:

      - Check for stray test or export files without `temp-`
      - Run cleanup targets where available

      ---
    level: 2
    fingerprint: 6089c62dc45aabf1
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Stub Commands and Documentation
    content: |-
      Never create stub commands or "coming soon" documentation for unimplemented features:

      - Stubs confuse AI assistants who report them as missing functionality
      - "Coming soon" documentation creates false expectations
      - If a feature isn't ready, don't document it or expose it in CLI

      Instead:

      - Implement fully or don't expose at all
      - If deferring, document in internal planning docs only (`.internal_docs/`)
      - Remove any existing stubs that create confusion

      **Why this matters:** AI-driven development relies on accurate documentation. Stubs and "coming soon" notes cause AI to incorrectly report working features as broken or missing, wasting time on false issues.

      ---
    level: 2
    fingerprint: 72001e6d3a166442
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Feature completion workflow
    content: |-
      For any user facing feature:

      - Update `apps/docs/content/reference/` or `apps/docs/content/concepts/` if needed
      - Add or update examples in `examples/` if applicable
      - Add determinism tests for artifact writers if applicable
      - Update `CHANGELOG.md`
      - Delete temporary files if applicable
      - Ensure global rules here are still accurate
    level: 2
    fingerprint: 71de552ca655115e
    vendor:
      aligntrue:
        source_scope: global
        source_file: .cursor/rules/global.mdc
        last_modified: 2025-11-21T03:47:22.838Z
  - heading: Potential future features
    content: |-
      This document tracks features that were considered but explicitly deferred. Each entry includes:

      - What was deferred and why
      - Current approach or workaround
      - Clear trigger(s) that indicate when to reconsider implementation
      - Estimated effort and implementation notes

      **When to use this:** Reference when users request features or when triggers are met.

      ---
    level: 2
    fingerprint: 1ea1a48ef94b732a
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Permanently removed features
    content: ""
    level: 2
    fingerprint: 4800529c4749a33f
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Catalog as Remote Service
    content: |-
      **Status:** Permanently removed - not planned for future

      **What was removed:**

      - Remote catalog API for rule discovery
      - Catalog publishing commands (`aligntrue publish`)
      - Catalog-based source resolution
      - Centralized catalog website with search/discovery UI

      **Why removed:**

      - Added unnecessary complexity for solo and team workflows
      - Git-based sharing provides sufficient collaboration without central registry
      - Local example packs serve documentation needs adequately
      - Users prefer direct git URLs over catalog abstraction

      **Current approach:**

      - Users share rules via git repositories (GitHub, GitLab, self-hosted)
      - Example packs in `examples/packs/` provide seed data for documentation
      - Direct git URL imports via `aligntrue pull` command

      **Not planned:** Remote catalog service will not be reconsidered. All references removed from codebase.
    level: 3
    fingerprint: 69d2dcc134693176
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Growth flywheel and community ignition
    content: |-
      - Starter packs deliver instant value in common stacks
      - Golden repos with public dashboards showing before and after metrics
      - Monthly public stats: Top Aligns, new packs, top exporters, drift trends
      - RFC process in `/rfcs` with template and voting in GitHub Discussions
      - Trust metric: verified authors, adoption count by hash, testkit conformance signal
      - Community rituals: weekly “Align Friday” releases; monthly “Top Aligns” blog; `good-first-align` bounties
      - Golden repos maintenance: locked by lockfile; weekly bot PR bumps deps and regenerates exports; alert if wow-metrics regress by more than 5%

      ---
    level: 2
    fingerprint: 8da6a68c1ab820d9
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: ☁️ Cloud Strategy and Monetization (Future)
    content: |-
      **Status:** Explicitly deferred until adoption demonstrates demand.

      **Adoption Trigger:** 100+ active repos OR 25+ organizations actively using AlignTrue + clear demand signal.

      **Note:** Cloud is optional. All core workflows (init, sync, check, team mode, CI gates) stay free and OSS forever.

      **Objective:** Monetize operational convenience (sync dashboard, approvals UI, org analytics) while keeping policy enforcement and determinism tooling free forever.
    level: 2
    fingerprint: 667391df8969feb9
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Free vs Paid (Tentative Vision)
    content: |-
      | Feature                           | Free (OSS) | Paid (Cloud) |
      | --------------------------------- | ---------- | ------------ |
      | init, sync, check, export         | ✔         |              |
      | Two-way sync, watch mode          | ✔         |              |
      | Team mode, lockfiles, drift gates | ✔         |              |
      | CI validation and SARIF output    | ✔         |              |
      | Org sync dashboard                |            | ✔           |
      | Scheduled multi-repo PRs          |            | ✔           |
      | Approval workflows UI             |            | ✔           |
      | Drift analytics and trends        |            | ✔           |
      | SSO / RBAC (multi-org)            |            | ✔           |
    level: 3
    fingerprint: 9f50bc690bc8e927
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Cloud design principles (if built)
    content: |-
      - **Zero data at rest** — Cloud never stores private rules or config. Only hashes and minimal metadata.
      - **Git is source of truth** — Each org keeps rules in private repos. Cloud coordinates and verifies.
      - **Local enforcement** — All policy checks run in CI/CLI. Cloud provides visibility, not gatekeeping.
      - **Federated trust** — No org crawl without explicit scope. Repo-scoped tokens. Privacy by default.
      - **Open standards** — Use Sigstore, SLSA, SBOM. No proprietary lockdown.
    level: 3
    fingerprint: 16f509166f3bcc72
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Implementation (Deferred)
    content: |-
      - Stack: Next.js, Vercel, minimal postgres for metadata
      - Data retention: 90 days default
      - Privacy: transparent, no data sales
      - Pricing: per-org or team tier (TBD post-launch)
    level: 3
    fingerprint: e455e72a116cfe56
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Acceptance criteria
    content: |-
      - Clear demand from 25+ organizations using AlignTrue
      - Pilot program with 3 users showing measurable adoption (drift down, onboarding faster)
      - Community feedback supports the vision

      ---
    level: 3
    fingerprint: ca02a7161f884baf
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Paid offering — Cloud convenience (future)
    content: |-
      **Status:** Explicitly deferred until adoption demonstrates demand.

      **Adoption Trigger:** 100+ active repos OR 25+ organizations actively using AlignTrue + clear demand signal.

      **Note:** Cloud is optional. All core workflows (init, sync, check, team mode, CI gates) stay free and OSS forever.

      **Objective:** Monetize operational convenience (sync dashboard, approvals UI, org analytics) while keeping policy enforcement and determinism tooling free forever.
    level: 2
    fingerprint: fd62b055f4804dee
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Implementing skills
    content: |-
      Updated deets: https://chatgpt.com/share/69098bdd-8a90-8001-a52d-89553d13381c

      You are Sonnet 4.5 with full repo context. Implement “Skills” as a first-class primitive in AlignTrue, separate from Rules, Claude-compatible, deterministic, and agent-agnostic.
    level: 2
    fingerprint: 4234efac3d1658a8
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Objectives
    content: |-
      - Add a top-level `skills` config to AlignTrue (declarative).
      - Implement a lockfile with commit + hash pinning for reproducible installs.
      - Create CLI lifecycle: `install`, `lock`, `read`, `bundle`.
      - Update exporters to surface skills in `AGENTS.md` and sync to `.claude/skills/` or `.agent/skills/`.
      - Enforce spec validation for `SKILL.md` frontmatter. Note: `allowed-tools` is only enforced by Claude; treat it as advisory elsewhere.
    level: 2
    fingerprint: ea2e8f199a0c4232
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Guardrails
    content: |-
      - Non partisan posture and strict transparency

      ---
    level: 3
    fingerprint: 5dc897f81321d2ba
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: High-level plan
    content: |-
      1. **Schema**
         - Edit `packages/schema/schema/align.schema.json` to add a top-level `skills` array referencing a new `$defs.skill_source`.
         - Create `packages/schema/schema/align.skills.lock.schema.json` for `.aligntrue.skills.lock.json`.

         **Targeted addition (trimmed) — align.schema.json**

         ```json
         {
           "properties": {
             "skills": {
               "type": "array",
               "description": "Declarative list of skill sources to install.",
               "items": { "$ref": "#/$defs/skill_source" }
             }
           },
           "$defs": {
             "skill_source": {
               "type": "object",
               "required": ["id", "source"],
               "properties": {
                 "id": { "type": "string", "pattern": "^[a-z0-9-]{1,64}$" },
                 "source": { "type": "string", "format": "uri" },
                 "ref": {
                   "type": "string",
                   "description": "Tag, branch, or commit; prefer commit SHA."
                 },
                 "install": {
                   "type": "string",
                   "enum": ["project", "global", "universal"],
                   "default": "project"
                 },
                 "include": { "type": "array", "items": { "type": "string" } }
               }
             }
           }
         }
         ```

      Lockfile sketch — .aligntrue.skills.lock.json

      {
      "lock_schema_version": 1,
      "resolved": [
      {
      "id": "core-skills",
      "source": "https://github.com/anthropics/skills.git",
      "commit": "abcdef1234…",
      "install": "project",
      "skills": [
      { "name": "pdf", "path": ".claude/skills/pdf", "sha256_dir": "…" },
      { "name": "xlsx", "path": ".claude/skills/xlsx", "sha256_dir": "…" }
      ]
      }
      ]
      }

          2.	Core utilities
          •	Add packages/utils/src/hashDir.ts to SHA-256 hash a directory deterministically (stable file order, exclude vcs dirs).
          •	Add packages/core/src/skills/validate.ts to validate SKILL.md frontmatter: name and description required, allowed-tools optional; length and charset checks.
          •	Add packages/core/src/skills/discovery.ts to scan skills using this precedence and dedupe by name:
          1.	./.agent/skills/
          2.	~/.agent/skills/
          3.	./.claude/skills/
          4.	~/.claude/skills/

      Highest-priority location wins. 3. CLI
      Create new commands under packages/cli/src/commands/skills/:
      • install.ts
      • Read .aligntrue/config.yaml → skills[].
      • Resolve ref to commit (prefer SHA). If branch/tag, resolve to SHA and warn; with --force allow floating.
      • Clone/checkout into target:
      • project → .claude/skills/ (default)
      • global → ~/.claude/skills/
      • universal → .agent/skills/ (or ~/.agent/skills/ if global)
      • Validate each SKILL.md. Compute sha256_dir. Update lockfile.
      • lock.ts
      • Resolve and pin refs to SHAs without cloning content changes. Write .aligntrue.skills.lock.json.
      • read.ts
      • Output normalized SKILL.md to stdout with a header indicating base directory for references/ or scripts/. Mirrors openskills read <name>.
      • bundle.ts
      • Create deterministic tarball of installed skills + index.json with file hashes for CI distribution.
      • Add shared helpers for git checkout, hashing, frontmatter parse.
      CLI usage examples

      pnpm aligntrue skills lock
      pnpm aligntrue skills install
      pnpm aligntrue skills read pdf
      pnpm aligntrue skills bundle --out dist/skills.tgz

          4.	Exporters
          •	Update packages/exporters/src/agents-md/index.ts to inject an idempotent skills section between markers.
          •	Implement discovery + dedupe. Generate XML block with usage guidance and <available_skills>.

      Exact block to write into AGENTS.md

      <skills_system priority="1">
    level: 2
    fingerprint: 474caa3d782d1f18
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Available skills
    content: |-
      <!-- SKILLS_TABLE_START -->
      <usage>
      When users ask you to perform tasks, check if any of the available skills below can help.
      How to use skills (non-Claude agents):
      - Invoke: Bash("aligntrue skills read &lt;skill-name&gt;")
      - The skill content will load with detailed instructions
      - The base directory will be printed for resolving bundled resources
      Notes:
      - Only Claude enforces `allowed-tools` at runtime. For others, treat it as advisory policy.
      </usage>
      <available_skills>
        <!-- one line per deduped skill -->
        <!-- <skill><name>pdf</name><description>PDF toolkit…</description><location>project</location></skill> -->
      </available_skills>
      <!-- SKILLS_TABLE_END -->
      </skills_system>

          •	Add/confirm a Claude exporter (e.g., packages/exporters/src/claude/index.ts):
          •	Copy installed skills to .claude/skills/ for the chosen scope.
          •	Optionally support --universal to prefer .agent/skills/.

          5.	Docs
          •	apps/docs: Add “Skills” page with:
          •	What is a Skill vs Rule.
          •	Authoring SKILL.md frontmatter reference.
          •	Install modes: project/global/universal and precedence.
          •	Lockfile semantics and reproducibility expectations.
          •	Security note about allowed-tools.
          6.	Tests
          •	Unit: validate.ts, hashDir.ts, lockfile writer, dedupe logic.
          •	Integration: fixture repo with 2 demo skills; run skills lock → install → read → export.
          •	Golden test: AGENTS.md injection idempotency and dedupe across .agent/ and .claude/.
          •	E2E: pin to SHAs, assert identical hashes on re-install.

      Acceptance criteria
      • Adding skills to .aligntrue/config.yaml and running pnpm aligntrue skills install installs skills deterministically, writes a lockfile, and pnpm aligntrue sync exports to agents-md with the XML section and no dupes.
      • Re-running install/sync is idempotent. No spurious diffs.
      • pnpm aligntrue skills read <name> returns normalized SKILL.md and a base dir hint.
      • Lockfile pins commit SHAs and per-skill directory hashes; CI re-install reproduces identical hashes.
      • Claude exporter syncs to .claude/skills/ or .agent/skills/ based on mode.
      • All new code has unit + integration tests and passes lint/typecheck.

      Implementation notes
      • Use fast-glob with explicit allowlist for hashing; ignore .git, node_modules, editor temp files.
      • Normalize frontmatter via a single parser; serialize normalized markdown for read.
      • For AGENTS.md, wrap writes with <!-- SKILLS_TABLE_START --> and <!-- SKILLS_TABLE_END -->. On update, replace only the interior.
      • Sort skills by name ascending for stable output. In dedupe, highest-priority location wins; lower ones are ignored.
      • Make advisory policy text about allowed-tools explicit in non-Claude exporters.
      • Keep PR under ~600 LOC net change. Separate commits: schema, utils, CLI, exporters, docs, tests.

      Deliverables
      • Schema update + new lockfile schema.
      • CLI commands: skills lock, skills install, skills read, skills bundle.
      • Exporters updated for skills.
      • Docs page + examples.
      • Full test coverage for new surfaces.

      If you want a lighter “start here” prompt later, say the word and I’ll compress this into a one-screen checklist.
    level: 2
    fingerprint: dd67eebd4512da18
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: White collar wedge
    content: |-
      Target Eng/Dev Managers who want better alignment with the product teams by codifying strategy/goals/priorities in rules as a priorities.mdc.

      Make this feature 100% free as part of the corp team version.

      ⸻

      1. Conceptually viable

      Yes — alignment beyond code will become a big theme. Most white-collar work is already rule-based (strategy docs, playbooks, OKRs, compliance checklists). Turning those into deterministic, versioned “Aligns” is plausible because:
      	•	Writing and reasoning about rules is native to LLMs.
      	•	Every org struggles with drift between strategy and execution.
      	•	AI introduces compounding misalignment (each agent amplifies gaps).

      So the macro thesis — “alignment infrastructure for organizations” — is sound.

      ⸻

      2. But adoption will be nonlinear

      Stage	Likelihood	Why
      Dev & AI-ops alignment	90%	Verifiable, measurable, direct productivity gain.
      Cross-team (PM, design, docs)	60%	Feels useful if integrated into existing workflows (GitHub, Notion, Google Docs). Needs low-friction adapters.
      Org-wide cultural alignment	25–30%	Most companies resist anything that smells like “process policing.” You’ll need strong framing: insight, not surveillance.

      Realistically: devs → tech teams → ops → maybe exec layers over ~5 years.

      ⸻

      3. What makes it viable outside dev

      You’d need to translate your “rule + lock + drift” model into something that feels natural in business contexts:

      Concept	Developer version	Business version
      .aligntrue.yaml	rules for code agents	playbooks / policy snippets
      drift check	CI test	quarterly strategy review or live dashboard
      lock hash	deterministic proof	“this doc aligns with Strategy v1.3”
      SARIF findings	lint results	deltas between doc language and declared priorities

      If you hide the YAML and surface “alignment scores” or “drift trends,” it could click.

      ⸻

      4. Why it could fail

      1. No visible pain at human scale.
      Misalignment hurts slowly, so few teams will install “alignment tools.”
      You’ll need to piggyback on existing motions (PR checks, doc reviews, goal-tracking).

      2. Over-surveillance optics.
      Anything that “reads Slack” or “scores alignment” risks backlash.
      Position it as assistive clarity, not compliance monitoring.

      3. Context ambiguity.
      Natural language strategy is fuzzy. You can’t measure drift without structured context.
      The model has to enforce structure first (like Asana or Notion databases) before AI can quantify it.

      ⸻

      5. How to make it real
      	1.	Pick a single white-collar wedge.
      e.g. product requirements and engineering roadmaps alignment.
      Build a “strategy lint” that scans docs and flags contradictions with declared goals.
      	2.	Use the same primitives.
      Rules (.aligntrue.yaml), checks (regex, manifest_policy), drift scoring (hash mismatches).
      It’s the same engine, different data adapters.
      	3.	Integrate into daily tools.
      	•	PR comments → GitHub
      	•	Doc checks → Google Workspace or Notion API
      	•	Meeting notes → summary drift check
      	4.	Sell visibility, not control.
      Dashboards showing how teams interpret goals are easier to adopt than enforcement tools.

      ⸻

      6. Viability snapshot

      Dimension	Outlook
      Technical feasibility	✅ Solid (reuses AlignTrue engine)
      Market readiness	⚠️ Low near-term, rising as orgs drown in AI chaos
      Adoption friction	🔴 High — cultural resistance
      Monetization potential	🟢 Strong if you own “alignment analytics” data
      5-year TAM realism	~$1–3B if generalized as “alignment observability”


      ⸻

      TL;DR brutal version
      	•	The dev use-case is a lock.
      	•	The org-wide “AI alignment for people + policy” angle is visionary but 3–5 years early.
      	•	You’ll fail if you lead with it; you’ll win if you grow into it via developer traction.
      	•	Success depends on reframing it as clarity tooling, not compliance tooling.

      If you can make “alignment” feel like a spell check for decisions, you’ll own that category.

      ⸻

      1. Determinism in coding

      In software, determinism is literal — same inputs → same outputs, byte for byte.

      Layer	Example	How AlignTrue enforces it
      Config	.aligntrue.yaml	YAML → JSON (JCS RFC 8785) → SHA-256 hash. Anchors, timestamps, and NaN are forbidden.
      Execution	Running aln bundle or export cursor	Uses stable merge order, sorted arrays, canonical JSON, UTC timestamps, and consistent newlines.
      Verification	.aligntrue.lock.json and export footer	Recomputing hash proves that bundle == lock. Drift = any mismatch.
      Measurement	SARIF findings or lint results	Each check emits deterministic IDs and fingerprints so results are comparable across runs.

      → This makes AlignTrue deterministic by design.
      It’s mechanical, measurable, and repeatable — ideal for software because the system’s state space is discrete and bounded.

      Why it works:
      Source code, configs, and outputs are structured text. You can hash them, diff them, and verify them across time and machines.

      ⸻

      2. Determinism in white-collar work

      Outside code, determinism becomes semantic — same intent should produce the same interpretation or decision, even when expressed differently.

      Context	Deterministic equivalent	Practical signal
      Product strategy	A stable set of priorities and trade-offs	Consistent language and weighting in docs, roadmaps, and goals
      Policy / compliance	Versioned rulebook + proofs	Documents and actions referencing the same rule IDs or hashes
      Org communication	Message alignment	Consistent phrasing and emphasis across Slack, decks, and briefs

      But here, “outputs” are words, decisions, and judgments — not code.
      You can’t hash a meeting. So determinism can’t be absolute; it becomes probabilistic or linguistic determinism:

      Given the same rules and context, independent agents (people or AIs) should reach similar conclusions.

      That’s the white-collar version of “same inputs → same outputs.”

      ⸻

      3. How AlignTrue could bridge them

      Mechanism	In code	In white-collar adaptation
      Rule packs (Aligns)	YAML rules for code agents	YAML or markdown rules describing company values, decision frameworks, OKRs
      Lockfiles	.aligntrue.lock.json (hash proof)	“Strategy lock” — a signed snapshot of agreed-upon priorities or principles
      Drift checks	Compare exports to lock	Compare new docs or AI-generated text to locked priorities or guidelines
      SARIF-style findings	Lint errors, autofixes	“Strategy lints” — soft warnings like “mentions revenue but omits customer impact (priority #2)”
      Fidelity notes	“Approximation in exporter”	Transparency note: “AI summary diverges 20% from strategic weightings.”

      Essentially, AlignTrue’s determinism becomes semantic reproducibility:
      you measure how closely actions or text align to a declared rule set.

      The math shifts from:

      hash(A) == hash(B)

      to:

      similarity(A, rule_set) ≥ threshold

      Same idea — a verifiable measure of alignment — but fuzzier inputs.

      ⸻

      4. The key distinction

      Property	Coding determinism	White-collar determinism
      Nature	Binary, exact	Probabilistic, contextual
      Measurement	Hash / diff	NLP similarity / rule coverage
      Error meaning	Bug or misconfig	Drift or misunderstanding
      Proof	Cryptographic hash	Statistical or linguistic confidence
      Tool role	Enforcer	Advisor / mirror

      In software, AlignTrue can enforce determinism.
      In org work, it can only approximate and visualize it.

      ⸻

      5. What this means strategically
      	•	Short term (coding) → Determinism is a product feature. You sell trust and reproducibility.
      	•	Long term (orgs) → Determinism is a metaphor. You sell insight: “Here’s where we drifted from what we said we value.”

      You’re not building a compiler; you’re building an alignment observatory.

      ⸻

      TL;DR
      	•	Coding determinism = cryptographic reproducibility.
      	•	White-collar determinism = semantic consistency.
      	•	Both share the same goal: make alignment visible, measurable, and improvable.

      The more structured an org’s knowledge becomes, the closer it gets to the same kind of determinism that AlignTrue already guarantees for code.

      1. What “determinism” would mean outside code

      In org life, there’s no compiler. You can’t hash a meeting or unit-test a decision.
      So determinism stops meaning byte identical and starts meaning interpretation identical:

      Given the same strategy, information, and rules, two competent humans (or AIs) should make the same call most of the time.

      That’s the white-collar analog of same input → same output.

      It’s about predictable reasoning, not identical bytes.

      ⸻

      2. What’s actually deterministic in this context

      Layer	Analogue to coding	What could be deterministic	How AlignTrue could enforce it
      Strategy rules	.aligntrue.yaml	Versioned YAML or doc that encodes values, priorities, tradeoffs	Hashable strategy pack; signed by leadership
      Lockfile	.aligntrue.lock.json	A frozen snapshot of what “aligned decisions” mean at a moment in time	“Strategy lock” with checksums + signatures
      Drift checks	aln check / SARIF	Comparing new docs, plans, or decisions to that lock	NLP or embedding similarity: score % alignment
      Findings	Lint results	Specific deltas like “mentions growth but not customer impact (priority #2)”	Machine check with rule ID and evidence
      Exports	.cursor/rules	AI directives derived from strategy (“when summarizing, weigh security>speed”)	Same YAML → same AI behavior in Slack/Notion bots

      So you could think of AlignTrue for orgs as a compiler for intent:
      it takes messy language (memos, decks, goals) and checks whether they compile to the declared strategy.

      ⸻

      3. How it would feel as a knowledge worker

      Imagine your company defines a short “Strategy Align”:

      id: org/2025-priorities
      priorities:
        - name: "Customer trust first"  # weight 0.5
        - name: "Speed of delivery"     # weight 0.3
        - name: "Efficiency"            # weight 0.2
      rules:
        - id: mention-customer
          severity: MUST
          check:
            type: regex
            pattern: "(customer|user|client)"
            scope: "docs/**/*.md"
        - id: avoid-internal-jargon
          severity: SHOULD
          check:
            type: regex
            pattern: "\\bsynergy\\b|\\bparadigm\\b"
            negate: true

      Now every doc, roadmap, or slide you write is checked by an AlignTrue bot.

      You’d experience:
      	•	Inline hints: “You mentioned speed but not customer trust — add one example.”
      	•	“Alignment score: 0.82 vs last quarter’s 0.74.”
      	•	A dashboard showing which teams’ plans drift most from strategy.
      	•	PR-style suggestions for doc updates (“add customer example per rule org/2025-priorities#mention-customer”).

      It doesn’t block you; it mirrors drift — making misalignment visible the same way ESLint makes bad patterns visible.

      ⸻

      4. How it would feel as a manager or exec

      You’d see determinism as consistency and traceability across people and AI tools:

      Benefit	Example
      Stable decisions	Two teams faced with similar trade-offs make similar calls because they share the same rule pack.
      Explainable reasoning	When something diverges, you can point to “Rule X” instead of gut feelings.
      Drift metrics	Dashboards show which projects are 20% off-strategy (quantified via rule coverage).
      Version control for intent	You can see that this quarter’s “lock” changed priorities and who approved it.

      So you’d manage by alignment deltas, not opinions.

      ⸻

      5. What’s truly deterministic vs approximate

      Dimension	Coding determinism	White-collar determinism
      Data type	Code / config	Language / decisions
      State space	Finite	Infinite, fuzzy
      Verification	Hash comparison	NLP similarity score
      Tolerance	0% difference allowed	10–20% drift tolerated
      Failure	Bug	Misalignment
      Proof	Cryptographic	Statistical

      In coding, determinism is absolute.
      In white-collar, it’s statistical but trackable — like saying “this doc aligns 87% with declared goals.”

      ⸻

      6. How AlignTrue could make that usable
      	1.	Rule normalization
      Translate values, strategies, OKRs into small, testable rules (regex, embeddings, keyword coverage).
      	2.	Semantic drift scoring
      Each new artifact (doc, email, summary) gets a numeric drift score vs lock.
      	3.	Versioned intent
      Every strategy pack has a hash; any change is explicit and reviewable.
      	4.	Feedback loops
      The system highlights where human behavior diverges from declared priorities.
      (“Team A keeps trading quality for speed despite policy.”)
      	5.	AI-agent alignment
      The same rules feed into AI assistants so their writing and recommendations mirror org intent automatically.

      ⸻

      7. The lived experience of determinism here

      Role	How it feels day-to-day
      Individual	You get a “spell check for alignment.” It nudges, not nags. You understand what’s expected without meetings.
      Manager	You get objective drift metrics and versioned rationale for changes.
      Org	Culture becomes codified in small, auditable pieces. Updates to strategy are propagated like code updates.

      It’s not “AI policing language.”
      It’s AI linting reasoning — a reproducibility layer for judgment calls.

      ⸻

      8. Limits and truths
      	•	You’ll never get byte-level determinism for human work. The goal is bounded variance, not identical behavior.
      	•	The metric is confidence: “80% chance this doc follows rule pack X.”
      	•	The danger is surveillance optics — must stay opt-in, advisory, transparent.
      	•	The payoff is massive when applied internally first (product, marketing, compliance) where drift costs real money.

      ⸻

      TL;DR

      In code: determinism = same bits.
      In business: determinism = same reasoning.

      AlignTrue’s role outside coding is to give organizations:
      	•	A versioned, testable definition of “how we decide.”
      	•	A measurable way to see when real life drifts from that intent.
      	•	A feedback loop that keeps both humans and AIs interpreting strategy the same way.

      That’s what “determinism” would feel like for white-collar work —
      not mechanical repetition, but predictable alignment of judgment.
    level: 2
    fingerprint: 68915b7004797c78
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: mem0 Integration
    content: |-
      Here’s a backlog-ready cut you can drop in as a future feature.

      Feature: Optional Memory Provider (Mem0-compatible)

      Goal

      Let users opt into persistence for agents without touching AlignTrue’s deterministic path. Memory is a pluggable capability, not a requirement.

      Why
      • Agents work better when they remember repo norms and workflows.
      • Teams still need reproducible CI. Memory must be off by default and never run during validate unless explicitly requested.

      Scope
      • Add a provider-neutral capabilities.memory block to the Align spec.
      • Ship a thin client and CLI to test, seed, and search memory.
      • Export configs for MCP and Skills so Cursor or Claude can call memory tools.
      • Include advisory checks and a redaction layer.

      Non-Goals
      • No default activation.
      • No writes in CI unless --online is passed.
      • No provider lock-in.

      Spec change (non-breaking)

      capabilities:
      memory:
      provider: mem0 # future-proof. could be others later
      mode: openmemory*local # managed | self_hosted | openmemory_local
      endpoint: http://localhost:8765
      api_key_env: MEM0_API_KEY
      namespace: ${repo.name}
      default_ops: [store, search]
      policies:
      allow: ["non_sensitive_repo_facts"]
      deny_patterns: - "(?i)(password|secret|api[*-]?key)"

      Deliverables

      Area Deliverable Notes
      Schema capabilities.memory with enums and formats Backward compatible
      CLI aligntrue memory test Connectivity and auth check. Only with --online.
      aligntrue memory seed --from <globs> --namespace <ns> Extracts repo facts after redaction and stores them.
      aligntrue memory search --q "<query>" --top-k 5 Quick local debugging.
      Thin client packages/memory Minimal REST wrapper used by CLI and exporters.
      Exporters MCP client config Points to local OpenMemory or hosted Mem0 server.
      Skills tools memory.store, memory.search, memory.delete wrappers.
      Configs .env.example and memory.config.json Endpoint, namespace, redaction regexes.
      Checks memory_policy, memory_connectivity, memory_dryrun Advisory only. Gate behind --online.
      Docs “Memory is optional” guide Local-first defaults, security notes, troubleshooting.

      Security and governance
      • Deny by default. Redact PII and secrets before any store.
      • Namespaces scoped per repo or org.
      • Clear guidance for local OpenMemory first. Hosted API is optional.

      Rollout plan 1. Add schema and feature flag. 2. Implement client and CLI. 3. MCP exporter for local OpenMemory. 4. Skills exporter and config templates. 5. Advisory checks and docs.

      Risks and mitigations
      • Data leakage from careless seeding → ship deny patterns and require --online.
      • State divergence from non-determinism → default off and never in CI by default.
      • Vendor drift → provider-neutral interface and small wrapper layer.

      Acceptance criteria
      • Align file with capabilities.memory validates.
      • aligntrue memory test returns provider info when endpoint and key are set.
      • seed command shows a redaction preview and only writes with --confirm.
      • MCP export produces a working config that agents can use to add and search memory locally.
      • CI runs remain unchanged unless --online is set.
      • Docs include a one-page “turn it on” guide and a security checklist.

      Effort

      Band M. Roughly 60 to 90k tokens of implementation and docs.

      Open questions
      • Default namespace convention. Repo name only or org plus repo.
      • Retention policy and max item size.
      • Should we support read-only mode for CI smoke tests.
    level: 2
    fingerprint: d6f6d043ee283995
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Deferred features
    content: ""
    level: 2
    fingerprint: c110d6a7ada28d26
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Sigstore cryptographic signing
    content: |-
      **Deferred from:** Phase 1 verified authorship (Stage 1.4)

      **Current approach:** GitHub org validation (packs in `AlignTrue/aligns` are automatically verified)

      **Why deferred:** GitHub org validation provides sufficient trust for Phase 1. Sigstore adds complexity without clear demand signal.

      **Implementation trigger:**

      - External contributors explicitly request cryptographic verification, OR
      - 3+ incidents of disputed authorship occur, OR
      - Community consensus emerges that GitHub validation is insufficient

      **Implementation notes:**

      - Every Align would ship with `signatures/sha256-<hash>.sig` (Sigstore keyless)
      - CLI `aln verify-signature` would check signature → hash → content
      - Backward compatible: unsigned packs remain valid with warning
      - See Phase 1 spec in long_term.mdc for full design

      ---
    level: 2
    fingerprint: 89c2ef3a72218f8c
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Full registry governance (disputes and SLAs)
    content: |-
      **Deferred from:** POLICY.md governance (Stage 1.4)

      **Current approach:** Minimal viable governance with namespacing, contribution requirements, and yanking process

      **Why deferred:** No external disputes yet. Premature process creates friction without value.

      **Implementation trigger:**

      - First external dispute arises that minimal governance cannot resolve, OR
      - 10+ active external contributors participate in the registry, OR
      - Community explicitly requests formal dispute resolution process

      **Implementation notes:**

      - Add dispute resolution process with clear escalation path
      - Define maintainer response SLAs (e.g., 48h for CRITICAL, 7d for normal)
      - Establish emergency yank procedure with notification requirements
      - Consider governance working group or steering committee
      - See Phase 1 spec in long_term.mdc for CVE-style advisory system

      ---
    level: 2
    fingerprint: 817920257554ae1a
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: MCP Server Declarations
    content: |-
      **Deferred from:** Phase 2 consideration

      **Current approach:** AlignTrue generates MCP config files (`.cursor/mcp.json`, `.vscode/mcp.json`, `.mcp.json`, etc.) but does not declare or manage MCP servers.

      **Why deferred:**

      - Focus on rule management and validation first (core value prop)
      - Server lifecycle management is orthogonal to alignment enforcement
      - Security concerns (server configs often contain API keys, internal URLs)
      - Users can combine tools: Ruler for server declarations + AlignTrue for rules
      - Zero users yet - no validation that this feature is needed

      **Implementation trigger:**

      - 10+ user requests for MCP server declarations, OR
      - Clear use case where server + rules must be atomically synced, OR
      - Phase 3 team mode adoption shows need for server standardization

      **Implementation notes:**

      - Add `mcp.servers` section to config schema
      - Support command/args for local servers, url/headers for remote
      - Env var interpolation with safety guardrails (`${MCP_TOKEN}`)
      - Never store secrets in config files (env vars only)
      - No lifecycle management (don't start/stop servers)
      - Optional merge strategies (merge vs overwrite existing configs)
      - See `docs/mcp-scope.md` for detailed rationale

      **Complementary tools:**

      - **Ruler:** MCP server infrastructure and declarations
      - **AlignTrue:** Rule content, validation, and team alignment
      - Both can coexist without conflict

      ---
    level: 2
    fingerprint: 941620a6cd176cf1
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Additional exporter targets
    content: |-
      **Deferred from:** Phase 4

      **Current approach:** 51 exporters supporting 28 AI coding agents

      **Why deferred:** Prove "one Align to many agents" with multiple exporters. Prioritize based on demand signals.

      **Implementation trigger:**

      - Clear demand signal for specific agent (e.g., 10+ requests for new agent), OR
      - Agent vendor requests integration partnership, OR
      - Community contribution meets exporter quality standards

      **Implementation notes:**

      - Choose exporters based on adoption and request volume
      - Capability matrix per exporter as machine-readable JSON
      - Loss catalog required for all exporters
      - Target <5% loss delta across exporters on golden repos

      ---
    level: 2
    fingerprint: 9bbea299996f017f
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: AI-Assisted Rule Organization
    content: |-
      **Deferred from:** Coverage assessment (November 2025)

      **Current approach:** Manual categories and tags in catalog. Users organize rules themselves.

      **Why deferred:**

      - Core authoring workflow works well without AI assistance
      - No demand signal yet from users struggling with taxonomy
      - Build foundation first, add AI polish when pain is clear
      - Zero users yet - no validation that this feature is needed

      **Implementation trigger:**

      - 10+ user requests for auto-categorization, OR
      - Users report taxonomy fatigue or inconsistency, OR
      - Phase 4.5 polish iteration prioritizes this feature

      **Implementation notes (~45k tokens):**

      - Add `aligntrue organize` command with LLM-powered analysis
      - Analyze existing rules and suggest categories, tags, and rule IDs
      - Interactive mode: present suggestions, user accepts/rejects
      - Auto-generate rule IDs following dot-notation conventions
      - Batch operations: organize entire rule sets at once
      - Integration with markdown authoring for seamless workflow
      - Consider local LLM option for privacy (ollama, llamafile)

      **User experience:**

      ```bash
    level: 2
    fingerprint: af87f02c312acd55
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Analyze existing rules and suggest organization
    content: aligntrue organize --suggest
    level: 2
    fingerprint: 682b2e13a2a7a92d
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Apply suggestions interactively
    content: aligntrue organize --interactive
    level: 2
    fingerprint: 2e78881249320c7b
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Auto-organize with defaults
    content: |-
      aligntrue organize --auto
      ```

      **Quality guardrails:**

      - Always show diffs before applying
      - Require explicit confirmation for structural changes
      - Preserve user overrides and customizations
      - Log decisions for future reference

      ---
    level: 2
    fingerprint: fee6074d6de1dca5
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Enhanced agent-specific configuration
    content: |-
      **Deferred from:** Coverage assessment (November 2025)

      **Current status:** Basic export options exist (`export.mode_hints`, `performance` config)

      **Current approach:** Global configuration with minimal per-agent customization

      **Why deferred:**

      - Foundation exists and covers 80% of use cases
      - No demand signal for advanced per-agent settings
      - Better to document existing capabilities first

      **Implementation trigger:**

      - 10+ user requests for per-agent customization, OR
      - Specific agent requires unique configuration (timeouts, paths, formats), OR
      - Phase 4.5 polish iteration identifies this as high-impact

      **Implementation notes (~15k tokens):**

      - Document existing `export.mode_hints.overrides` and `performance` options
      - Extend config schema with per-agent sections:

        ```yaml
        exporters:
          - cursor
          - agents-md

        exporter_config:
          cursor:
            timeout_ms: 5000
            token_limit: 8000
            output_path: .cursor/rules/custom.mdc
          agents-md:
            format: extended
            include_metadata: true
        ```

      - Add validation for agent-specific settings
      - Update documentation with examples
      - Consider agent capability matrix for smart defaults

      **Documentation priority:**

      - README section highlighting current customization options
      - Config reference with all available settings
      - Examples for common use cases

      ---
    level: 2
    fingerprint: 41c242d8736e62c7
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Homebrew installation
    content: |-
      **Deferred from:** Coverage assessment (November 2025)

      **Current approach:** npm/pnpm only (Node ecosystem)

      **Why deferred:**

      - npm covers majority of target users (TypeScript/JavaScript developers)
      - No demand signal from non-Node users
      - Can ship quickly when needed

      **Implementation trigger:**

      - 10+ requests from Python/Ruby/Go developers, OR
      - Adoption metrics show friction from npm-only install, OR
      - Community contributor offers to maintain Homebrew tap

      **Implementation notes (~20k tokens):**

      - Create Homebrew tap repository: `AlignTrue/homebrew-tap`
      - Formula for `aligntrue` CLI pointing to npm package
      - Standard Homebrew formula structure:

        ```ruby
        class Aligntrue < Formula
          desc "AI-native rules and alignment platform"
          homepage "https://aligntrue.ai"
          url "https://registry.npmjs.org/@aligntrue/cli/-/cli-X.Y.Z.tgz"
          sha256 "..."

          depends_on "node"

          def install
            system "npm", "install", *std_npm_args
            bin.install_symlink Dir["#{libexec}/bin/*"]
          end
        end
        ```

      - CI automation for formula updates on npm releases
      - Installation docs: `brew install aligntrue/tap/aligntrue`
      - Consider official Homebrew core submission after validation

      **Alternative:** Simple shell script installer as interim solution

      ---
    level: 2
    fingerprint: 84e56cf5f2dac2a8
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Tool-Specific Migration Converters
    content: |-
      **Deferred from:** Coverage assessment (November 2025)

      **Current approach:** Users manually copy/paste from existing agent files into AGENTS.md, then sync

      **Why deferred:**

      - Import functionality was removed (users author AGENTS.md directly)
      - No clear demand for automated migration converters
      - Manual copy/paste covers most migration needs
      - Focus on natural markdown authoring instead

      **Implementation trigger:**

      - 10+ requests for specific tool migration (e.g., "migrate from Ruler"), OR
      - Clear user pain with manual migration process, OR
      - Partnership with tool vendor for migration path

      **Implementation notes (~60k tokens):**

      - Add `aligntrue migrate --from=<tool>` command
      - Tool-specific adapters in `packages/cli/src/migrations/`
      - Supported tools by priority:
        1. Ruler (.rulerrc, ruler.yaml)
        2. Legacy .cursorrules files
        3. Custom .airc or similar formats
        4. IDE-specific settings (VS Code, IntelliJ)
      - Migration report showing coverage and manual steps
      - Preserve original files with `.backup` suffix
      - Interactive mode for ambiguous conversions

      **Quality requirements:**

      - 90%+ automated conversion rate for common patterns
      - Clear documentation of manual steps for remaining 10%
      - Validation of migrated rules before applying
      - Rollback capability if migration fails

      ---
    level: 2
    fingerprint: 8b591ff2cdf6cc2a
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Additional package manager support
    content: |-
      **Deferred from:** Coverage assessment (November 2025)

      **Current approach:** npm/pnpm (and potentially Homebrew)

      **Why deferred:**

      - npm + Homebrew covers 90%+ of target users
      - Diminishing returns for additional package managers
      - Maintenance burden increases with each manager

      **Implementation trigger:**

      - Specific user base requests it (e.g., Python community wants pip), OR
      - Adoption metrics show significant friction from missing package manager, OR
      - Community contributor offers to maintain package

      **Implementation notes (80k tokens total):**

      **pip wrapper (~25k tokens):**

      - Simple Python wrapper around npm package
      - Published to PyPI as `aligntrue`
      - Handles Node.js dependency installation
      - Alternative: npx-based launcher

      **apt PPA (~30k tokens):**

      - Debian/Ubuntu package repository
      - `.deb` package with bundled Node.js binary
      - Automatic updates via apt
      - Requires signing key and repository hosting

      **Docker image (~15k tokens):**

      - Official Docker Hub image
      - Pre-installed with Node.js and CLI
      - Useful for CI environments
      - Volume mounts for workspace access

      **asdf plugin (~10k tokens):**

      - Version management integration
      - Community-maintained alternative
      - Lower maintenance burden

      **Priority order:** Homebrew → pip wrapper → Docker → asdf → apt PPA

      ---
    level: 2
    fingerprint: 51fcf1dae767d631
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Deferred technical improvements
    content: This section tracks technical refactoring and infrastructure improvements deferred to Phase 4.5 or later. Items here require a stabilized codebase and should be reviewed when triggers occur.
    level: 2
    fingerprint: ce0ab501de0bb0ea
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Atomic writing abstraction
    content: |-
      **Deferred from:** Foundation cleanup review

      **Current approach:** AtomicFileWriter used directly in 46 files with slight variations

      **Why deferred:** Current pattern is safe and works well. Premature abstraction without usage pain.

      **Implementation trigger:**

      - Pattern becomes problematic (errors, inconsistencies), OR
      - Phase 4.5 stabilization review prioritizes this, OR
      - Adding 20+ new file write sites with different patterns

      **Implementation notes (~3k tokens):**

      - Create `packages/file-utils/src/safe-writer.ts`
      - Function: `writeFileSafe(path: string, content: string, options: WriteOptions): Promise<void>`
      - Built-in dry-run support, standardized error messages
      - Gradually migrate 46 call sites

      ---
    level: 2
    fingerprint: 6e274106ff921538
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Validation logic centralization
    content: |-
      **Deferred from:** Foundation cleanup review

      **Current approach:** Schema validation fairly centralized in packages/schema

      **Why deferred:** Already well-organized. Low ROI for further consolidation.

      **Implementation trigger:**

      - Validation logic becomes scattered across 5+ packages, OR
      - Duplicate validation rules found in multiple locations, OR
      - Phase 4.5 review identifies validation inconsistencies

      **Implementation notes (~5k tokens):**

      - Create `packages/core/src/validation/` directory
      - Consolidate: `validateRules()`, `validateConfig()`, `validateLockfile()`
      - Single source of truth for business rules

      ---
    level: 2
    fingerprint: 27e31029c711da0b
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Build/CI Optimization
    content: |-
      **Deferred from:** Foundation cleanup review

      **Current approach:** Simple pnpm recursive scripts, sequential builds

      **Why deferred:** No performance issues yet. Build times acceptable.

      **Implementation trigger:**

      - Build times exceed 5 minutes, OR
      - 15+ packages in workspace, OR
      - CI costs become significant

      **Implementation notes (~5k tokens):**

      - Evaluate Turborepo for build caching
      - Parallelize package builds where dependencies allow
      - Add build-time dependency analysis
      - Incremental TypeScript compilation

      ---
    level: 2
    fingerprint: 95a6ff24d0a24a33
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Mode hints optional enhancements
    content: |-
      **Deferred from:** Phase 2 Stage 1 (Step 9a)

      **Status:** Core mode hints functionality complete. Optional polish deferred.

      **Deferred items:**

      - Step 9d: Enhanced import parser with marker pairing (~1.5k tokens)
      - Step 9e: Validate command with 9 checks (~2.5k tokens)
      - Step 9f: Documentation updates (~0.5k tokens)
      - Step 9g: Integration testing (~1k tokens)

      **Why deferred:** Core mode hints experiment complete and production-ready. Optional features await user feedback.

      **Implementation trigger:**

      - 10+ user requests for enhanced mode validation, OR
      - Import from AGENTS.md with mode markers shows parser issues, OR
      - Phase 4.5 review prioritizes mode hints polish

      **Total effort if implemented:** ~5.5k tokens

      ---
    level: 2
    fingerprint: f7e83b33c79a6b27
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Execution modes and conditional rules
    content: |-
      **Deferred from:** Phase 2 planning discussion (execution modes feedback)

      **Current approach:** Static rule exports with hierarchical scopes and applies_to patterns for basic file-based filtering. Phase 2 includes a lightweight mode hints experiment (~6k tokens) to validate demand before considering any investment in execution modes infrastructure.

      **Why deferred:** Architecturally sound concept but operationally heavy for current phase. Requires significant infrastructure (conditions engine, loader integration, agent cooperation) without clear user demand yet.

      **Implementation trigger:**

      - 10+ user requests specifically for conditional rule execution (not just file-based filtering), OR
      - Phase 2 adoption reaches 50+ repos showing need for conversation-aware rule injection, OR
      - Agent vendors (Cursor, VS Code, etc.) expose APIs for runtime rule injection

      **Implementation notes:**

      **Schema Extensions (~20k tokens):**

      - Add `mode` field: `"always" | "manual" | "intelligent"` with intelligent as default
      - Add `conditions` DSL for deterministic triggers:
        ```yaml
        conditions:
          all:
            - language_any: ["typescript", "javascript"]
            - not:
                any:
                  - path_glob_any: ["**/*.test.*", "**/__tests__/**"]
                  - text_matches_any:
                      - pattern: "console\\.log\\("
                        flags: ["i"]
          budget_tokens: 120 # per-rule token limit
        ```
      - Profile-level caps: `max_rule_tokens: 1600`, `max_active_rules: 30`

      **Loader Responsibility (~40k tokens):**

      - AlignTrue becomes the "loader" that enforces execution policies
      - Preprocessor model: Evaluate conditions at sync time, export only matching rules
      - Runtime integration: MCP server or agent extensions for conversation-aware injection
      - Conflict resolution: severity wins, last-writer-wins, token budget enforcement

      **Manual Invocation UX (~10k tokens):**

      - CLI: `aligntrue apply <rule-id>` or `aligntrue apply --tag logging`
      - Agent palette: "AlignTrue: Apply rule..." commands
      - Chat triggers: `/align <rule-id>` in agent conversations

      **AGENTS.md Round-trip (~5k tokens):**

      - HTML comment markers for machine-parseable sections:
        ```html
        <!-- aligntrue:begin id="base.no-console" mode="intelligent" severity="error" -->
        ### No console in production Use `src/lib/logger.ts` instead.
        <!-- aligntrue:end id="base.no-console" -->
        ```
      - Enables bidirectional sync while preserving human readability

      **Security & Trust (~5k tokens):**

      - Sign rule packs, verify on load, allowlist sources
      - Audit trail of injected content hashes
      - Redact sensitive data in logs

      **Testing Requirements:**

      - Golden tests: Assert active rule sets and token counts for various repo contexts
      - Snapshot tests: Exported files match fixtures with conditional logic
      - Conflict tests: Severity tie-breaking and budget enforcement
      - Performance tests: Cold/warm cache evaluation times

      **Tradeoffs:**

      - **Pro:** Solves the core problem of LLM context bloat without requiring agent cooperation
      - **Pro:** Deterministic and testable (unlike prompt-based approaches)
      - **Con:** Significant complexity increase (~80k+ tokens for full implementation)
      - **Con:** Requires agent APIs for runtime effectiveness (preprocessor model as Phase 2.5 compromise)
      - **Risk:** Agent vendors may not expose necessary hooks, limiting runtime capabilities

      ---
    level: 2
    fingerprint: 80b56ef3cbc93563
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Conditional features (trigger-based)
    content: ""
    level: 2
    fingerprint: f60c717ad9bca51d
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Migration framework
    content: |-
      **Status:** Not implemented - Waiting for trigger  
      **Trigger:** Post-1.0 schema breaking change required
    level: 2
    fingerprint: 9f1eb78d83c2d1f0
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: When to Implement
    content: |-
      **DO NOT build until:**

      - You reach 1.0 stable release, AND
      - You need to ship a breaking schema change, AND
      - User impact justifies tooling investment

      **Why conditional:**

      - Migration framework is ONLY useful for breaking schema changes
      - Without breaking changes, users can manually update YAML files
      - Building migrations speculatively is premature optimization
      - Pre-1.0, schema can iterate freely without migrations
      - Post-1.0, many products never need breaking changes
    level: 3
    fingerprint: 641bbd4c51963a89
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Scope (When Trigger Met)
    content: |-
      **Before implementation, confirm with user:**

      - What breaking change is needed and why
      - How many user repos would be affected
      - Alternative approaches considered (deprecation, aliases, additive changes)
      - Decision to proceed with migration tooling (~60k token investment)

      **Implementation:** ~60k tokens

      1. **IR Versioning System** - 10k tokens
         - `spec_version` migration logic in `packages/schema/src/migrations/`
         - Version adapter interface for schema evolution
         - Migration metadata tracking (from_version, to_version, applied_at)

      2. **Migration Framework Core** - 15k tokens
         - Pure JSON transforms (no I/O, no hashing in transforms)
         - Validation sandwich: validate input IR → transform → validate output IR
         - Deterministic, idempotent transforms only

      3. **Migration CLI** - 10k tokens
         - `aligntrue migrate --from <v> --to <v> --dry-run` (preview changes)
         - Requires `--write` flag to apply changes (safety)
         - Clear diff preview showing before/after
         - Rollback support via backup before migration

      4. **Migration Tests** - 10k tokens
         - Round-trip tests: v1 → v2 → v1 produces identical output
         - Byte-identical transforms for determinism
         - Edge case coverage: empty fields, vendor bags, nested structures
         - Golden migration vectors in `packages/testkit/`

      5. **Migration Documentation** - 5k tokens
         - Create `docs/migration-guide.md` with user-facing examples
         - API documentation in `packages/schema/README.md`
         - Troubleshooting common migration issues
    level: 3
    fingerprint: 61f49769878f3080
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Current status
    content: |-
      **No breaking changes planned.** Schema is stable through Phase 4 launch.

      If this status changes, update this section with:

      - What breaking change is needed and why
      - How many users would be affected
      - Alternative approaches considered
      - Decision to proceed with implementation

      ---
    level: 3
    fingerprint: ce6cf0dfd757288c
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Catalog add command (aligntrue add)
    content: |-
      **Deferred from:** Phase 4 catalog website completion

      **Current approach:** Manual config editing - users must manually add catalog sources to `.aligntrue/config.yaml` and run `aligntrue sync`

      **Why deferred:**

      - Catalog website built first to demonstrate vision and validate concept
      - Core catalog provider exists and can fetch packs from GitHub
      - No demand signal yet from users struggling with manual config editing
      - Focus on proving catalog discovery works before CLI integration

      **Implementation trigger:**

      - 10+ user requests for easier catalog pack installation, OR
      - Website analytics show high drop-off on install commands, OR
      - Phase 4.5 polish iteration identifies this as high-impact

      **Implementation notes (~25k tokens):**

      - Add `aligntrue add catalog:<pack-id>@<version>` command
      - Uses existing `CatalogProvider` to fetch and validate packs
      - Automatically adds source to `.aligntrue/config.yaml`
      - Runs `aligntrue sync` to generate agent files
      - Supports `--dry-run` for preview
      - Handles consent flow for catalog access

      **User experience:**

      ```bash
    level: 2
    fingerprint: 110d73ec21de3a8a
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Add a catalog pack (currently requires manual config editing)
    content: aligntrue add catalog:packs/base/base-global@1.0.0
    level: 2
    fingerprint: 7fe0afb6d4b0575d
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: "This would:"
    content: ""
    level: 2
    fingerprint: 202d6a82a1c6fef0
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: 1. Fetch pack from AlignTrue/aligns GitHub repo
    content: ""
    level: 2
    fingerprint: 0b235e6de690061d
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: 2. Add to .aligntrue/config.yaml sources array
    content: ""
    level: 2
    fingerprint: ae68bc3cd4b4d42e
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: 3. Run aligntrue sync to export to all agents
    content: ""
    level: 2
    fingerprint: 8a4d14605340cc62
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: 4. Generate .cursor/rules/base-global.mdc, AGENTS.md, etc.
    content: |-
      ```

      **Current workaround:**

      ```yaml
    level: 2
    fingerprint: 79e74db6621ca52d
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Manual addition to .aligntrue/config.yaml
    content: |-
      sources:
        - type: catalog
          id: packs/base/base-global
          version: "1.0.0"
      ```

      **Quality requirements:**

      - Byte-identical output to manual config addition
      - Clear error messages for pack not found/network issues
      - Graceful handling of consent requirements
      - Integration tests with catalog provider mocking

      ---
    level: 2
    fingerprint: fefa8d1c49a8eb2c
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Catalog website with discovery UI
    content: |-
      **Archived:** November 4, 2025  
      **Location:** `archive/apps-web/`

      **What was built:** Full Next.js catalog website with discovery page, pack detail pages, search, filters, install flow, share functionality, analytics tracking, and SEO infrastructure. Phase 4 Sessions 2-6 complete with 11 curated packs from `catalog/examples/`.

      **Why archived:** Pre-launch simplification to reduce complexity and maintenance overhead. The dual-app setup (web + docs) created:

      - Deployment coordination issues
      - Broken catalog build references (`temp-build-catalog.mjs`)
      - Heavy pre-commit hooks
      - Rewrite proxy complexity between apps
      - Unnecessary overhead for 11 packs

      **Current approach:** Static catalog page in docs site at `/catalog/available-packs` with:

      - Nextra card components for visual display
      - Collapsible markdown table for alternative view
      - Manual updates from `catalog/packs.yaml`
      - Links to GitHub source files

      **Implementation trigger:**

      - **50+ active users** request catalog discovery UI, OR
      - **20+ curated packs** exist and manual list becomes unwieldy, OR
      - **User-generated pack sharing** becomes a priority feature

      **Restoration notes (~120k tokens):**

      If restoring, consider these improvements:

      1. **Unified app approach** - Integrate catalog into docs site instead of separate app
      2. **Simplified build** - Generate catalog JSON at build time, not as separate step
      3. **No dual deployment** - Single Vercel deployment, no rewrite proxying
      4. **Lighter stack** - Use Nextra's built-in features where possible

      **Architecture (if restored):**

      ```typescript
      // apps/docs/app/catalog/[slug]/page.tsx
      // Integrate catalog routes into docs app
      // Use Nextra's MDX rendering for pack details
      // Generate static params from catalog/packs.yaml at build time
      ```

      **Build pipeline (if restored):**

      ```bash
    level: 2
    fingerprint: 7e07b7892e4d348e
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Generate catalog JSON during docs build
    content: pnpm tsx scripts/catalog/build-catalog.ts
    level: 2
    fingerprint: 411804da72997a25
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: "Output: apps/docs/public/catalog/*.json"
    content: ""
    level: 2
    fingerprint: 5d8b2b95f16f592b
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: "Consumed by: apps/docs/app/catalog/*"
    content: |-
      ```

      **Key features to preserve:**

      - Search with Fuse.js (client-side, no backend needed)
      - Category and tag filtering
      - Agent compatibility matrix
      - Install command generation
      - GitHub source linking

      **What to skip:**

      - Separate analytics tracking (use Vercel Analytics)
      - Complex share functionality (simple copy-link is enough)
      - Separate search index generation (inline in catalog JSON)

      **Estimated effort if restored:** ~120k tokens (much less than original due to lessons learned)

      **Related files:**

      - Archived code: `archive/apps-web/`
      - Catalog data: `catalog/packs.yaml` and `catalog/examples/*.yaml`
      - Build scripts: `scripts/catalog/build-catalog.ts` (still exists)
      - Current static page: `apps/docs/content/catalog/available-packs.md`

      ---
    level: 2
    fingerprint: 405dd9fb257faf47
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: User-Generated Rule Sharing Platform
    content: |-
      **Deferred from:** Phase 4 catalog completion

      **Current approach:** Curated catalog with manual PR process for pack submissions. Basic URL sharing via copy-link functionality.

      **Why deferred:** Core catalog and curated content foundation complete. User-generated sharing adds complexity and scale challenges better addressed after launch validation.

      **Implementation trigger:**

      - 50+ curated packs in catalog with demonstrated adoption, OR
      - 10+ user requests for publishing their own rules, OR
      - Community shows interest in sharing custom rule sets

      **Implementation notes:**

      **Phase 4.6: User Publishing MVP (~45k tokens)**

      - User namespace schema extensions for catalog
      - CLI `aligntrue publish` command with GitHub verification
      - Dynamic profile pages at `/catalog/@username`
      - Basic social share buttons (Twitter/X, LinkedIn)

      **Phase 4.7: Enhanced Discovery (~30k tokens)**

      - Pack adoption metrics and trending algorithms
      - User reputation system with trust scores
      - Advanced sharing with "Copy for [Agent]" buttons
      - Cross-agent compatibility matrix on pack pages

      **Phase 4.8: Social Features (~25k tokens)**

      - Rich social previews (Open Graph, Twitter Cards)
      - Pack forking and "Remix this pack" functionality
      - Share analytics and engagement tracking
      - Optional community features (comments, ratings)

      **Architecture Foundation:**

      - User packs stored in `catalog/user-packs/@username/`
      - Build-time generation of profile pages
      - GitHub ownership verification for namespaces
      - Trust scores based on GitHub activity and adoption

      **URL Structure:**

      ```
      /catalog/@username              # Profile page
      /catalog/@username/pack-name     # Pack detail
      /catalog/@username/pack-name?agent=cursor  # Agent-specific copy
      ```

      **Key Features:**

      - Cross-agent compatibility assurance (leverages existing 51 exporters)
      - Automatic profile page generation on publish
      - Social sharing with rich previews and pre-filled content
      - Easy copying based on user's IDE/agent preference

      ---
    level: 2
    fingerprint: 4a0c86d692bbfe73
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: References
    content: |-
      - Zero-users principle: `.cursor/rules/no_premature_backwards_compatibility.mdc`
      - Pre-1.0 policy: Schema can iterate freely before 1.0
      - Phase execution plans: See archive/ directory for completed phase implementation details
    level: 3
    fingerprint: 07a0b0962107485c
    vendor:
      aligntrue:
        source_scope: potential_future_features
        source_file: .cursor/rules/potential_future_features.mdc
        last_modified: 2025-11-21T17:23:54.855Z
  - heading: Security Linting Policy
    content: ""
    level: 2
    fingerprint: e6f4b7a3dc9cddc8
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: Overview
    content: This document defines when to suppress vs fix security warnings from `eslint-plugin-security` to ensure `pnpm check` only shows actionable warnings.
    level: 2
    fingerprint: bd445c462b7eebbc
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: When to Suppress
    content: ""
    level: 2
    fingerprint: c82866c69c07df10
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: 1. Safe Internal Paths
    content: |-
      **Suppress**: `security/detect-non-literal-fs-filename` for:
      - Schema files resolved from `__dirname` at build time
      - Paths from `getAlignTruePaths()` helper (all are safe internal paths)
      - Lockfile, bundle, and IR file paths (`.aligntrue/.rules.yaml`, `.aligntrue.lock.json`, etc.)
      - Test fixtures and temporary files

      **Pattern**:
      ```typescript
      // eslint-disable-next-line security/detect-non-literal-fs-filename
      // Safe: Internal schema file path, resolved from __dirname at build time (not user input)
      const configSchema = JSON.parse(readFileSync(schemaPath, "utf8"));
      ```

      **Rationale**: These paths are not user-controlled and are safe by construction.
    level: 3
    fingerprint: c8d298f44c190d5e
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: 2. Validated User Input
    content: |-
      **Suppress**: `security/detect-non-literal-fs-filename` for paths that:
      - Go through `validateScopePath()` at config load time
      - Are validated for path traversal attacks
      - Are checked for absolute paths

      **Pattern**:
      ```typescript
      // eslint-disable-next-line security/detect-non-literal-fs-filename
      // Safe: Paths from config are validated via validateScopePath() at config load time (packages/core/src/config/index.ts:662)
      content = readFileSync(sourcePath, "utf8");
      ```

      **Rationale**: Validation prevents path traversal attacks, making the path safe.
    level: 3
    fingerprint: 4683ca01df18d4d9
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: 3. Prototype Pollution Protection
    content: |-
      **Suppress**: `security/detect-object-injection` for dynamic property access that:
      - Has explicit `__proto__`, `constructor`, `prototype` checks before access
      - Uses `Object.prototype.hasOwnProperty.call()` for property checks
      - Validates keys before accessing object properties

      **Pattern**:
      ```typescript
      // eslint-disable-next-line security/detect-object-injection
      // Safe: Prototype pollution prevented by explicit __proto__/constructor/prototype checks above (lines 38-46)
      current[segment] = {};
      ```

      **Rationale**: Explicit checks prevent prototype pollution attacks.
    level: 3
    fingerprint: 80316df572ccadd0
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: 4. Static Regex Patterns
    content: |-
      **Suppress**: `security/detect-unsafe-regex` and `security/detect-non-literal-regexp` for:
      - Static regex patterns (not constructed from user input)
      - Patterns with bounded quantifiers (no nested quantifiers)
      - Patterns used for parsing known-safe formats (markdown, JSON, etc.)

      **Pattern**:
      ```typescript
      // eslint-disable-next-line security/detect-unsafe-regex
      // Safe: Static regex pattern for parsing markdown links, bounded quantifiers prevent ReDoS
      const LINK_PATTERN = /\[([^\]]+)\]\(\/docs\/([^)#]+)(?:#[^)]+)?\)/g;
      ```

      **Rationale**: Static patterns are not vulnerable to ReDoS attacks.
    level: 3
    fingerprint: 4b748154b8918b4c
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: When to Fix
    content: ""
    level: 2
    fingerprint: 22b5909a596a8f2f
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: 1. Unvalidated User Paths
    content: |-
      **Fix**: All FS operations with user-provided paths must:
      - Go through `validateScopePath()` or similar validation
      - Check for path traversal (`..`)
      - Reject absolute paths
      - Normalize paths properly

      **Example**:
      ```typescript
      // ❌ Don't do this
      readFileSync(userProvidedPath, "utf8");

      // ✅ Do this
      validateScopePath(userProvidedPath);
      readFileSync(userProvidedPath, "utf8");
      ```
    level: 3
    fingerprint: 32b0701c89248008
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: 2. Unsafe Regex from User Input
    content: |-
      **Fix**: All regex patterns constructed from user input must:
      - Validate pattern length (max 200 characters)
      - Escape special characters properly
      - Check for nested quantifiers that could cause ReDoS
      - Use `safeRegExp()` helper from `packages/core/src/security/regex-validator.ts`

      **Example**:
      ```typescript
      // ❌ Don't do this
      const regex = new RegExp(`^${userPattern}$`);

      // ✅ Do this
      if (userPattern.length > 200) {
        throw new Error("Pattern too long");
      }
      const escaped = escapeForRegex(userPattern);
      const regex = safeRegExp(`^${escaped}$`);
      ```
    level: 3
    fingerprint: b17bb260a5403447
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: 3. Unprotected Object Property Access
    content: |-
      **Fix**: All dynamic property access with user input must:
      - Check for `__proto__`, `constructor`, `prototype` before access
      - Use `Object.prototype.hasOwnProperty.call()` for property checks
      - Validate keys before accessing

      **Example**:
      ```typescript
      // ❌ Don't do this
      obj[userKey] = value;

      // ✅ Do this
      if (userKey === "__proto__" || userKey === "constructor" || userKey === "prototype") {
        throw new Error("Invalid key");
      }
      obj[userKey] = value;
      ```
    level: 3
    fingerprint: 33c33972d97700b3
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: Suppression Documentation Requirements
    content: |-
      All suppressions must include:
      1. **Rule name**: Which security rule is being suppressed
      2. **Rationale**: Why the code is safe (internal path, validated input, protection in place)
      3. **Reference**: Line numbers or function names where protection/validation occurs

      **Good example**:
      ```typescript
      // eslint-disable-next-line security/detect-non-literal-fs-filename
      // Safe: Path is typically from getAlignTruePaths().lockfile (safe internal path)
      const content = readFileSync(path, "utf8");
      ```

      **Bad example** (missing rationale):
      ```typescript
      // eslint-disable-next-line security/detect-non-literal-fs-filename
      const content = readFileSync(path, "utf8");
      ```
    level: 2
    fingerprint: 592b40ac82720240
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: ESLint Overrides
    content: |-
      For files where all operations are known-safe, use file-specific overrides in `eslint.config.js`:

      ```javascript
      {
        files: ["packages/core/src/paths.ts"],
        rules: {
          // All paths from getAlignTruePaths() are safe internal paths (not user input)
          "security/detect-non-literal-fs-filename": "off",
        },
      }
      ```

      **Use overrides for**:
      - Utility files where all paths are safe
      - Test files (if warnings are excessive)
      - Files with many safe operations where inline suppressions would be noisy
    level: 2
    fingerprint: f1d147e6c0dce794
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: Review Process
    content: |-
      Before suppressing:
      1. Verify the code is actually safe (not just convenient to suppress)
      2. Check if validation/protection exists
      3. Document the rationale clearly
      4. Consider if a fix would be better (e.g., adding validation)
    level: 2
    fingerprint: fc7d802af9f29422
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: Good Suppression
    content: |-
      ```typescript
      // eslint-disable-next-line security/detect-non-literal-fs-filename
      // Safe: Internal schema file path, resolved from __dirname at build time (not user input)
      const configSchema = JSON.parse(readFileSync(schemaPath, "utf8"));
      ```
    level: 3
    fingerprint: 4d5b2262feea991c
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: Bad Suppression (missing validation)
    content: |-
      ```typescript
      // eslint-disable-next-line security/detect-non-literal-fs-filename
      // Safe: User provided path (WRONG - needs validation!)
      const content = readFileSync(userPath, "utf8");
      ```
    level: 3
    fingerprint: e541229702ac1e6f
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: Good Fix
    content: |-
      ```typescript
      // Validate user path first
      validateScopePath(userPath);
      const content = readFileSync(userPath, "utf8");
      ```
    level: 3
    fingerprint: b4a0d02a241d4612
    vendor:
      aligntrue:
        source_scope: security-linting-policy
        source_file: .cursor/rules/security-linting-policy.mdc
        last_modified: 2025-11-21T18:17:23.414Z
  - heading: AlignTrue — Vision and Strategy Roadmap
    content: |-
      **Last updated:** Nov 12, 2025

      ---
    level: 2
    fingerprint: 93c6b12d70f48506
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: North Star and 60-Second Wow
    content: |-
      **Promise**

      Align rules across agents in 60 seconds & your team in 5 minutes.

      **Quick demo**

      ```bash
      npx aligntrue init    # Auto-detects agents, creates AGENTS.md
      aligntrue sync        # Exports to all detected agents
      ```

      **Result**

      - Rules synced to all your agents (Cursor, Copilot, Claude, VS Code MCP, etc.)
      - Edit AGENTS.md or any agent file; sync keeps them in sync
      - Team mode available: lockfiles, drift detection, CI validation

      ---
    level: 2
    fingerprint: d48cda4cf1e65411
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Positioning
    content: |-
      - **Category:** AI and org alignment control plane
      - **Starting wedge:** OSS CLI that syncs rules across agents and repos
      - **Core mechanic:** Scopes and storage policies on rules, plus bidirectional sync
      - **Signature move:** Treat drift as a signal, not a crime
      - **Promise:** Clarity in a week, compounding alignment over time

      ---
    level: 2
    fingerprint: ae3dd49affeca0d2
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: First Principles
    content: |-
      1. Clarity beats clever. Rules must be explicit, testable, and versioned.
      2. Determinism by default. Canonicalization and hashing to remove ambiguity.
      3. Two way or it did not happen. Any surface can be edited and the IR stays correct.
      4. Drift is data. Use it to update rules or fix behavior.
      5. Meet people where they work. IDEs, Linear, Slack, Docs, not a new inbox.
      6. Privacy first. Scopes and storage policies prevent leaks.

      ---
    level: 2
    fingerprint: fddad287d6560e88
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Product Thesis
    content: |-
      AI only helps when guidance is clear. Writing rules forces priorities and tradeoffs to be explicit. That clarity aligns humans and agents and removes most friction. Start with developers because they feel the pain today. Use that wedge to bring PMs, then leadership, then the whole org.

      ---
    level: 2
    fingerprint: f6ef9687a2dd345b
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Technical Invariants
    content: |-
      - **IR spec:** YAML with sections[] that each have heading, body, scope in {team, personal}, storage in {local, repo, remote:<name>, cloud}, id.
      - **Canonical form:** JCS style JSON plus SHA-256 of normalized content for stable IDs.
      - **Scope wins over heuristics:** Once a section has a scope, it cannot be auto re scoped by headings.
      - **Sync rules:** IR is complete. Exports filter by scope and storage. Lockfile contains team scope only.
      - **Safety:** In team mode, no personal with storage repo in shared repos.
      - **Status checks:** aligntrue status and aligntrue doctor show where rules live and if anything leaks.

      ---
    level: 2
    fingerprint: dcc16cc68aa38c97
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Roadmap Overview
    content: |-
      | Phase | Name              | Goal                                       | Key Outputs                                                                                            | Gate Metrics                                                               |
      | ----- | ----------------- | ------------------------------------------ | ------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------- |
      | 0     | OSS Default       | Become the obvious CLI for agent rule sync | IR v1, scope and storage, two way sync, 25+ exporters, detectors, lockfile, status, doctor, rule packs | 5k GitHub stars, 1k weekly active repos, 50% success rate on status checks |
      | 1     | Teams             | Multiplayer and governance                 | Team mode, policy inheritance, allow list, CI checks, PR annotations, audit log                        | 200 paying teams, NRR 120, CI adoption 70 percent of repos using checks    |
      | 2     | PM Bridge         | Turn PM vision into dev reality            | Linear and Jira integration, rule to backlog mapping, priority guardrails, PRD and doc checks          | 1k PM weekly users, 30 percent of merged PRs linked to rules               |
      | 3     | Org Control Plane | Central source of truth in cloud           | Workspaces, SSO, SCIM, data residency, drift dashboard, Slack and Docs add ons, scheduled scans        | 200 enterprise trials, 50 enterprise wins, NRR 130                         |
      | 4     | Platform          | Make it a standard                         | Rule pack marketplace, compliance packs, hiring signal, analytics API                                  | 10k orgs using packs, 20 percent revenue from add ons                      |
      | 5     | Civic Pilot       | Prove it beyond companies                  | Public rule spaces, candidate rule sets, citizen feedback flows                                        | 3 pilots with credible NGOs or municipalities                              |

      ---
    level: 2
    fingerprint: e300ae598503385e
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Phase 0 — OSS Default
    content: "**Objective:** Become the default way developers sync rules across agents."
    level: 2
    fingerprint: ccbf44ac3ca437c3
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Milestones
    content: |-
      - Candidate and policy rule sets
      - Drift feedback from citizens
      - Moderation and transparency features
    level: 3
    fingerprint: 43bfa168ec1b7bc3
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: 80/20 Focus
    content: |-
      - High quality official packs that save months of work
      - Two or three anchor partnerships

      ---
    level: 3
    fingerprint: 03cb691f38779c22
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Risks
    content: "- Overreach on scanning and privacy concerns"
    level: 3
    fingerprint: 37c48e35b50ae9c9
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Mitigation
    content: |-
      - Opt in scopes, transparent logs, privacy by design

      ---
    level: 3
    fingerprint: 52a6efefa2bf8bb9
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Phase 1 — Teams
    content: "**Objective:** Multiplayer alignment in repos and CI."
    level: 2
    fingerprint: d4cea4b943282753
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Phase 2 — PM Bridge
    content: "**Objective:** Let PMs encode vision, priorities, and tradeoffs that drive the backlog."
    level: 2
    fingerprint: 1cac032482a065a2
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Phase 3 — Org Control Plane
    content: "**Objective:** Cloud source of truth and cross tool checks."
    level: 2
    fingerprint: 003ba1f78e2b5e09
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Phase 4 — Platform
    content: "**Objective:** Become the standard alignment layer."
    level: 2
    fingerprint: b2983e35e32b9f69
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Phase 5 — Civic Pilot
    content: "**Objective:** Validate the model in public interest settings."
    level: 2
    fingerprint: 4261cecfcdf3e4d5
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Go To Market
    content: |-
      - **Bottom up:** OSS first, templates, quick wins, community
      - **Product led:** Free to try, checks that prove value in a week
      - **Lightweight sales:** Land teams through CI checks, expand to PMs and org
      - **Enterprise:** Control plane features, security reviews, data residency
    level: 2
    fingerprint: 6f13ec624447093b
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Pricing Spine
    content: |-
      | Tier     | For         | Price                                  | Key Value                           |
      | -------- | ----------- | -------------------------------------- | ----------------------------------- |
      | Free OSS | Individuals | Free                                   | Rule sync and core exporters        |
      | Pro      | Teams       | 6 to 12 per user per month             | CI checks, team mode, inheritance   |
      | Platform | Orgs        | 150 to 300 per user per year plus base | SSO, SCIM, drift dashboard, add ons |

      ---
    level: 3
    fingerprint: abf0e5a3e6c912ad
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Metrics That Matter
    content: |-
      - Weekly active rule checks per repo or seat
      - Percent of PRs linked to rules
      - Drift resolved within target days
      - PM adoption and depth across teams
      - NRR and team to org expansion rate

      ---
    level: 2
    fingerprint: 0243d34efc52e68a
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Brutal Analysis
    content: ""
    level: 2
    fingerprint: fc2db86d3209510e
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Strengths
    content: |-
      - Starts with a painful, concrete dev problem and ships a fast win
      - Clear path from local rules to org alignment without changing story
      - Drift as signal is a unique, compounding insight
    level: 3
    fingerprint: c5bbbeefd2a3e1e6
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Weak Spots
    content: |-
      - Incumbents can bolt on rule sync to their surfaces
      - Change management is hard if value is not obvious in week one
      - Risk of being seen as policy or OKR tooling
    level: 3
    fingerprint: 1f9c136a2a94e976
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: How to De-Risk
    content: |-
      - Be the best in class at two way sync and exporter coverage
      - Make CI checks and Slack checks obviously useful on day one
      - Speak in outcomes, not governance. Ship recipes that save time

      ---
    level: 3
    fingerprint: a85f9cac5a5af1f6
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: 80/20 per Phase
    content: |-
      - **Phase 0:** Two way sync that never loses a section. Best in class status and doctor. Exporter coverage for the top agents and IDEs.
      - **Phase 1:** CI checks that prevent real mistakes and are easy to approve. Inheritance that is simple and predictable.
      - **Phase 2:** Linear and Jira flows that help PMs steer a sprint with one view and one guardrail. No new inbox.
      - **Phase 3:** Slack and Docs checks that feel native. Drift dashboard that shows why and what to change.
      - **Phase 4:** A small set of official rule packs that set the standard. A few deep partners.
      - **Phase 5:** One credible civic pilot with clear transparency.

      ---
    level: 2
    fingerprint: bc2cab82c5114b9d
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Validation Plan and Kill Switches
    content: |-
      - **Phase 0 gates:** If two way sync stability or exporter quality stays below target after three iterations, cut long tail exporters and refocus on top five.
      - **Phase 1 gates:** If CI checks do not drive adoption, simplify checks and raise signal quality before adding features.
      - **Phase 2 gates:** If PM attach is weak, add one killer guardrail that saves a sprint. Do not build dashboards until attach is real.
      - **Phase 3 gates:** If privacy pushback rises, pivot to on prem and private indexing for checks.

      ---
    level: 2
    fingerprint: 2e9891f4a975fffe
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Naming and Messaging Options
    content: |-
      - Alignment control plane
      - Rules backbone for AI and orgs
      - Source of truth for how you want work done

      ---
    level: 2
    fingerprint: 012047e777c232b6
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: What Would Change My Mind
    content: |-
      - If incumbents ship true two way sync across agents and tools and win usage fast
      - If PM attach does not materialize after strong integrations
      - If teams resist writing rules even with clear wins

      ---
    level: 2
    fingerprint: fd7a843809d07498
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: Immediate Next Steps
    content: |-
      1. Lock IR v1 with scope and storage
      2. Finish two way sync with stable IDs and conflict rules
      3. Ship status, doctor, and CI check with helpful diffs
      4. Add Linear integration with one guardrail and one view
      5. Publish three high quality rule packs with tests
    level: 2
    fingerprint: 7d3ce649b44a7a62
    vendor:
      aligntrue:
        source_scope: vision_strategy_roadmap
        source_file: .cursor/rules/vision_strategy_roadmap.mdc
        last_modified: 2025-11-21T19:00:17.846Z
  - heading: CLI Testing Playbook
    content: |-
      **When to apply:** Use when running systematic CLI validation before releases or when explicitly asked to test the CLI. Not for routine development or debugging.

      **Goal:** Find distribution blockers and validate user workflows without maintaining a manual feature list that drifts.

      **⚠️ CRITICAL WARNING: NEVER TEST IN WORKSPACE ROOT ⚠️**

      **ALWAYS create test directories in `/tmp/` and work from there. Running CLI commands from the workspace root will detect existing `.aligntrue/` configuration and risk corrupting the user's actual setup. See "During testing" section for details.**

      ---
    level: 2
    fingerprint: 79775c67c538bda6
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Quick start
    content: ""
    level: 2
    fingerprint: 87ddbb56c40d4ec2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: AI-Driven Testing (Recommended)
    content: |-
      Use these prompts to trigger automated test execution:

      **Run all layers comprehensively:**

      ```
      Execute all 9 layers from .cursor/rules/cli_testing_playbook.mdc sequentially.
      ```

      **Run specific layer:**

      ```
      Execute Layer 1 (Smoke Tests) from .cursor/rules/cli_testing_playbook.mdc.
      ```

      Replace "Layer 1 (Smoke Tests)" with:

      - Layer 2 (Solo Golden Paths)
      - Layer 3 (Team Golden Paths)
      - Layer 3.5 (Advanced Customization)
      - Layer 4 (Command Coverage)
      - Layer 5 (Statefulness)
      - Layer 6 (Environment Matrix)
      - Layer 7 (Error & UX)
      - Layer 8 (Exploratory)
    level: 3
    fingerprint: aa00e8ade21d55c2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Manual execution (Recommended Approach)
    content: |-
      **Build first (required):**

      ```bash
      cd /Users/gabe/Sites/aligntrue
      pnpm build
      ```

      **Run all layers:**

      ```bash
      cd packages/cli
      pnpm test:comprehensive
      ```

      This runs layers 2-8 using local workspace (fast, no network).

      **Run distribution testing (Layer 1):**

      ```bash
      cd packages/cli
      pnpm test:distribution
      ```

      Tests the packaged artifact independently.

      **Run specific layer:**

      ```bash
      cd packages/cli
      pnpm test:layer 2  # Replace 2 with layer number (1-8)
      ```

      **Generate report from logs:**

      ```bash
      cd packages/cli
      pnpm test:report .internal_docs
      ```
    level: 3
    fingerprint: bd4c6c2005e6b19d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test Infrastructure
    content: |-
      **Simplified Architecture (Recommended):**

      - **Layer 1:** Distribution package testing via `test-distribution.sh`
        - Tests actual packaged artifact users receive
        - Independent execution
        - Run separately: `pnpm test:distribution`

      - **Layers 2-8:** Feature testing via local workspace
        - Uses local build (no cloning)
        - Runs in isolated `/tmp/` directories
        - Fast feedback (seconds vs minutes)
        - Automatically protected by safety guards

      **Safety Guards:**

      All layer tests automatically verify:
      - Current working directory is in `/tmp/` (isolated)
      - Test workspace is not in workspace root
      - Environment variables are properly set

      If tests run from workspace root or incorrectly configured, they fail immediately with clear error messages.

      **Why This Approach Works:**

      1. **No dogfooding interference:** Tests use isolated `/tmp/` directories, your local AlignTrue config is untouched
      2. **Fast execution:** Local builds are already cached, no cloning or rebuilding
      3. **Easy debugging:** Test directories kept for inspection, clear paths
      4. **Reliable:** No network dependencies, simple execution model
      5. **Protected:** Explicit safety checks prevent workspace corruption
    level: 3
    fingerprint: e9b8ca4caed60a2e
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test results
    content: |-
      Results are saved to:

      - `.internal_docs/TEST_LOG.md` - Comprehensive test log
      - Test directories in `/tmp/aligntrue-test-*/` - Keep for inspection or delete manually

      ---
    level: 3
    fingerprint: f1ec15f5810ba95a
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Testing approach: Hybrid strategy for real user experience"
    content: "This playbook uses a hybrid testing strategy to accurately validate user experience while maintaining fast feedback:"
    level: 2
    fingerprint: cfe23104539c2ca5
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Layer 1: Distribution package testing"
    content: |-
      - **Goal:** Test the actual packaged artifact users receive
      - **Method:** Create tarball with `pnpm pack`, install globally with `npm install -g`
      - **Why:** Catches packaging issues (missing files, wrong bin links), tests real installation flow, simulates user experience
      - **Reliability:** Works with AI terminal execution (no GitHub cloning failures)
    level: 3
    fingerprint: 146a09cc9ea1458f
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Layers 2-8: Feature testing"
    content: |-
      - **Goal:** Validate CLI commands and workflows
      - **Method:** Use local workspace directly with `pnpm exec` or PATH modifications
      - **Why:** Fast, reliable, no installation overhead, tests CLI logic thoroughly
      - **Scope:** All commands, statefulness, error handling, golden paths

      ---
    level: 3
    fingerprint: 698d54d44ba6519b
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Testing resources
    content: |-
      **Evergreen test repository:** https://github.com/AlignTrue/examples

      - Stable, versioned markdown files for integration testing
      - 11 curated example files live under the `packs/` subdirectory: `packs/global.md`, `packs/testing.md`, `packs/security.md`, `packs/debugging.md`, `packs/docs.md`, `packs/nextjs_app_router.md`, `packs/rule-authoring.md`, `packs/tdd.md`, `packs/typescript.md`, `packs/vercel_deployments.md`, `packs/web_quality.md`
      - Use for testing git source integration, caching, and bundle merging
      - Note: Files are in markdown format (`.md`), not YAML packs
      - Example config:
        ```yaml
        sources:
          - type: git
            url: https://github.com/AlignTrue/examples
            path: packs/testing.md
        ```

      **Git source troubleshooting:**

      - `Rules file not found` → Confirm the `path` includes `packs/` and matches the repo file (case-sensitive).
      - `git clone failed` → Ensure you granted consent: `aligntrue privacy grant git` (team CI may require this).
      - Missing credentials → For private forks use SSH URLs (`git@github.com:...`) and load SSH keys in CI.
      - Slow tests → Set `INTEGRATION=1` only when running network-dependent suites (see Layer 1 instructions).
      - Cache cleanup → Delete `.aligntrue/.cache/git/` when changing refs or repo URLs between tests.

      ---
    level: 2
    fingerprint: 8b219086f82712ac
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Common False Positives
    content: "When testing the CLI, these scenarios may appear as bugs but are actually working as designed:"
    level: 2
    fingerprint: 15163763a1885ff6
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Distribution Packaging
    content: |-
      **Correct behavior:** `npm install -g` from `pnpm pack` tarball fails with workspace protocol errors

      **Reality:** This is expected - `workspace:*` dependencies cannot be resolved by npm. Only `pnpm publish` auto-converts `workspace:*` to concrete versions for npm distribution.

      **Reference:** See `RELEASING.md` for proper release workflow.

      **Testing guidance:** Layer 1 uses a distribution simulation script that rewrites `workspace:*` to concrete versions, properly testing the distribution experience without actually publishing. Do not use `npm install -g` directly from `pnpm pack` tarball.
    level: 3
    fingerprint: 830e25d618a02088
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: pnpm link --global Limitation (Not a False Positive)
    content: |-
      **Issue:** `pnpm link --global` fails with `ERR_PACKAGE_PATH_NOT_EXPORTED` when workspace dependencies use subpath exports.

      **Root cause:** Node.js ESM loader cannot resolve `workspace:*` protocol through symlinks, even after building packages. This is a fundamental limitation of how pnpm workspace protocol interacts with global symlinks and Node.js module resolution.

      **Why building doesn't fix it:**
      - Building creates `dist/` directories with compiled code
      - But Node.js package resolution still looks at `package.json` files which have `workspace:*` dependencies
      - The ESM module resolution follows symlinks but can't resolve `workspace:*` references

      **Solution for automated testing (Layers 2-8):** Use absolute path to CLI binary:

      ```bash
      /path/to/workspace/packages/cli/dist/index.js command args
      ```

      **Solution for distribution testing (Layer 1):** Use the distribution simulation script that rewrites `workspace:*` to concrete versions (see Layer 1 instructions below).

      **Testing guidance:** Do NOT use `pnpm link --global` for testing. It will fail with workspace protocol errors. Always use absolute paths or the distribution simulation script.
    level: 3
    fingerprint: 2039ec013c36cca1
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Plugs and Overlays Config Persistence
    content: |-
      **False alarm:** Config-based fills/overlays not recognized after manual YAML edits

      **Reality:** Manual YAML edits must match exact schema. Use CLI commands (`plugs set`, `override add`) which validate and persist correctly.

      **Verification:** Check `.aligntrue/config.yaml` has correct YAML structure under `plugs.fills` or `overlays.overrides`.
    level: 3
    fingerprint: 6a0cfa9221c4b6bf
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Cursor Exporter Line Counts
    content: |-
      **False alarm:** .mdc files have fewer lines than AGENTS.md

      **Reality:** Both files contain identical sections. Line differences are due to metadata footers and formatting. Compare section headings (grep "^## "), not line counts.

      **Verification:** `grep "^## " AGENTS.md` vs `grep "^## " .cursor/rules/*.mdc` should match.
    level: 3
    fingerprint: 9a80cee6504e3def
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Edit Source Auto-Detection
    content: |-
      **False alarm:** Config changes to sync.edit_source not respected

      **Reality:** Auto-detection runs first and may override config if agent files exist. Check detection logic priority in sync engine.

      **Verification:** Use `--verbose` flag to see detection reasoning.
    level: 3
    fingerprint: 7985a34cd4b148fa
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Interactive vs Non-Interactive Mode Differences
    content: |-
      **False alarm:** Init with `--yes` flag doesn't prompt for Cursor files and uses AGENTS.md instead

      **Reality:** The `--yes` flag forces non-interactive mode with automatic defaults. Different from interactive mode which prompts users. Both are correct behaviors:

      - **Interactive mode** (`aligntrue init` no flags): Prompts user to choose edit source, prioritizes Cursor if files exist
      - **Non-interactive mode** (`aligntrue init --yes`): Auto-selects based on deterministic defaults (Cursor if exists, else AGENTS.md)

      **Why this matters:** CI/automation requires non-interactive mode without prompts. Users get prompted interactively by default.

      **Verification:** Compare outputs with and without `--yes` flag - both reach correct end state, just different UX.
    level: 3
    fingerprint: 7227bc6bc43707bf
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Backup Restoration with Agent Files
    content: |-
      **False alarm:** Backup doesn't include agent files or restore completes without restoring AGENTS.md

      **Reality:** Backup system includes agent files by default (stored in `agent-files/` subdirectory). Restoration includes all backed-up files.

      **Why test might appear to fail:** Test may not check the `agent-files/` subdirectory within backup, or may not verify restoration actually copied files back.

      **Verification:**

      ```bash
      ls -la .aligntrue/.backups/TIMESTAMP/agent-files/  # Should contain backed-up files
      aligntrue revert --to TIMESTAMP --yes
      ls -la AGENTS.md  # Should exist after restore
      ```

      **Reference:** See `packages/core/src/backup/manager.ts` for implementation details.

      ---
    level: 3
    fingerprint: dd798c74315bf2e5
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Critical testing principle: Understand centralized rule management"
    content: |-
      **Before testing, verify you understand:**

      1. **Centralized rule management (default):**

         AlignTrue uses a **single edit source** by default:
         - ONE file or pattern is editable (e.g., `"AGENTS.md"` or `".cursor/rules/*.mdc"`)
         - All other files are **read-only exports** with warning comments
         - One-way sync: your edit source → IR → all other formats
         - Default prevents conflicts, enforces single source of truth

         **Example configuration:**

         ```yaml
         sync:
           edit_source: "AGENTS.md"              # Single source (recommended)
           # OR
           edit_source: ".cursor/rules/aligntrue.mdc"  # Single file
           # OR
           edit_source: ".cursor/rules/*.mdc"    # Glob pattern (still single source)
         ```

         **Default behavior:**
         - If Cursor exporter is enabled → defaults to `".cursor/rules/*.mdc"`
         - Otherwise → defaults to `"AGENTS.md"`

      2. **Read-only exports:**
         - Files NOT matching `edit_source` have warning comments
         - Editing them shows warnings but changes do NOT sync back
         - This is **correct behavior** - not a bug
         - Next sync overwrites them with IR exports

      3. **Data flow:**
         - Edit your `edit_source` file
         - Run `aligntrue sync`
         - Your edits merge to `.aligntrue/.rules.yaml` (IR)
         - IR exports to all configured agents (overwriting read-only exports)
         - Result: Single source of truth, no conflicts

      **Common testing mistakes:**

      - Expecting read-only exports to sync back (they won't - that's correct)
      - Editing multiple files when only one is configured as edit_source
      - Not checking `sync.edit_source` before testing
      - Solution: Always verify which file is your edit_source before tests

      **Common testing misunderstandings:**

      - **Read-only file edited but didn't sync:** Correct behavior. Only files matching `edit_source` sync. Edit your edit_source instead.

      - **"Detected new agent files" prompt:** This appears when agent files with content are detected. Choose to enable them as export targets (content extracted to extracted-rules.md) or ignore them.

      - **Default edit_source:** When not specified, defaults based on exporters:
        - Cursor enabled → `.cursor/rules/*.mdc`
        - Otherwise → `AGENTS.md`
        - Teams or multi-file adopters can opt into `".aligntrue/rules/*.md"` for human-friendly splits; it behaves just like other edit sources.
        - To verify: Check config or run `aligntrue config list`

      4. **Experimental decentralized mode** (NOT recommended):
         - Requires `centralized: false` + array `edit_source`
         - Allows multiple editable sources with automatic merging
         - See [Experimental Features](/docs/04-reference/experimental)
         - NOT tested in standard layers (experimental only)

      **Verification before testing:**
      See [Choosing Your Edit Source](/docs/01-guides/00-edit-source) for detailed explanation and [Sync Behavior](/docs/03-concepts/sync-behavior) for technical details.

      ---
    level: 2
    fingerprint: 457865951eb05acd
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Testing charter (8 layers)
    content: Execute in order. Each layer builds on previous validation.
    level: 2
    fingerprint: 3602ed010f195fbc
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 1. Smoke / Install
    content: |-
      **What:** Test package creation and local CLI installation

      **Validate:**

      - Package creation succeeds (`pnpm pack`)
      - Tarball contents include all necessary files
      - Local installation succeeds (`pnpm link --global`)
      - `aligntrue --help` returns <1s with accurate usage
      - `aligntrue --version` shows correct version
      - First run with no config handles gracefully
      - Installed CLI is accessible from `$PATH`

      **Commands:**

      ```bash
    level: 3
    fingerprint: ab96b58cf035bc60
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Step 1: Build all workspace dependencies"
    content: |-
      cd /path/to/workspace
      pnpm build  # Builds all packages (core, exporters, schema, cli, etc.)
    level: 2
    fingerprint: 2feb2b52515077c4
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Step 2: Run distribution simulation script"
    content: |-
      cd packages/cli
      bash tests/scripts/test-distribution.sh
    level: 2
    fingerprint: 1b51768d1a2b87fb
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "This script:"
    content: ""
    level: 2
    fingerprint: 6b01da3ad750bd72
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Creates tarball with pnpm pack"
    content: ""
    level: 2
    fingerprint: fd4b3ded0db0a11e
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Extracts and rewrites workspace:* to concrete versions"
    content: ""
    level: 2
    fingerprint: 29fe02ae8072bb87
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Sets up proper NODE_PATH for testing"
    content: ""
    level: 2
    fingerprint: 03866769a25039e8
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Runs smoke tests (--help, --version, init, status)"
    content: ""
    level: 2
    fingerprint: e5ffa8fb5e5ebe79
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Reports results"
    content: ""
    level: 2
    fingerprint: 609beb1d76b7fb72
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Cleans up automatically"
    content: ""
    level: 2
    fingerprint: b3edb2c4697b36ce
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "OR for manual testing:"
    content: ""
    level: 2
    fingerprint: 5fec6173bf1aedb8
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Step 2a: Create tarball"
    content: "pnpm pack  # Creates aligntrue-cli-X.Y.Z.tgz"
    level: 2
    fingerprint: d297d7cac3428810
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Step 2b: Verify tarball contents"
    content: tar -tzf aligntrue-cli-*.tgz | grep -E "dist/|package.json" | head -20
    level: 2
    fingerprint: d0859a0e51ab87c2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Step 3: ⚠️ CRITICAL - Create test directory and work from there"
    content: |-
      cd /tmp
      TEST_DIR="aligntrue-test-$(date +%s)"
      mkdir "$TEST_DIR" && cd "$TEST_DIR"
    level: 2
    fingerprint: 8dcfbade16262eb8
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: NOW we're in a clean test directory - safe to run CLI commands
    content: ""
    level: 2
    fingerprint: 32e235902405141f
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Step 4: Use absolute path to CLI (NOT pnpm link --global)"
    content: CLI_PATH="/path/to/workspace/packages/cli/dist/index.js"
    level: 2
    fingerprint: de49ca4eeb546152
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify CLI works
    content: |-
      $CLI_PATH --version
      time $CLI_PATH --help  # Should be <1s
    level: 2
    fingerprint: 8e1e37cef1bd97b6
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test basic usage (from test directory)
    content: |-
      $CLI_PATH check  # Should handle missing config gracefully
      $CLI_PATH init --yes
      $CLI_PATH status
    level: 2
    fingerprint: 6948f9bdc86875bd
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Cleanup
    content: |-
      cd /path/to/workspace/packages/cli && rm -f aligntrue-cli-*.tgz
      rm -rf /tmp/aligntrue-test-*
      ```

      **Why:** This properly tests distribution without relying on `pnpm link --global`, which doesn't work with `workspace:*` dependencies. The distribution script simulates what `pnpm publish` does.

      **Note:** Do NOT use `pnpm link --global` - it will fail with `ERR_PACKAGE_PATH_NOT_EXPORTED`. Use absolute paths or the distribution script instead.
    level: 2
    fingerprint: 611496f412cac947
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 2. Golden Paths (Solo)
    content: |-
      **What:** Core workflows a normal solo developer does

      **Identify 3-5 primary workflows from:**

      - `packages/cli/src/commands/*.ts` - available commands
      - `apps/docs/content/` - documented workflows
      - `README.md` - quickstart examples

      **Validate for each workflow:**

      - Exact commands match docs
      - Expected outputs appear
      - Resulting files are correct
      - Idempotency where expected (running twice produces same result)

      **Example workflows:**

      - Init new project → sync to agents
      - Add pack → validate → export
      - Override rule → check changes
      - Edit AGENTS.md → sync to agents
      - Edit Cursor scope file → sync → verify round-trip to IR and other agents
      - Personal rule in remote → modify → sync → verify git operations
      - Ignore file management (auto-detection of format conflicts)
      - Backup creation and restoration on destructive operations
      - **New file detection → extract to extracted-rules.md → enable as export target**
      - **Multiple new files → extract all → enable as export targets → verify extracted-rules.md**
      - **Content deduplication → verify only unique content extracted**
    level: 3
    fingerprint: 4c0ff9fc79182b32
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Ignore file management workflow
    content: |-
      Test automatic ignore file handling and format conflict detection:

      ```bash
      cd /tmp/test-ignore-files
      aligntrue init --mode solo --yes --exporters cursor,agents
    level: 4
    fingerprint: b274800d6d1a2f30
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify init prompt/detection of format conflicts
    content: ""
    level: 2
    fingerprint: 39c7e254fd5724a6
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Expected: Cursor exporter should auto-manage ignore files to prevent duplicate rules"
    content: ""
    level: 2
    fingerprint: 54bf2ca19e5539dc
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Set manual ignore file priority (if needed)
    content: ""
    level: 2
    fingerprint: cbc85ee1be4afdae
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: aligntrue config set sync.ignore_file_priority native
    content: ""
    level: 2
    fingerprint: e060534a9b630dd5
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Sync and verify ignore files are created/managed
    content: aligntrue sync
    level: 2
    fingerprint: 503293315b09e46f
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Check for auto-generated ignore files
    content: |-
      test -f .cursor/.aligntrue.ignore || echo "FAIL: ignore file not created"
      test -f .cursor/.aligntruerc || echo "FAIL: agent config missing"
    level: 2
    fingerprint: 2b7b9f2386a132bd
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test format priority override
    content: |-
      aligntrue config set sync.ignore_file_priority custom
      aligntrue config set sync.custom_format_priority '{"agents-md":"cursor"}'
    level: 2
    fingerprint: 0d094534b448fb04
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Sync again and verify custom priority applied
    content: aligntrue sync
    level: 2
    fingerprint: 02ac80e70f4a0c89
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Verify behavior: Cursor format should be preferred when custom priority set"
    content: |-
      grep "Cursor" AGENTS.md || echo "FAIL: format priority not applied"
      ```

      **Expected:**

      - Auto-detection of format conflicts during init
      - Ignore files created in correct locations
      - Priority settings respected during sync
      - No duplicate rules across formats
    level: 2
    fingerprint: ebafbb52c790ce5c
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Backup testing workflow
    content: |-
      Test mandatory backup system and BackupManager behavior:

      ```bash
      cd /tmp/test-backups
      aligntrue init --mode solo --yes
    level: 4
    fingerprint: 1155d7ef1a52c5c0
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify backups directory exists
    content: 'test -d .aligntrue/.backups || echo "FAIL: backups directory missing"'
    level: 2
    fingerprint: 7166ba7cf85125a4
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Make a change that should trigger backup
    content: |-
      echo "### New Rule" >> AGENTS.md
      aligntrue sync
    level: 2
    fingerprint: 6050c152d2b815c2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify backup was created
    content: |-
      BACKUP_COUNT=$(ls -1 .aligntrue/.backups/ | wc -l)
      test $BACKUP_COUNT -gt 1 || echo "FAIL: backup not created for team sync"
    level: 2
    fingerprint: ac026d817f12b2d0
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test backup listing
    content: aligntrue backup list
    level: 2
    fingerprint: 9c7aa39aaab5d5fa
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test restore with preview
    content: aligntrue revert --preview
    level: 2
    fingerprint: 0e941301f9cbfc48
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test restore to specific timestamp
    content: |-
      LATEST_BACKUP=$(ls -t .aligntrue/.backups/ | head -1)
      aligntrue revert --to "$LATEST_BACKUP"
    level: 2
    fingerprint: 50ab981ccee49972
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify file was restored
    content: 'grep "### New Rule" AGENTS.md && echo "FAIL: restore didn''t revert changes" || echo "PASS: changes reverted"'
    level: 2
    fingerprint: 394b4d79f1f18dab
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test keep_count validation
    content: aligntrue config set backup.keep_count 5
    level: 2
    fingerprint: 927bea9e8e12c813
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Should fail or warn (less than minimum 10)
    content: aligntrue config set backup.keep_count 20
    level: 2
    fingerprint: 660a0a77529683dc
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Should succeed (valid range)
    content: ""
    level: 2
    fingerprint: ba9c9bad80d0bff9
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test cleanup command
    content: |-
      aligntrue backup cleanup
      ```

      **Expected:**

      - Backups created in `.aligntrue/.backups/` directory
      - Backup timestamps include process ID for uniqueness
      - Restore operations work correctly
      - keep_count validation enforces min (10) and max (100)
      - Cleanup removes old backups respecting keep_count setting
    level: 2
    fingerprint: 16b849a048053d62
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: New file detection workflow
    content: |-
      Test automatic detection and extraction of new agent files with content:

      ```bash
      cd /tmp/test-new-file-detection
      aligntrue init --mode solo --yes
    level: 4
    fingerprint: 62093d5952689d1e
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify initial state
    content: |-
      test -f AGENTS.md || echo "FAIL: AGENTS.md not created"
      aligntrue config get sync.edit_source
    level: 2
    fingerprint: 7028bda6ebd6d8bf
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 'Expected: "AGENTS.md"'
    content: ""
    level: 2
    fingerprint: d104dd0a329db63e
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Add new files with content (simulating copy/paste from online)
    content: cat > CLAUDE.md <<'EOF'
    level: 2
    fingerprint: 9db199ec7fa72fe7
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Claude-specific tips
    content: Use clear, structured prompts.
    level: 2
    fingerprint: 0168bfcf5c6803da
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Code review
    content: |-
      Review code carefully before suggesting changes.
      EOF

      mkdir -p .cursor/rules
      cat > .cursor/rules/backend.mdc <<'EOF'
    level: 2
    fingerprint: 7abada36bb6eeeb3
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Backend guidelines
    content: |-
      Use async/await for all I/O operations.
      EOF
    level: 2
    fingerprint: ca17e82aaeed2bb2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Run sync - should detect new files
    content: aligntrue sync
    level: 2
    fingerprint: 0e675a93faa3efbf
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Expected prompts:"
    content: ""
    level: 2
    fingerprint: c4efcbfc9092b5f6
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: '- "Detected files with content outside your edit source"'
    content: ""
    level: 2
    fingerprint: 60e4b5b253646046
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Shows: CLAUDE.md (2 sections), .cursor/rules/backend.mdc (1 section)"
    content: ""
    level: 2
    fingerprint: 0f600c7ba818c470
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: '- Prompt: "Enable these files as export targets?"'
    content: ""
    level: 2
    fingerprint: c4dc4fd0cc5d84b1
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Explains: existing content will be extracted to extracted-rules.md"
    content: ""
    level: 2
    fingerprint: 2ffce0f540e9361e
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: In automated test, use --yes flag to auto-enable
    content: aligntrue sync --yes
    level: 2
    fingerprint: 2b8689088731e466
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Auto-enables files as export targets
    content: ""
    level: 2
    fingerprint: 7f65ca64273f1edf
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify extraction occurred
    content: |-
      test -f .aligntrue/extracted-rules.md || echo "FAIL: extraction missing"
      grep "Extracted from: CLAUDE.md" .aligntrue/extracted-rules.md || echo "FAIL: extraction not logged"
    level: 2
    fingerprint: d38e3b2b53178c0f
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify files added to exporters (not edit_source)
    content: aligntrue config get sync.edit_source
    level: 2
    fingerprint: aa4d2162105eb064
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 'Expected: "AGENTS.md" (unchanged - NOT updated to include new files)'
    content: aligntrue config get exporters
    level: 2
    fingerprint: da29d96c2943761c
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 'Expected: ["agents-md", "claude", "cursor"] (new agents added)'
    content: ""
    level: 2
    fingerprint: a4e3261ca752c219
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify extracted content format
    content: 'grep -A 5 "Extracted from: CLAUDE.md" .aligntrue/extracted-rules.md'
    level: 2
    fingerprint: 2a90618367d94a2c
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Should show: date, section counts, extracted vs skipped"
    content: ""
    level: 2
    fingerprint: cd59d5f8a46d2652
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify deduplication (if content matches IR, should be skipped)
    content: ""
    level: 2
    fingerprint: d0ffddfd52f4bbf7
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Add file with content that already exists in IR
    content: cat > GEMINI.md <<'EOF'
    level: 2
    fingerprint: 282c85732b64830f
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Security
    content: Use parameterized queries to prevent SQL injection.
    level: 2
    fingerprint: 5d2d3ceb7abe5523
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: (Assuming "Security" section already exists in AGENTS.md/IR)
    content: aligntrue sync --yes
    level: 2
    fingerprint: c6194105f9c03bee
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Should extract GEMINI.md but skip "Security" section (duplicate)
    content: 'grep -A 10 "Extracted from: GEMINI.md" .aligntrue/extracted-rules.md'
    level: 2
    fingerprint: 6edff16a7abf71d6
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Should show: Skipped: 1 (already in current rules)"
    content: ""
    level: 2
    fingerprint: 2915f21f5657f630
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify files synced with current rules (overwritten)
    content: cat CLAUDE.md
    level: 2
    fingerprint: 627bdbf15d59d179
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Should contain content from AGENTS.md (current edit_source), not original content
    content: |-
      ```

      **Expected:**

      - New files with content detected automatically
      - Interactive prompt explains extraction and overwriting
      - Content extracted to `.aligntrue/extracted-rules.md` before overwriting
      - Files added to exporters list (NOT to edit_source)
      - Content-based deduplication skips sections already in IR
      - Files overwritten with current rules from edit_source on next sync
      - `extracted-rules.md` is append-only (never deleted by AlignTrue)
    level: 2
    fingerprint: eb0df609f94e30ed
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Content extraction and deduplication workflow
    content: |-
      Test extraction of content from multiple files with overlapping sections:

      ```bash
      cd /tmp/test-extraction-dedup
      aligntrue init --mode solo --yes
    level: 4
    fingerprint: 07dde9e06d81f850
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Create edit_source with initial content
    content: cat > AGENTS.md <<'EOF'
    level: 2
    fingerprint: 2e389294c14526f8
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Testing
    content: |-
      Run tests before commit.
      EOF
    level: 2
    fingerprint: cf80cd8aed482d5d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Sync to establish IR
    content: aligntrue sync
    level: 2
    fingerprint: 2cdb383b1ddb27c9
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Create new file with overlapping and unique sections
    content: cat > CLAUDE.md <<'EOF'
    level: 2
    fingerprint: 760ce2128fa2d75b
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Documentation
    content: |-
      Document all public APIs.
      EOF
    level: 2
    fingerprint: caf9f906b16a91cb
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Sync - should detect CLAUDE.md
    content: aligntrue sync --yes
    level: 2
    fingerprint: 3987a38233f74c1f
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Expected:"
    content: ""
    level: 2
    fingerprint: 749034ea977812e8
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Detects CLAUDE.md (2 sections)"
    content: ""
    level: 2
    fingerprint: 7fda995499b485dc
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Extracts content to extracted-rules.md"
    content: ""
    level: 2
    fingerprint: 374ea170f1d9d0a7
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: '- "Security" section should be skipped (content hash matches existing)'
    content: ""
    level: 2
    fingerprint: d56f73a9c3e5149a
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: '- "Documentation" section should be extracted (unique)'
    content: ""
    level: 2
    fingerprint: e4271d1200a796a4
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify extraction results
    content: 'grep -A 10 "Extracted from: CLAUDE.md" .aligntrue/extracted-rules.md'
    level: 2
    fingerprint: 371256fe29e01d35
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Should show:"
    content: ""
    level: 2
    fingerprint: 8931ef6d04af92dd
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Extracted: 1 (Documentation section)"
    content: ""
    level: 2
    fingerprint: 215610f742b7d401
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Skipped: 1 (Security section - duplicate)"
    content: ""
    level: 2
    fingerprint: 4f265d0d206efc12
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify CLAUDE.md was overwritten with current rules
    content: cat CLAUDE.md
    level: 2
    fingerprint: fcfcbdbe00788452
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Should contain content from AGENTS.md (Security, Testing sections)
    content: ""
    level: 2
    fingerprint: 2ff488859796b461
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Should NOT contain original "Documentation" section (that's in extracted-rules.md)
    content: ""
    level: 2
    fingerprint: 6538ba15fc2a21f2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify edit_source unchanged
    content: aligntrue config get sync.edit_source
    level: 2
    fingerprint: 4a5d4abf0bdf4094
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 'Expected: "AGENTS.md" (unchanged)'
    content: ""
    level: 2
    fingerprint: 77ad3eb042c38779
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify exporters updated
    content: aligntrue config get exporters
    level: 2
    fingerprint: 64c358091c06ebcc
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 'Expected: ["agents-md", "claude"] (claude added)'
    content: |-
      ```

      **Expected:**

      - Content-based deduplication skips sections already in IR
      - Only unique sections extracted to extracted-rules.md
      - Files overwritten with current rules from edit_source
      - edit_source remains unchanged
      - Exporters list updated with new agents
    level: 2
    fingerprint: 9dd0d835aeea3713
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Formatting normalization workflow
    content: |-
      Test that common formatting issues are fixed during export:

      ```bash
      cd /tmp/test-formatting
      aligntrue init --mode solo --yes
    level: 4
    fingerprint: ec7c950352af49a9
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Create file with formatting issues (horizontal rule + heading without newline)
    content: cat > AGENTS.md <<'EOF'
    level: 2
    fingerprint: a485d350b94f5fa8
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: First Section
    content: |-
      Some content here.

      ---### Second Section

      More content.

      ---
    level: 2
    fingerprint: c19ab54cc868b279
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Third Section
    content: |-
      Final content.
      EOF
    level: 3
    fingerprint: f6b02e6f1196a904
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Sync to export
    content: aligntrue sync
    level: 2
    fingerprint: 68327e84a7b3b3a8
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify formatting fixed in exports
    content: cat .cursor/rules/aligntrue.mdc
    level: 2
    fingerprint: 8e34e5d5df904b79
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Should have proper spacing: ---\\n\\n###"
    content: 'grep -A2 "^---$" .cursor/rules/aligntrue.mdc | grep "^$" || echo "FAIL: missing newline after horizontal rule"'
    level: 2
    fingerprint: e92cba6644f5b1f6
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Should NOT have concatenated: ---###"
    content: |-
      grep "^---#" .cursor/rules/aligntrue.mdc && echo "FAIL: found malformed horizontal rule" || echo "PASS: formatting normalized"
      ```

      **Expected:**

      - Horizontal rules followed by proper newlines
      - No concatenated `---###` patterns
      - All sections properly spaced
      - Formatting issues fixed automatically
    level: 2
    fingerprint: 6e4387b90b367341
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 3. Golden Paths (Team)
    content: |-
      **What:** Team mode workflows (lockfile, shared config, collaboration, personal rules)

      **Validate:**

      - Project init for team mode
      - Config sharing between developers
      - Lockfile generation and drift detection
      - Personal rules (local and remote)
      - Migration from solo to team mode
      - Joining existing team
      - Conflict behavior is clear
      - No hidden global state

      **Simulate:**

      - Two developers (user-a, user-b) in separate working directories
      - Real file operations, no mocks
      - Expected: explicit conflict messages, no silent overwrites

      **Key workflows to test:**

      1. **Solo → Team migration:**
         - `aligntrue team enable`
         - Migration wizard for personal rules
         - Lockfile generation
         - Commit and push

      2. **Joining existing team:**
         - Clone team repository
         - `aligntrue init` (detects team mode)
         - Choose personal rules option (none/local/remote)
         - `aligntrue sync`

      3. **Personal remote setup:**
         - Create private git repository or use existing (e.g., AlignTrue/examples)
         - Configure remote URL in config.yaml
         - Sync personal rules from remote
         - Verify git operations (pull, merge with team rules)
         - Test with fixtures from `examples/remote-test/personal-rules.md`

      4. **Team rule changes:**
         - Edit AGENTS.md (team sections)
         - `aligntrue sync`
         - Commit changes
         - PR approval workflow
         - Other team members pull and sync

      5. **Personal rule changes:**
         - Edit AGENTS.md (personal sections)
         - `aligntrue sync`
         - Changes stay local or sync to personal remote
         - No team approval needed

      6. **Drift detection:**
         - Make unapproved changes
         - `aligntrue drift --gates` fails in CI
         - Team lead approves via PR or `aligntrue team approve`
         - CI passes

      7. **Multi-file agent editing:**
         - Edit Cursor scope files (e.g., `.cursor/rules/backend.mdc`, `.cursor/rules/frontend.mdc`)
         - Verify section routing and round-trip sync
         - Test conflict detection when same section edited in multiple files

      8. **Read-only file edit detection:**

         Test the system's ability to detect and backup manual edits to read-only files before overwriting:

         **Setup:**
         - Configure `edit_source: "AGENTS.md"` (makes Cursor files read-only)
         - Run `aligntrue sync` to establish baseline

         **Test steps:**
         - Edit `.cursor/rules/aligntrue.mdc` (a read-only file)
         - Run `aligntrue sync` (without --force)
         - Verify backup created in `.aligntrue/overwritten-rules/`
         - Verify file is overwritten with clean IR content

         **Expected behavior:**
         - Backup automatically created before overwriting
         - Backup location: `.aligntrue/overwritten-rules/cursor/rules/aligntrue.{timestamp}.mdc`
         - File overwritten with IR content (manual edit removed)
         - No --force flag needed for read-only files
         - Manual edit content preserved in backup file

         **Test edit_source mode switching:**
         - Start with `edit_source: "AGENTS.md"`
         - Make edits to AGENTS.md, sync successfully
         - Change config to `edit_source: ".cursor/rules/*.mdc"`
         - Make edits to Cursor files, sync successfully
         - Verify both file types maintain their content correctly

      9. **Team-managed sections:**
         - Verify `[TEAM-MANAGED]` markers in exports
         - Test warning when attempting to edit team-managed sections
         - Validate section protection and override behavior

      10. **Personal rules in remote storage:**
          - Configure personal remote git repository
          - Modify personal sections and sync
          - Verify git operations (commit, push, pull)
    level: 3
    fingerprint: 4bf64c450b39a56d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Team Testing Patterns
    content: |-
      **Simulating multi-user scenarios:**

      When testing team workflows locally, use separate directories to represent different developers:

      ```bash
    level: 3
    fingerprint: 48ae667d1c2a61ee
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "User A: Initialize team"
    content: |-
      mkdir /tmp/team-user-a && cd /tmp/team-user-a
      aligntrue init --yes --mode team
      aligntrue sync  # Generates lockfile
    level: 2
    fingerprint: 20b97d04b076ed63
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "User B: Join team (copy shared files)"
    content: |-
      mkdir /tmp/team-user-b && cd /tmp/team-user-b
      cp -r /tmp/team-user-a/.aligntrue .
      cp /tmp/team-user-a/AGENTS.md .
      cp /tmp/team-user-a/.aligntrue.lock.json .
      aligntrue init --yes  # Detects existing team setup
      aligntrue sync
      ```

      **Testing drift detection:**

      ```bash
    level: 2
    fingerprint: aa078baaf3411fc7
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Make unapproved change (user A)
    content: |-
      cd /tmp/team-user-a
      echo "### Unapproved Rule" >> AGENTS.md
      aligntrue drift --gates  # Should exit non-zero
    level: 2
    fingerprint: b0d468ab0d963c78
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Approve and sync
    content: |-
      aligntrue sync --accept-agent agents-md
      aligntrue drift --gates  # Should pass after approval
      ```

      This pattern exercises collaboration workflows without relying on git remotes and keeps tests deterministic.
    level: 2
    fingerprint: a05c4fa42293355b
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Team backup and ignore file management
    content: |-
      Test backup and ignore file behavior in team mode:

      ```bash
    level: 4
    fingerprint: e80a5e57e73750ea
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Team user A: Enable team mode with backups"
    content: |-
      cd /tmp/team-user-a
      aligntrue team enable
    level: 2
    fingerprint: 00f37ec3e69116aa
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify backups created during team transition
    content: |-
      ls -la .aligntrue/.backups/
      test -f .aligntrue/.lock.json || echo "FAIL: lockfile not created"
    level: 2
    fingerprint: 1184f121566f0a85
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify ignore files managed correctly in team mode
    content: |-
      aligntrue sync
      test -f .cursor/.aligntrue.ignore || echo "FAIL: ignore file missing in team mode"
    level: 2
    fingerprint: 6a0a002b1d068e72
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test that all sync operations create backups
    content: |-
      echo "### Team Rule" >> AGENTS.md
      aligntrue sync --accept-agent agents-md
    level: 2
    fingerprint: c4c7f56db77af1c6
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Restore from backup
    content: |-
      aligntrue revert --preview
      aligntrue revert
    level: 2
    fingerprint: 29046c82180b5d62
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify restored state
    content: 'grep "### Team Rule" AGENTS.md && echo "FAIL: revert didn''t work" || echo "PASS: state restored"'
    level: 2
    fingerprint: cfeee61c9274b809
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Team user B: Verify ignore files inherited from team"
    content: |-
      cd /tmp/team-user-b
      cp -r /tmp/team-user-a/.aligntrue .
      cp /tmp/team-user-a/AGENTS.md .
      cp /tmp/team-user-a/.aligntrue.lock.json .
    level: 2
    fingerprint: 5c3b7232b4e83466
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Init detects team mode
    content: aligntrue init --yes
    level: 2
    fingerprint: 7a99aa9fc48bcfe1
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify ignore files are present
    content: 'test -f .cursor/.aligntrue.ignore || echo "FAIL: ignore file not inherited"'
    level: 2
    fingerprint: 9d62cab3e456170b
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Sync should respect ignore file settings
    content: |-
      aligntrue sync
      ```

      **Expected:**

      - Backups created during team transitions
      - Ignore files properly configured in team mode
      - Backups inherited when cloning team repository
      - All sync operations create timestamped backups
    level: 2
    fingerprint: ba5680bcdd9f0328
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 3.5. Advanced Customization (Scopes, Plugs, Overlays)
    content: |-
      **What:** Test complex monorepo and customization scenarios

      **Scenario reference:** All scenarios are documented on the docs site with full configurations and explanations. Use these as reference when testing:

      - Scopes: https://aligntrue.ai/docs/02-customization/scopes#scenarios
      - Plugs: https://aligntrue.ai/docs/02-customization/plugs#scenarios
      - Overlays: https://aligntrue.ai/docs/02-customization/overlays#scenarios

      **Validate:**

      - Scopes: Path-based rule application in monorepos
      - Plugs: Template slot resolution with fills
      - Overlays: Fork-safe pack customization
      - Integration: All three features working together

      **Test scenarios:**
    level: 3
    fingerprint: 5bbf7c6a06588a47
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Scopes workflows
    content: |-
      **1. Monorepo with 3 scopes (frontend, backend, worker):**

      ```bash
      cd /tmp/test-scopes-monorepo
      aligntrue init --mode solo --yes
    level: 4
    fingerprint: 47b5a0753fa094f1
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Create monorepo structure
    content: mkdir -p apps/web/src packages/api/src services/worker
    level: 2
    fingerprint: 8019a28dab2a423c
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Create scope configuration
    content: |-
      cat > .aligntrue/config.yaml <<EOF
      version: "1"
      mode: solo
      scopes:
        - path: "apps/web"
          include: ["**/*.ts", "**/*.tsx"]
          exclude: ["**/*.test.ts"]
          rulesets: ["base-rules", "nextjs-rules"]
        - path: "packages/api"
          include: ["**/*.ts"]
          exclude: ["**/*.test.ts"]
          rulesets: ["base-rules", "node-rules"]
        - path: "services/worker"
          include: ["**/*.py"]
          rulesets: ["base-rules", "python-rules"]
      merge:
        strategy: "deep"
        order: ["root", "path", "local"]
      exporters:
        - agents-md
        - cursor
      EOF
    level: 2
    fingerprint: c9dd8878f20ed325
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Sync and verify
    content: |-
      aligntrue sync
      aligntrue scopes  # Should show 3 scopes with correct paths
    level: 2
    fingerprint: bb8537dc68593dcb
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify scope-specific exports exist
    content: |-
      test -f .cursor/rules/web.mdc || echo "FAIL: web scope export missing"
      test -f .cursor/rules/api.mdc || echo "FAIL: api scope export missing"
      test -f .cursor/rules/worker.mdc || echo "FAIL: worker scope export missing"
      ```

      **Expected:**

      - 3 scopes configured and listed
      - Scope-specific rule exports generated
      - Hierarchical merge order applied

      **2. Include/exclude pattern validation:**

      ```bash
    level: 2
    fingerprint: 928449d4d254575a
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test include patterns match correctly
    content: ""
    level: 2
    fingerprint: 0b3a25b0241b9637
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test exclude patterns filter correctly
    content: ""
    level: 2
    fingerprint: 756bc613d56051e5
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify glob pattern validation errors
    content: |-
      ```

      **3. Scope conflicts and precedence:**

      ```bash
    level: 2
    fingerprint: aa3b5bbd75ca9432
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Create overlapping scopes
    content: ""
    level: 2
    fingerprint: 25366c83775305cf
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify last matching scope wins
    content: ""
    level: 2
    fingerprint: f9e545d4119f4a78
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 'Test default scope (path: ".")'
    content: "```"
    level: 2
    fingerprint: 9a9dc18f7aec4d0a
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Plugs workflows
    content: |-
      **1. Slot declaration and fill resolution:**

      ```bash
      cd /tmp/test-plugs
      aligntrue init --mode solo --yes
    level: 4
    fingerprint: 76974d511f6c3440
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Create pack with plug slots
    content: |-
      cat > .aligntrue/.rules.yaml <<EOF
      id: test-pack
      version: "1.0.0"
      spec_version: "1"
      sections:
        - heading: "Testing Guidelines"
          content: |
            Run tests with: [[plug:test.cmd]]
            Documentation: [[plug:docs.url]]
            Author: [[plug:author.name]]
          level: 2
          fingerprint: "testing-guidelines"
      plugs:
        slots:
          test.cmd:
            description: "Command to run tests"
            format: command
            required: true
          docs.url:
            description: "Documentation URL"
            format: url
            required: false
          author.name:
            description: "Author name"
            format: text
            required: false
      EOF
    level: 2
    fingerprint: 46aa0f45f507bc66
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: List plugs (should show unresolved required)
    content: aligntrue plugs list
    level: 2
    fingerprint: 5ba9d339cce05b1d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Should show: test.cmd (required, unresolved), docs.url (optional)"
    content: ""
    level: 2
    fingerprint: c6ef0a9b41796e29
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Set fill for required plug via CLI
    content: aligntrue plugs set test.cmd "pnpm test"
    level: 2
    fingerprint: a9448dbd8f4fe4d2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Should validate format and update config.yaml
    content: ""
    level: 2
    fingerprint: 9ae9ad5aa6f186ce
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify fill was set
    content: aligntrue plugs list
    level: 2
    fingerprint: 7caa2bd74fb02278
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Should show: test.cmd filled (from config), docs.url optional"
    content: ""
    level: 2
    fingerprint: 992db0913a37477e
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test unset command
    content: |-
      aligntrue plugs unset test.cmd
      aligntrue plugs list
    level: 2
    fingerprint: 26d0f8118ceb4018
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Should show: test.cmd unresolved again"
    content: ""
    level: 2
    fingerprint: f346cff068c77ec6
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Set it back
    content: aligntrue plugs set test.cmd "pnpm test"
    level: 2
    fingerprint: de4991f650052aba
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test format validation
    content: |-
      aligntrue plugs set test.cmd "/absolute/path" || echo "Expected: validation error"
      aligntrue plugs set docs.url "not-a-url" || echo "Expected: validation error"
      aligntrue plugs set docs.url "https://docs.example.com"  # Should succeed
    level: 2
    fingerprint: 678a542ebb6bccec
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Resolve and verify
    content: aligntrue plugs resolve
    level: 2
    fingerprint: 7fe8a9bbaf3b1791
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 'Should show: test.cmd resolved to "pnpm test", docs.url resolved to URL'
    content: ""
    level: 2
    fingerprint: c9cc32e6de67ffd9
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Sync and check output
    content: |-
      aligntrue sync
      grep "Run tests with: pnpm test" AGENTS.md || echo "FAIL: plug not resolved"
      ```

      **Expected:**

      - Unresolved required plugs detected
      - Fill validation works (format checking)
      - Optional plugs resolve to empty string
      - Required plugs generate TODO blocks if unresolved

      **2. Format validation:**

      ```bash
    level: 2
    fingerprint: 20912f5d918ec3c8
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test command format
    content: |-
      aligntrue plugs set test.cmd "pnpm test"  # Valid
      aligntrue plugs set test.cmd "/absolute/path"  # Should fail
    level: 2
    fingerprint: 4a587044c5bdb0e7
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test file format
    content: |-
      aligntrue plugs set config.file "config/settings.json"  # Valid
      aligntrue plugs set config.file "../secrets.json"  # Should fail (parent traversal)
    level: 2
    fingerprint: 76c7abeb7baa724d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test URL format
    content: |-
      aligntrue plugs set docs.url "https://docs.example.com"  # Valid
      aligntrue plugs set docs.url "example.com"  # Should fail (missing protocol)
      ```

      **3. Unresolved required plugs generate TODO blocks:**

      ```bash
    level: 2
    fingerprint: 8adfae19adb95b86
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Sync without filling required plug
    content: ""
    level: 2
    fingerprint: 9432375f5ae0eaf3
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify TODO block appears in output
    content: |-
      grep "TODO(plug:test.cmd):" AGENTS.md || echo "FAIL: TODO block missing"
      ```

      **4. Config-based fills (new feature):**

      Test plugs configuration via config.yaml and fill precedence:

      ```bash
      cd /tmp/test-plugs-config
      aligntrue init --mode solo --yes
    level: 2
    fingerprint: 8483e5a690dea286
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Set fills via CLI
    content: |-
      aligntrue plugs set test.cmd "pnpm test"
      aligntrue plugs set docs.url "https://docs.example.com"
      aligntrue plugs set author.name "Jane Smith"
    level: 2
    fingerprint: 802f0f6de19eede6
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify fills in config.yaml
    content: 'grep -A 5 "plugs:" .aligntrue/config.yaml | grep -q "test.cmd" || echo "FAIL: fills not in config"'
    level: 2
    fingerprint: f43b314a8e4fe2f1
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: List plugs and verify source (should show "from config")
    content: aligntrue plugs list
    level: 2
    fingerprint: ca5ef1996717dbac
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Expected: All three slots filled with values from config"
    content: ""
    level: 2
    fingerprint: 7d851fd3c9397fea
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Resolve plugs
    content: aligntrue plugs resolve
    level: 2
    fingerprint: 99818c163fd0aebe
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Expected: All slots resolved to their fill values"
    content: ""
    level: 2
    fingerprint: 05c612c7a7f921a0
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Sync and verify fills are applied
    content: aligntrue sync
    level: 2
    fingerprint: d0a15d4e811304ff
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Check output has filled values
    content: |-
      grep "Run tests with: pnpm test" AGENTS.md || echo "FAIL: test.cmd not filled"
      grep "Documentation: https://docs.example.com" AGENTS.md || echo "FAIL: docs.url not filled"
      grep "Author: Jane Smith" AGENTS.md || echo "FAIL: author.name not filled"
    level: 2
    fingerprint: fcf0e5aeb0fe25db
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test unsetting a fill
    content: aligntrue plugs unset author.name
    level: 2
    fingerprint: ea27a18eeb875801
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify it was removed
    content: 'grep "author.name" .aligntrue/config.yaml && echo "FAIL: unset didn''t remove fill" || echo "PASS: fill removed"'
    level: 2
    fingerprint: 35b78fa74c050ff1
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify plugs list shows unset slot as unresolved
    content: 'aligntrue plugs list | grep -q "author.name" || echo "FAIL: unset slot not shown"'
    level: 2
    fingerprint: 6bd0fa77b187b106
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test invalid format values
    content: |-
      aligntrue plugs set test.cmd "/absolute/path" 2>&1 | grep -i "error" || echo "FAIL: should reject absolute path"
      aligntrue plugs set docs.url "not-a-url" 2>&1 | grep -i "error" || echo "FAIL: should reject invalid URL"
      aligntrue plugs set docs.url "ftp://invalid" 2>&1 | grep -i "error" || echo "FAIL: should reject non-https URL"
      ```

      **Expected:**

      - Fills stored in config.yaml under `plugs.fills`
      - Config fills take precedence over IR fills
      - Format validation works for all types (command, file, url, text)
      - Invalid formats rejected with clear error messages
      - `plugs set <slot> <value>` updates config
      - `plugs unset <slot>` removes config fill
      - `plugs list` shows fill source (config vs IR)
    level: 2
    fingerprint: c444fa350855eb28
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Overlays workflows
    content: |-
      **1. Override severity (warning → error):**

      ```bash
      cd /tmp/test-overlays
      aligntrue init --mode solo --yes
    level: 4
    fingerprint: ddbb9e821a694104
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Create base pack
    content: |-
      cat > upstream-pack.yaml <<EOF
      id: upstream-pack
      version: "1.0.0"
      spec_version: "1"
      sections:
        - heading: "No console.log"
          content: "Avoid console.log in production"
          level: 2
          fingerprint: "no-console-log"
          severity: "warning"
      EOF
    level: 2
    fingerprint: 1a7dacc1b3ea842b
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Configure with overlay
    content: |-
      cat > .aligntrue/config.yaml <<EOF
      version: "1"
      mode: solo
      sources:
        - type: local
          path: upstream-pack.yaml
      overlays:
        overrides:
          - selector: "rule[id=no-console-log]"
            set:
              severity: "error"
      exporters:
        - agents-md
      EOF
    level: 2
    fingerprint: 434b3bbea426452d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Sync and verify overlay applied
    content: |-
      aligntrue sync
      aligntrue override status  # Should show 1 active overlay
    level: 2
    fingerprint: 32316c44b04d7ffb
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Check output has upgraded severity
    content: ""
    level: 2
    fingerprint: a40900240d159bcb
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "(Implementation detail: verify in exported files)"
    content: |-
      ```

      **2. Add check inputs (complexity threshold):**

      ```bash
    level: 2
    fingerprint: 5a4d6a6bc310d008
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Override with nested property
    content: |-
      aligntrue override add \
        --selector 'rule[id=max-complexity]' \
        --set check.inputs.threshold=15

      aligntrue override status  # Should show override
      ```

      **3. Remove autofix:**

      ```bash
    level: 2
    fingerprint: 080e691fb86c8f69
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Remove property from rule
    content: |-
      aligntrue override add \
        --selector 'rule[id=prefer-const]' \
        --remove autofix

      aligntrue override diff  # Should show autofix removed
      ```

      **4. Multiple overlays and health checking:**

      ```bash
    level: 2
    fingerprint: 2f55b71459b0220f
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Add multiple overlays
    content: ""
    level: 2
    fingerprint: c67e685f408f5d03
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Run aligntrue override status
    content: ""
    level: 2
    fingerprint: d1c61c7358dbf1e9
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify all show as "healthy"
    content: ""
    level: 2
    fingerprint: 92995dc911060541
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Simulate upstream change (rename rule ID)
    content: ""
    level: 2
    fingerprint: 4ae4d8a9f5971848
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Should show stale overlay warning
    content: "```"
    level: 2
    fingerprint: e62de8e18861ff88
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Combined scenarios
    content: |-
      **1. Monorepo with scopes + plugs + overlays:**

      ```bash
      cd /tmp/test-combined
      aligntrue init --mode solo --yes
    level: 4
    fingerprint: aa6a0353f61380a2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Configure all three features
    content: |-
      cat > .aligntrue/config.yaml <<EOF
      version: "1"
      mode: solo
      scopes:
        - path: "apps/web"
          rulesets: ["nextjs-rules"]
        - path: "packages/api"
          rulesets: ["node-rules"]
      plugs:
        fills:
          test.cmd: "pnpm test"
          docs.url: "https://docs.example.com"
      overlays:
        overrides:
          - selector: "rule[id=no-console-log]"
            set:
              severity: "error"
      exporters:
        - agents-md
        - cursor
      EOF
    level: 2
    fingerprint: 230eded3437a517b
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Sync and verify all features work together
    content: aligntrue sync
    level: 2
    fingerprint: 168c7142f9f4ace1
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Verify:"
    content: ""
    level: 2
    fingerprint: 0aacecd52c894308
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 1. Scopes applied (different rules per directory)
    content: ""
    level: 2
    fingerprint: b71d1a9005a7bd15
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 2. Plugs resolved (test.cmd filled)
    content: ""
    level: 2
    fingerprint: 92f4e02ab12152b0
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 3. Overlays applied (severity upgraded)
    content: |-
      ```

      **2. Scope-specific plug fills:**

      ```bash
    level: 2
    fingerprint: f51e900e8d05b888
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test that plugs can have different values per scope
    content: ""
    level: 2
    fingerprint: b4483bac390a7f59
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify hierarchical merge order applies to plugs
    content: |-
      ```

      **3. End-to-end determinism:**

      ```bash
    level: 2
    fingerprint: b3aff1cbc495a42d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Run sync twice
    content: ""
    level: 2
    fingerprint: 2ddb93a9faffecf4
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify byte-identical outputs
    content: ""
    level: 2
    fingerprint: 799dfb447a2e0cbe
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Check content hashes match
    content: |-
      ```

      **Validation checklist:**

      - [ ] `aligntrue scopes` lists configured scopes correctly
      - [ ] `aligntrue plugs list` shows slots and fills
      - [ ] `aligntrue plugs resolve` previews resolution
      - [ ] `aligntrue override status` shows overlay health
      - [ ] `aligntrue override diff` shows changes
      - [ ] Combined features work without conflicts
      - [ ] Deterministic outputs (run sync twice, compare hashes)
    level: 2
    fingerprint: b2976d6adf560f0c
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 4. Command Coverage
    content: |-
      **What:** Systematic breadth across all commands

      **For each command:**

      - Happy path with valid inputs
      - Required flags missing (should error clearly)
      - Invalid input (should error with fix suggestion)
      - Conflicting flags (should error or warn)
      - `--help` exists and matches actual behavior

      **Validate exit codes:**

      - 0 on success
      - Non-zero with clear message on failure

      **Key commands to test (ensure coverage):**

      **Organization & multi-file:**

      - `sources list` - List all source files with section counts
      - `sources split` - Split AGENTS.md into multiple files

      **Privacy & consent:**

      - `privacy audit` - List all consents with timestamps
      - `privacy grant <operation>` - Grant consent for operations (e.g., git)
      - `privacy revoke <operation>` - Revoke specific or all consents

      **Onboarding & migration:**

      - `onboard` - Generate developer onboarding checklist
      - `migrate preview` - Preview schema migration changes
      - `migrate apply` - Apply schema migrations

      **Backup & recovery:**

      - `revert --preview` - Preview restoration without applying
      - `revert --to <timestamp>` - Restore specific backup

      **Configuration management:**

      - `config show` - Display active configuration with mode
      - `config edit` - Open config in editor
      - `config summary` - Concise configuration summary
      - `config get <key>` - Get single value (dot notation)
      - `config set <key> <value>` - Set value with validation
      - `config list` - List all key-value pairs
      - `config unset <key>` - Remove optional config value

      **Adapter management:**

      - `adapters detect` - Detect new agents in workspace
      - `adapters ignore <name>` - Ignore detected agent

      **Flag usage reference:**

      Common flags and supported commands:

      - `--force`, `--force-invalid-ir`, `--force-refresh`, `--dry-run`, `--accept-agent <agent>` — `sync` only
      - `--yes`, `-y`, `--non-interactive` — `init`, `migrate`, `revert`
      - `--ci` — `check` only
      - `--gates` — `drift` only

      Tip: Run `aligntrue <command> --help` for full flag details.
    level: 3
    fingerprint: 9ccca45a86401f68
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 5. Statefulness
    content: |-
      **What:** Real-world persistence and state management scenarios

      **Test with:**

      - No config (first run)
      - Valid config
      - Corrupted config (malformed YAML)
      - Partial state (cache exists but config missing)
      - Backup recovery from various states

      **Validate:**

      - State is stored in documented locations (.aligntrue/, .aligntrue.lock.json, .aligntrue/.backups/)
      - Cache invalidation works correctly
      - Backup system maintains file integrity
      - Restore operations recover proper state
      - **Drift log persists across sessions**
      - **Watch mode state with new file detections**
    level: 3
    fingerprint: 42cb46e62ec59f87
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Watch mode new file detection
    content: |-
      Test that watch mode detects new files and logs them without auto-importing:

      ```bash
      cd /tmp/test-watch-new-files
      aligntrue init --mode solo --yes
    level: 4
    fingerprint: 4c98b3435c7b9d39
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Start watch in background
    content: |-
      aligntrue watch > watch.log 2>&1 &
      WATCH_PID=$!
    level: 2
    fingerprint: 6415be3ebeb31fce
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Wait for watch to initialize
    content: sleep 2
    level: 2
    fingerprint: 1b68fc46928070b7
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Add new file while watch is running
    content: cat > CLAUDE.md <<'EOF'
    level: 2
    fingerprint: d4d32460a9fa86ae
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: New rule
    content: |-
      This was added while watch was running.
      EOF
    level: 2
    fingerprint: 3092b18f899de2aa
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Wait for detection
    content: sleep 2
    level: 2
    fingerprint: c5b3ba77baa514c7
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Check watch output
    content: |-
      grep "New file detected: CLAUDE.md" watch.log || echo "FAIL: watch didn't detect new file"
      grep "Run 'aligntrue sync' to review and enable" watch.log || echo "FAIL: missing user guidance"
    level: 2
    fingerprint: c93efba0aa03d967
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify drift log created
    content: |-
      test -f .aligntrue/.drift-log.json || echo "FAIL: drift log missing"
      DETECTION_COUNT=$(cat .aligntrue/.drift-log.json | grep -c '"file"')
      test $DETECTION_COUNT -eq 3 || echo "FAIL: expected 3 detections, got $DETECTION_COUNT"
    level: 2
    fingerprint: 22ffdee75a301797
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 'Should contain CLAUDE.md with status: "pending_review"'
    content: ""
    level: 2
    fingerprint: 1ba392158d9b1811
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Stop watch
    content: kill $WATCH_PID
    level: 2
    fingerprint: 61d5e421d7d5d8a2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Run sync interactively (would prompt in real usage)
    content: aligntrue sync --yes
    level: 2
    fingerprint: b86a0a9c81f39d9c
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify file enabled as export target
    content: aligntrue config get exporters
    level: 2
    fingerprint: 2b2b0914b6287beb
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Should include "claude"
    content: ""
    level: 2
    fingerprint: 34172133f2da4fd5
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Should be "AGENTS.md" (unchanged, NOT updated to include CLAUDE.md)
    content: |-
      ```

      **Expected:**

      - Watch detects new files in real-time
      - Logs detection with helpful message
      - Writes to drift log with "pending_review" status
      - Does NOT auto-enable (safe default)
      - Next sync shows pending detections
      - After enabling, content extracted to extracted-rules.md
      - Files added to exporters (not edit_source)
    level: 2
    fingerprint: 60936759f1b67feb
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Drift log persistence
    content: |-
      Test that drift log persists across sessions and sync operations:

      ```bash
      cd /tmp/test-drift-persistence
      aligntrue init --mode solo --yes
    level: 4
    fingerprint: 90e33f6da52a9657
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Add untracked files
    content: |-
      echo "## Rule 1" > FILE1.md
      echo "## Rule 2" > FILE2.md
      echo "## Rule 3" > FILE3.md
    level: 2
    fingerprint: c8c132b8c6e27d73
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Run sync once - should detect all three
    content: aligntrue sync --yes
    level: 2
    fingerprint: 98e276dce6aa59b2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Exit and restart (simulating session end/start)
    content: |-
      cd /
      cd /tmp/test-drift-persistence
    level: 2
    fingerprint: 8e1ded40e713e694
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Drift log should still exist
    content: 'test -f .aligntrue/.drift-log.json || echo "FAIL: drift log not persisted"'
    level: 2
    fingerprint: b763a37ccd4516db
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Run sync again - should remember previous state
    content: aligntrue sync --yes
    level: 2
    fingerprint: 971c8b8916d08952
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify detections updated (not duplicated)
    content: |-
      DETECTION_COUNT=$(cat .aligntrue/.drift-log.json | grep -c '"file"')
      test $DETECTION_COUNT -eq 3 || echo "FAIL: detections duplicated, got $DETECTION_COUNT"
    level: 2
    fingerprint: 0fd27ce5f1e666d5
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify timestamps updated
    content: |-
      cat .aligntrue/.drift-log.json | grep "timestamp"
      ```

      **Expected:**

      - Drift log persists across sessions
      - File system state preserved in `.aligntrue/.drift-log.json`
      - No duplication of detections on subsequent syncs
      - Timestamps update correctly
    level: 2
    fingerprint: 03aa3e460ec67c8f
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 6. Environment Matrix
    content: |-
      **What:** Cross-platform and runtime validation

      **Reason about behavior on:**

      - macOS, Linux, Windows
      - Different shells (bash, zsh, fish, cmd, powershell)
      - Node versions (20, 22, latest)
      - CI environments (GitHub Actions, local scripts)

      **Validate:**

      - Commands are scriptable and deterministic
      - Paths use correct separators
      - No platform-specific assumptions leak
    level: 3
    fingerprint: 32eb89bf4d288792
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 7. Error & UX
    content: |-
      **What:** User trust via helpful errors and predictable behavior

      **Validate:**

      - Error messages state what failed, why, and how to fix
      - Exit codes follow conventions (0=ok, 1=validation, 2=user error, 3=system error)
      - Progress indicators only for operations >10s
      - No sensitive data in logs
      - Deterministic outputs (same inputs → same outputs)
    level: 3
    fingerprint: ead10309a58db731
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: 8. Exploratory
    content: |-
      **What:** Find unknown unknowns after structured coverage

      **Behave as:**

      - A clever user who skimmed the docs
      - Goal: break the CLI or find confusing behavior using only supported commands

      **Propose 10-15 strange but plausible sequences:**

      - Rapid mode switches (solo → team → solo)
      - Conflicting config changes
      - Partial file deletions mid-operation
      - Race conditions (two terminals, same repo)
      - Edge cases from real usage patterns

      **Document:**

      - What bug or confusion you are probing for
      - Actual behavior vs expected behavior
      - Severity (blocks adoption vs polish)

      ---
    level: 3
    fingerprint: dcd53523b0e67c3e
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Execution protocol
    content: ""
    level: 2
    fingerprint: 7e0bbb6d5ce7fff5
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Before testing
    content: |-
      **0. Validate understanding:**

      - Read `.cursor/rules/architecture.mdc` section on sync behavior
      - Confirm understanding of edit_source, multi-file sync, and team mode
      - If uncertain, ask before proceeding with tests

      **1. Scan the repo:**

      - `packages/cli/src/commands/*.ts` - list all commands
      - `packages/cli/README.md` - document CLI usage
      - `apps/docs/content/getting-started/` - quickstart flows
      - `CHANGELOG.md` - recent changes that need validation

      **2. Build command inventory in scratchpad:**

      Run `aligntrue --help` and scan `packages/cli/src/commands/*.ts` to build complete current inventory.

      **Quick command count:**

      ```bash
    level: 3
    fingerprint: 2f2bd7af086422a6
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Count dispatch statements in packages/cli/src/index.ts
    content: ""
    level: 2
    fingerprint: f497b49503c1a1cd
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Current count: 22 commands (verified from packages/cli/src/commands/index.ts)"
    content: ""
    level: 2
    fingerprint: 9a4ff4a361a80943
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Includes top-level commands and subcommands for comprehensive coverage
    content: |-
      ```

      **Current commands (22 total, with 40+ subcommands):**

      ```
      Core commands:
      - aligntrue init [--mode solo|team] [--force] [--project-id <id>] [--exporters <list>] [--yes]
      - aligntrue sync [--dry-run] [--accept-agent <agent>] [--force] [--verbose] [--no-auto-pull]
      - aligntrue watch [--debounce <ms>]
      - aligntrue check [--ci]

      Team mode:
      - aligntrue team <enable|disable|status> [options]
      - aligntrue drift [--gates] [--format human|json|sarif]
      - aligntrue link <url> [--method <submodule|subtree|shallow-clone>]

      Customization:
      - aligntrue override <add|status|diff|remove> [options]
      - aligntrue plugs <list|resolve|validate|set|unset> [options]
      - aligntrue scopes

      Organization:
      - aligntrue sources <list|split> [options]

      Configuration:
      - aligntrue config <show|edit|summary|get|set|list|unset> [options]
      - aligntrue adapters <list|enable|disable|detect|ignore> [options]

      Backup & Recovery:
      - aligntrue backup <create|list|restore|cleanup> [options]
      - aligntrue revert [--preview] [--to <timestamp>]

      Utilities:
      - aligntrue telemetry <on|off|status>
      - aligntrue privacy <audit|grant|revoke> [options]
      - aligntrue update <check|apply> [options]
      - aligntrue onboard [--ci <path>]
      - aligntrue migrate [preview|apply]
      - aligntrue status
      - aligntrue doctor
      ```

      **Verification:**
      Always cross-check with `aligntrue --help` output and `packages/cli/src/commands/index.ts` exports to ensure completeness.

      Use your derived inventory as ground truth for test design.

      **3. Check last test log:**

      - Read `.internal_docs/TEST_LOG.md` if exists
      - Identify gaps and untested areas
      - Plan this session to complement previous runs
    level: 2
    fingerprint: 99ab2b016cfb5afa
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: During testing
    content: |-
      **CRITICAL: Testing Only, No Fixes**

      **⚠️ ABSOLUTE REQUIREMENT: NEVER TEST IN REPO ROOT ⚠️**

      **NEVER run test commands from the workspace root directory (`/Users/gabe/Sites/aligntrue` or any path containing `.aligntrue/`).**

      **ALWAYS:**

      - Create isolated test directories in `/tmp/` (e.g., `/tmp/aligntrue-test-{timestamp}`)
      - Change directory INTO the test directory BEFORE running any CLI commands
      - Use absolute paths to the CLI binary if needed: `/path/to/workspace/packages/cli/dist/index.js`
      - OR use `pnpm link --global` first, then run `aligntrue` from the test directory

      **WHY:** The repo root contains the user's actual AlignTrue configuration. Running `init`, `sync`, or other commands there will:

      - Detect existing `.aligntrue/` directory and exit early
      - Potentially corrupt or modify the user's real configuration
      - Make validation impossible to test
      - Risk data loss or configuration damage

      **Example CORRECT workflow:**

      ```bash
    level: 3
    fingerprint: dbade385069d3dee
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "✅ CORRECT: Create test dir and work from there"
    content: |-
      cd /tmp
      TEST_DIR="aligntrue-test-$(date +%s)"
      mkdir "$TEST_DIR" && cd "$TEST_DIR"
    level: 2
    fingerprint: cdb7502b7ed25244
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Now run CLI commands here, not from repo root
    content: |-
      /path/to/workspace/packages/cli/dist/index.js init --yes
      ```

      **Example WRONG workflow:**

      ```bash
    level: 2
    fingerprint: 12cd3332037fccbb
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "❌ WRONG: Running from repo root"
    content: |-
      cd /path/to/workspace
      node packages/cli/dist/index.js init  # NO! This will detect existing .aligntrue/
      ```

      **AI must NOT:**

      - Modify any source code files (except test files created in the hermetic test environment)
      - Attempt to fix bugs or issues discovered during testing
      - Make changes to the main workspace or repository
      - Implement recommendations or solutions
      - **Run any CLI commands from the workspace root directory**

      **AI must ONLY:**

      - Execute test commands in the hermetic test environment (`/tmp/aligntrue-test-{timestamp}`)
      - **ALWAYS change directory into the test directory before running CLI commands**
      - Capture outputs, exit codes, and execution times
      - Document findings with severity (P0-P3)
      - Provide actionable recommendations for the user to review
      - Report all issues in `.internal_docs/TEST_LOG.md`

      **All fixes and code changes are the user's responsibility.** The AI's role is to discover and document issues, not to resolve them.

      ---

      **Work in hermetic sandbox:** AI must create test directories for Layer 1 package testing, execute tests, capture outputs, and clean up automatically.

      **Create test environment:**

      ```bash
    level: 2
    fingerprint: ed8d15f06b5d77a2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: For Layer 1 (distribution package testing)
    content: ""
    level: 2
    fingerprint: c5caa189173a6178
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Build and pack from workspace (this is safe - just creates a file)
    content: |-
      cd /path/to/workspace/packages/cli
      pnpm pack  # Creates aligntrue-cli-X.Y.Z.tgz in current directory
    level: 2
    fingerprint: c47a33f414c886a3
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "⚠️ CRITICAL: Create test directory OUTSIDE workspace and work from there"
    content: |-
      cd /tmp
      TEST_DIR="aligntrue-test-$(date +%s)"
      mkdir "$TEST_DIR" && cd "$TEST_DIR"
    level: 2
    fingerprint: 51a9f8ee7c8952f2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: NOW we're in a clean test directory, safe to run CLI commands
    content: ""
    level: 2
    fingerprint: ee26bcbe490766d2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Install from tarball (or use pnpm link --global)
    content: |-
      npm install -g /path/to/workspace/packages/cli/aligntrue-cli-*.tgz
      export TZ=UTC
      export NODE_ENV=test
      node --version
      npm --version
      which aligntrue
      ```

      **For Layers 2-8 (feature testing):**

      **⚠️ CRITICAL: Still create test directories in /tmp, never run from workspace root**

      ```bash
    level: 2
    fingerprint: 177ed32459c176da
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Create isolated test directory
    content: |-
      cd /tmp
      TEST_DIR="aligntrue-test-$(date +%s)"
      mkdir "$TEST_DIR" && cd "$TEST_DIR"
    level: 2
    fingerprint: 829751f024cf7a8b
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: NOW we're in a clean test directory
    content: ""
    level: 2
    fingerprint: 54bf9cc825b7def8
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Use CLI from workspace (absolute path) OR use pnpm link --global
    content: |-
      export TZ=UTC
      export NODE_ENV=test
      node --version
      pnpm --version
    level: 2
    fingerprint: 8049baee573ba98d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Option 1: Use absolute path to CLI"
    content: /path/to/workspace/packages/cli/dist/index.js init --yes
    level: 2
    fingerprint: d30cede05592973c
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Option 2: NOT RECOMMENDED - pnpm link --global does not work"
    content: ""
    level: 2
    fingerprint: db97a46ce88f2577
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: DO NOT USE pnpm link --global - it fails with ERR_PACKAGE_PATH_NOT_EXPORTED
    content: ""
    level: 2
    fingerprint: 7b3164832fcb23b6
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: due to workspace:* protocol incompatibility with symlinks
    content: |-
      ```

      **Why this approach:**

      - Layer 1 tests the actual packaged artifact users receive, catching packaging issues (missing files, wrong bin links)
      - Tests real global installation experience via `npm install -g`, not monorepo `pnpm` commands
      - Layers 2-8 use local workspace for fast feature validation without installation overhead
      - Works reliably with AI terminal execution (no GitHub cloning failures)

      **Execute charter layers 1-8 in order.**

      **⚠️ REMINDER: Every test command must run from a test directory in /tmp, NEVER from workspace root.**

      **Record findings as you go:**

      - Command that failed
      - Expected vs actual behavior
      - Severity (P0=blocks adoption, P1=major friction, P2=polish, P3=nice-to-have)
      - Root cause if identifiable

      ---
    level: 2
    fingerprint: cf89c509fc9a0a40
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: AI Execution Checklist
    content: |-
      When running automated tests, the AI must complete all steps:

      **Setup:**

      - [ ] **CRITICAL: Create test directory in /tmp and change into it BEFORE any CLI commands**
      - [ ] For Layer 1: Build all workspace packages with `cd /path/to/workspace && pnpm build`
      - [ ] For Layer 1: Create tarball with `cd packages/cli && pnpm pack` (safe - just creates file)
      - [ ] For Layer 1: Run distribution simulation script: `cd packages/cli && bash tests/scripts/test-distribution.sh`
      - [ ] For Layers 2-8: Build workspace packages first, then use absolute path to CLI (NEVER use `pnpm link --global`)
      - [ ] **NEVER run CLI commands from workspace root directory**
      - [ ] Set environment variables: `TZ=UTC` and `NODE_ENV=test`
      - [ ] Verify Node and npm/pnpm versions
      - [ ] For Layer 1: Verify `which aligntrue` shows global install path

      **Execution:**

      - [ ] Run each test command from the layer definition
      - [ ] Capture stdout and stderr for all commands
      - [ ] Record exit codes (0=success, non-zero=failure)
      - [ ] Measure execution time for performance-sensitive commands
      - [ ] Take snapshots of file system state before and after operations
      - [ ] Save all outputs to log file for analysis

      **Analysis:**

      - [ ] Compare actual vs expected outputs for each test
      - [ ] Identify error patterns and failure modes
      - [ ] Assign severity to each issue (P0=blocker, P1=major, P2=polish, P3=nice-to-have)
      - [ ] Determine root cause when identifiable
      - [ ] Note any platform-specific behaviors
      - [ ] Flag non-deterministic outputs

      **Reporting:**

      - [ ] Write findings to `.internal_docs/TEST_LOG.md`
      - [ ] Include all commands run with their outputs
      - [ ] List all issues found with severity and root causes
      - [ ] Document gaps for next test run
      - [ ] Provide actionable recommendations
      - [ ] Include performance metrics where relevant

      **Cleanup:**

      - [ ] Remove test directory: `rm -rf /tmp/aligntrue-test-{timestamp}`
      - [ ] Remove package tarballs: `rm -f packages/cli/aligntrue-cli-*.tgz`
      - [ ] Verify no artifacts left in workspace
      - [ ] Confirm no background processes running
      - [ ] Automatic cleanup runs before and after tests (keeps last 3 runs or 24 hours)

      **Cleanup Policy:**

      Test artifacts are automatically cleaned up:

      - **Test directories:** `/tmp/aligntrue-test-*` (keep last 3 runs OR directories newer than 24 hours)
      - **Package tarballs:** `packages/cli/aligntrue-cli-*.tgz` (removed after each Layer 1 test)
      - **Runs automatically:** Before and after comprehensive test runs
      - **Manual cleanup:**
        - Test directories: `find /tmp -maxdepth 1 -name "aligntrue-test-*" -mtime +1 -exec rm -rf {} \;`
        - Package tarballs: `find packages/cli -name "aligntrue-cli-*.tgz" -exec rm {} \;`

      ---
    level: 3
    fingerprint: 254e9a7fe2049173
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Automated output analysis
    content: |-
      **Exit Code Validation:**

      Capture and validate exit codes for every command:

      ```bash
    level: 3
    fingerprint: fdaaa87e0091dfef
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Pattern for capturing exit codes
    content: |-
      aligntrue sync
      EXIT_CODE=$?
      if [ $EXIT_CODE -ne 0 ]; then
        echo "FAIL: Expected 0, got $EXIT_CODE"
        echo "Command: aligntrue sync"
        echo "Stderr: $(cat stderr.log)"
      fi
      ```

      **Expected exit codes:**

      - 0: Success
      - 1: Validation error
      - 2: User input error
      - 3: System error

      **Output Pattern Matching:**

      Look for these indicators in command output:

      **Success indicators:**

      - "✓" or "✔"
      - "Success"
      - "completed"
      - "done"

      **Error indicators:**

      - "Error:"
      - "Failed:"
      - "✗" or "✘"
      - Non-zero exit code

      **Warning indicators:**

      - "Warning:"
      - "⚠"
      - "Note:"

      **File Validation:**

      Verify expected files exist and contain correct content:

      ```bash
    level: 2
    fingerprint: 33832616cd6829a0
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Check file existence
    content: |-
      test -f .aligntrue/config.yaml || echo "FAIL: config.yaml missing"
      test -f .aligntrue/.rules.yaml || echo "FAIL: .rules.yaml missing"
      test -f AGENTS.md || echo "FAIL: AGENTS.md missing"
    level: 2
    fingerprint: 6db3e3646acfe9f8
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Check directory structure
    content: |-
      test -d .cursor/rules || echo "FAIL: .cursor/rules directory missing"
      ```

      **Content Validation:**

      ```bash
    level: 2
    fingerprint: 0df831d1391b4a7d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify file contents contain expected patterns
    content: |-
      grep -q "profile:" .aligntrue/config.yaml || echo "FAIL: profile field missing in config"
      grep -q "sections:" .aligntrue/.rules.yaml || echo "FAIL: sections missing in IR"
    level: 2
    fingerprint: 33ec996dd1fc3785
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Verify JSON structure
    content: |-
      jq -e '.version' .aligntrue.lock.json || echo "FAIL: lockfile missing version"
      ```

      **Large Rule Set Testing:**

      Test CLI performance with realistic large rule sets:

      **Note:** The `examples/remote-test/large-rules/` directory contains markdown files with YAML frontmatter. These are proper markdown sources (not pure YAML IR files) and should be used as `type: local` sources in config.

      ```bash
    level: 2
    fingerprint: 8493667fd30901a7
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Copy large rule fixtures (markdown files with YAML frontmatter)
    content: cp -r examples/remote-test/large-rules /tmp/test-project/rules
    level: 2
    fingerprint: bee87e2e21ecd0bc
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Configure all files as sources
    content: |-
      cat > .aligntrue/config.yaml <<EOF
      version: "1"
      mode: solo
      sources:
        - type: local
          path: rules/backend-api.md
        - type: local
          path: rules/frontend-react.md
        - type: local
          path: rules/database.md
        - type: local
          path: rules/testing-integration.md
        - type: local
          path: rules/security-auth.md
        - type: local
          path: rules/devops-ci.md
        - type: local
          path: rules/code-review.md
        - type: local
          path: rules/documentation.md
        - type: local
          path: rules/performance.md
        - type: local
          path: rules/accessibility.md
      exporters:
        - agents-md
        - cursor
      EOF
    level: 2
    fingerprint: ddcbc0a50c1c697c
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Measure sync time
    content: time aligntrue sync
    level: 2
    fingerprint: 6dd71acd64edf416
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Expected: <60 seconds for 80-100 sections (10 files × 8-10 sections each)"
    content: ""
    level: 2
    fingerprint: 4bf0e4ac964de235
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Expected: <500MB memory usage"
    content: ""
    level: 2
    fingerprint: 86928fc1f4f6110f
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Expected: All files processed successfully"
    content: ""
    level: 2
    fingerprint: 644339c1918158ba
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Expected: AGENTS.md and .cursor/rules/*.mdc contain merged content from all sources"
    content: |-
      ```

      **Performance Validation:**

      ```bash
    level: 2
    fingerprint: 0062ae55996f155c
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Time command execution
    content: |-
      START=$(date +%s%N)
      aligntrue --help
      END=$(date +%s%N)
      DURATION=$(( (END - START) / 1000000 ))  # Convert to milliseconds

      if [ $DURATION -gt 1000 ]; then
        echo "FAIL: --help took ${DURATION}ms (expected <1000ms)"
      fi
    level: 2
    fingerprint: 9ce504a03c40946a
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Performance thresholds for large rule sets
    content: ""
    level: 2
    fingerprint: 57843df164e48baa
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Init: <10 seconds"
    content: ""
    level: 2
    fingerprint: e1b72489df4e51d7
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Sync (100-150 sections): <60 seconds (first run), <30 seconds (subsequent)"
    content: ""
    level: 2
    fingerprint: aa595b52e760fa6c
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Help: <5 seconds"
    content: ""
    level: 2
    fingerprint: b7a40207417a462c
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "- Memory: <500MB heap for large rule sets"
    content: |-
      ```

      **Determinism Validation:**

      ```bash
    level: 2
    fingerprint: 02848a3267f798b3
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Run command twice and compare outputs
    content: |-
      aligntrue sync --dry-run > output1.txt 2>&1
      aligntrue sync --dry-run > output2.txt 2>&1

      if ! diff -q output1.txt output2.txt; then
        echo "FAIL: Non-deterministic output detected"
        diff -u output1.txt output2.txt
      fi
      ```

      **Log Analysis:**

      Parse logs for common issues:

      - Sensitive data exposure (tokens, keys, passwords)
      - Stack traces in user-facing output
      - Unclear error messages
      - Missing "how to fix" guidance
      - Inconsistent formatting

      ---
    level: 2
    fingerprint: 8c00a71914fd3be2
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: After testing
    content: |-
      **Log results to `.internal_docs/TEST_LOG.md`:**

      Append entry:

      ```markdown
    level: 3
    fingerprint: 3dc562bef78d113e
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Test run YYYY-MM-DD
    content: |-
      **Commit:** abc123def
      **Scope:** Solo workflows, command coverage
      **Duration:** ~45 minutes

      **Scenarios Executed:**

      - ✅ Smoke tests (install, help, version)
      - ✅ Solo golden paths (init → sync → export)
      - ⚠️ Command coverage (3/15 commands tested)
      - ❌ Team workflows (deferred)

      **Notable Findings:**

      - P1: `aligntrue check` exits 0 on validation errors (should be non-zero)
      - P2: `aligntrue override add` unclear error when pack not found
      - P3: Help text for `--force` flag inconsistent across commands

      **Gaps for Next Run:**

      - Complete command coverage (12 commands remaining)
      - Team mode simulation (lockfile workflows)
      - Environment matrix (test on Linux CI)

      **Files Created:**

      - (none, logs only)
      ```

      **Format:**

      - Date, commit hash, scope, duration
      - Checklist of charter layers executed
      - Findings with severity
      - Gaps to test next time

      **Do NOT fabricate results.** If you cannot run commands, describe what SHOULD be tested instead.

      ---
    level: 2
    fingerprint: b13ae5e16ab50d80
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Kick-Off Prompts
    content: Use these to invoke AI-driven test execution. Each prompt triggers actual command execution in a hermetic environment.
    level: 2
    fingerprint: 8b7987d1d736b6e0
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Layer 1: Smoke Tests"
    content: |-
      ```
      Execute Layer 1 (Smoke Tests) from .cursor/rules/cli_testing_playbook.mdc.

      EXECUTION PROTOCOL:
      1. Set up hermetic test environment in /tmp/aligntrue-test-{timestamp}
      2. Build all workspace packages: cd /path/to/workspace && pnpm build
      3. Run distribution simulation script: cd packages/cli && bash tests/scripts/test-distribution.sh
      4. Set environment: TZ=UTC, NODE_ENV=test
      5. Execute smoke test scenarios:
         - Distribution script verification (package creation, tarball contents)
         - CLI binary execution with absolute path
         - aligntrue --help (must return <1s)
         - aligntrue --version
         - First run with no config
      6. Capture all outputs, exit codes, and execution times
      7. Validate against expected behavior
      8. Report findings with severity (P0-P3)
      9. Clean up test environment

      OUTPUT: Structured report in .internal_docs/TEST_LOG.md format with:
      - Commands executed
      - Pass/fail status
      - Issues found with root causes
      - Performance metrics
      ```
    level: 3
    fingerprint: 6beb0b361d61718d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Layer 2: Solo Golden Paths"
    content: |-
      ```
      Execute Layer 2 (Solo Golden Paths) from .cursor/rules/cli_testing_playbook.mdc.

      EXECUTION PROTOCOL:
      1. Set up hermetic test environment in /tmp/aligntrue-test-{timestamp}
      2. Build command inventory from packages/cli/src/commands/
      3. Execute core solo workflows:
         - Init new project → sync to agents
         - Edit AGENTS.md → sync → verify round-trip
         - Edit Cursor scope file → sync → verify IR update
         - Override rule → check changes
         - Add pack → validate → export
      4. Execute new feature workflows:
         - Ignore file management (auto-detection of format conflicts)
         - Backup creation and restoration on destructive operations
         - Config-based plugs fills (set/unset/validate formats)
      5. For each workflow:
         - Run exact commands
         - Capture stdout, stderr, exit codes
         - Verify resulting files (config, IR, exports)
         - Test idempotency (run twice, compare outputs)
      6. Validate against expected behavior from docs
      7. Report findings with severity
      8. Clean up test environment

      OUTPUT: Structured report with workflow results and issues found.
      ```
    level: 3
    fingerprint: b7ce5d1a1b48902d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Layer 3: Team Golden Paths"
    content: |-
      ```
      Execute Layer 3 (Team Golden Paths) from .cursor/rules/cli_testing_playbook.mdc.

      EXECUTION PROTOCOL:
      1. Set up two hermetic test environments: user-a and user-b in /tmp
      2. Execute team workflows:
         - Solo → team migration (user-a)
         - Personal remote setup (user-a)
         - Joining existing team (user-b)
         - Team rule changes with PR workflow
         - Personal rule changes (no approval)
         - Drift detection and resolution
         - Multi-file agent editing
         - Read-only file edit detection
         - Team-managed sections
      3. Execute team-specific new features:
         - Backup creation and restoration in team mode
         - Ignore file management in team transitions
         - Backup inheritance when cloning team repository
      4. For each workflow:
         - Run exact commands in sequence
         - Capture all outputs
         - Verify lockfile generation
         - Test conflict detection
         - Validate git operations
         - Verify backup directory structure and restore functionality
      5. Report findings with severity
      6. Clean up both test environments

      OUTPUT: Structured report with team workflow results and collaboration issues.
      ```
    level: 3
    fingerprint: 88baf1b9e9c0294d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Layer 4: Command Coverage"
    content: |-
      ```
      Execute Layer 4 (Command Coverage) from .cursor/rules/cli_testing_playbook.mdc.

      EXECUTION PROTOCOL:
      1. Set up hermetic test environment in /tmp
      2. Build complete command inventory from packages/cli/src/commands/
      3. For each of 22 commands (40+ subcommands):
         - Execute happy path with valid inputs
         - Test with missing required flags
         - Test with invalid inputs
         - Test with conflicting flags
         - Verify --help exists and is accurate
         - Validate exit codes (0=success, non-zero=failure)
      4. Specific focus on new commands:
         - aligntrue status: Verify output shows exporters, sync health, mode
         - aligntrue doctor: Run health checks, verify diagnostics
         - aligntrue onboard: Generate checklist, test --ci flag with SARIF input
         - aligntrue plugs set/unset: Test format validation and fill management
         - aligntrue backup cleanup: Test cleanup command and keep_count enforcement
      5. Capture all outputs and error messages
      6. Validate error messages include what/why/how
      7. Report findings with severity
      8. Clean up test environment

      OUTPUT: Command coverage matrix with pass/fail status and issues per command.
      ```
    level: 3
    fingerprint: e48d894a9f83f324
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Layer 5: Statefulness"
    content: |-
      ```
      Execute Layer 5 (Statefulness) from .cursor/rules/cli_testing_playbook.mdc.

      EXECUTION PROTOCOL:
      1. Set up hermetic test environment in /tmp
      2. Test state scenarios:
         - No config (first run)
         - Valid config
         - Corrupted config (malformed YAML)
         - Partial state (cache exists, config missing)
      3. For each scenario:
         - Run commands and capture behavior
         - Verify error handling
         - Test state recovery
         - Validate cache invalidation
      4. Test backup system state management:
         - Verify .aligntrue/.backups/ directory structure
         - Validate keep_count configuration enforcement
         - Test backup restoration from various states
         - Verify backup cleanup respects retention policy
         - Confirm concurrent operations use unique timestamps
      5. Verify state stored in documented locations
      6. Report findings with severity
      7. Clean up test environment

      OUTPUT: State management report with scenarios tested and issues found.
      ```
    level: 3
    fingerprint: 3ca0b360e07110a8
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Layer 6: Environment Matrix"
    content: |-
      ```
      Execute Layer 6 (Environment Matrix) from .cursor/rules/cli_testing_playbook.mdc.

      EXECUTION PROTOCOL:
      1. Identify current platform (macOS/Linux/Windows)
      2. Set up hermetic test environment in /tmp
      3. Test environment variations:
         - Current shell (bash/zsh/fish/cmd/powershell)
         - Node versions (20, 22, latest)
         - Different path separators
         - CI environment simulation
      4. Execute core workflows on current platform
      5. Validate:
         - Commands are scriptable
         - Outputs are deterministic
         - Paths use correct separators
         - No platform-specific assumptions
      6. Report platform-specific issues
      7. Clean up test environment

      OUTPUT: Environment compatibility report with platform-specific findings.
      ```
    level: 3
    fingerprint: fdf3ae6d71a69541
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Layer 7: Error & UX"
    content: |-
      ```
      Execute Layer 7 (Error & UX) from .cursor/rules/cli_testing_playbook.mdc.

      EXECUTION PROTOCOL:
      1. Set up hermetic test environment in /tmp
      2. Test error scenarios:
         - Invalid commands
         - Missing required arguments
         - File not found errors
         - Permission errors
         - Network failures (if applicable)
         - Validation errors
      3. For each error:
         - Capture error message
         - Verify exit code follows conventions
         - Validate message includes what/why/how
         - Check for sensitive data in logs
      4. Test UX elements:
         - Progress indicators (operations >10s)
         - Deterministic outputs (same inputs → same outputs)
         - Help text accuracy
      5. Report findings with severity
      6. Clean up test environment

      OUTPUT: Error/UX report with message quality assessment and issues found.
      ```
    level: 3
    fingerprint: 78c7dfeeb3d43baf
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "Layer 8: Exploratory"
    content: |-
      ```
      Execute Layer 8 (Exploratory) from .cursor/rules/cli_testing_playbook.mdc.

      EXECUTION PROTOCOL:
      1. Set up hermetic test environment in /tmp
      2. Design 10-15 strange but plausible sequences:
         - Rapid mode switches (solo → team → solo)
         - Conflicting config changes
         - Partial file deletions mid-operation
         - Race conditions (two terminals, same repo)
         - Edge cases from real usage patterns
      3. For each sequence:
         - State what bug/confusion you are probing
         - Execute the commands
         - Capture actual behavior
         - Compare against expected behavior
         - Assign severity if issue found
      4. Report all unexpected behaviors
      5. Clean up test environment

      OUTPUT: Exploratory findings report with edge cases discovered and severity.
      ```
    level: 3
    fingerprint: 9192d8956b08c7b5
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: "All layers: Comprehensive run"
    content: |-
      ```
      Execute all 8 layers from .cursor/rules/cli_testing_playbook.mdc sequentially.

      EXECUTION PROTOCOL:
      1. Set up hermetic test environment in /tmp
      2. Execute layers 1-8 in order
      3. Aggregate results across all layers
      4. Generate comprehensive report in .internal_docs/TEST_LOG.md
      5. Provide summary with:
         - Total scenarios executed
         - Issues found by severity (P0-P3)
         - Coverage percentage
         - Gaps for next run
      6. Clean up test environment

      OUTPUT: Comprehensive test report with full findings and recommendations.
      ```

      ---
    level: 3
    fingerprint: b7cfe4b1f1f0bcb1
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Steer vs Wander
    content: |-
      **When to steer (structured):**

      - Before releases
      - After major refactors
      - When validating new features
      - When fixing regressions

      Use charter layers 1-7 systematically.

      **When to wander (exploratory):**

      - After structured coverage is complete
      - When hunting for edge cases
      - When simulating creative user behavior

      Use charter layer 8 to find unknowns.

      **Never:**

      - Pure wandering without charter guidance (misses boring vital stuff)
      - Pure checklist execution without adaptation (tests rot)

      **Balance:**
      Rules define structure. AI derives specifics from live repo. Log what's tested for incremental coverage.

      ---
    level: 2
    fingerprint: a00e7843a485bd7a
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
  - heading: Success criteria
    content: |-
      **Tests are effective when:**

      - Real blockers found before users hit them
      - Gaps explicitly documented for next run
      - Findings include severity and root cause
      - Test log shows incremental coverage over time

      **Tests are ineffective when:**

      - AI clusters around obvious paths only
      - Same scenarios repeated without learning
      - Findings are vague ("seems slow") without data
      - No logging of what was validated

      ---
    level: 2
    fingerprint: 315da8d78d1ce11d
    vendor:
      aligntrue:
        source_scope: cli_testing_playbook
        source_file: .cursor/rules/cli_testing_playbook.mdc
        last_modified: 2025-11-22T17:57:30.217Z
